{
  "version": 3,
  "sources": ["../src/scheduler.ts", "../src/signal.ts", "../src/effect.ts", "../src/store.ts"],
  "sourcesContent": ["/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u8C03\u5EA6\u5668\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\n *\n * \u4F9B signal\u3001store\u3001effect \u5171\u7528\uFF1A\u8BA2\u9605\u8005/effect \u4E0D\u5728\u6B64 tick \u5185\u540C\u6B65\u6267\u884C\uFF0C\u800C\u662F\u52A0\u5165\u961F\u5217\uFF0C\n * \u7531\u4E00\u6B21\u5FAE\u4EFB\u52A1\u7EDF\u4E00 flush\uFF0C\u907F\u514D\u300C\u5199 \u2192 \u7ACB\u5373\u8DD1 effect \u2192 \u518D\u5199\u300D\u7684\u540C\u6B65\u91CD\u5165\u5BFC\u81F4\u4E3B\u7EBF\u7A0B\u5361\u6B7B\u3002\n */\n\n/** \u5F85\u6267\u884C\u7684\u4EFB\u52A1\u961F\u5217\uFF0C\u540C\u4E00 tick \u5185\u591A\u6B21\u5199\u5165\u53EA\u89E6\u53D1\u4E00\u6B21\u5FAE\u4EFB\u52A1 flush */\nconst queue = new Set<() => void>();\n/** \u590D\u7528\u6570\u7EC4\uFF0Cflush \u65F6\u5012\u5165\u540E\u904D\u5386\u6267\u884C\uFF0C\u907F\u514D\u6BCF\u6B21 new Set \u5206\u914D */\nconst queueCopy: (() => void)[] = [];\nlet scheduled = false;\n\n/**\n * \u6E05\u7A7A\u5F53\u524D\u961F\u5217\u5E76\u4F9D\u6B21\u6267\u884C\u6240\u6709\u4EFB\u52A1\uFF08\u5728\u5FAE\u4EFB\u52A1\u4E2D\u8C03\u7528\uFF09\n */\nfunction flushQueue(): void {\n  scheduled = false;\n  queueCopy.length = 0;\n  for (const run of queue) queueCopy.push(run);\n  queue.clear();\n  for (const run of queueCopy) run();\n}\n\n/**\n * \u5C06\u4EFB\u52A1\u52A0\u5165\u961F\u5217\uFF0C\u5E76\u786E\u4FDD\u5728\u672C tick \u7684\u5FAE\u4EFB\u52A1\u4E2D\u6267\u884C flush\n * \u4F9B signal setter\u3001store set\u3001createEffect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u4F7F\u7528\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\n */\nexport function schedule(run: () => void): void {\n  queue.add(run);\n  if (!scheduled) {\n    scheduled = true;\n    if (typeof globalThis.queueMicrotask !== \"undefined\") {\n      globalThis.queueMicrotask(flushQueue);\n    } else if (typeof Promise !== \"undefined\") {\n      Promise.resolve().then(flushQueue);\n    } else {\n      setTimeout(flushQueue, 0);\n    }\n  }\n}\n\n/**\n * \u4ECE\u961F\u5217\u4E2D\u79FB\u9664\u4EFB\u52A1\uFF08\u5982 effect dispose \u65F6\u53D6\u6D88\u5C1A\u672A\u6267\u884C\u7684 run\uFF09\n */\nexport function unschedule(run: () => void): void {\n  queue.delete(run);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Signal\uFF08\u4FE1\u53F7\uFF09\n *\n * \u7EC6\u7C92\u5EA6\u54CD\u5E94\u5F0F\u5355\u5143\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u5F53\u524D effect \u4E3A\u4F9D\u8D56\uFF0Csetter \u6539\u503C\u5E76\u901A\u77E5\u6240\u6709\u4F9D\u8D56\u7684 effect \u6267\u884C\u3002\n * \u901A\u77E5\u901A\u8FC7\u8C03\u5EA6\u5668\u5F02\u6B65\u6267\u884C\uFF0C\u907F\u514D effect \u5185\u300C\u8BFB\u2192\u5199\u300D\u5BFC\u81F4\u540C\u6B65\u91CD\u5165\u5361\u6B7B\u4E3B\u7EBF\u7A0B\u3002\n */\n\nimport { schedule } from \"./scheduler.ts\";\n\n/** \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\uFF08run \u51FD\u6570\uFF09\uFF0C\u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\uFF1Brun \u4E0A\u53EF\u6302 _subscriptionSets \u4F9B\u6E05\u7406 */\ntype EffectRun = (() => void) & { _subscriptionSets?: Subscriber[] };\nlet currentEffect: EffectRun | null = null;\n\n/**\n * \u5728 effect \u6267\u884C\u671F\u95F4\u8C03\u7528\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D effect \u8BBE\u4E3A\u300C\u6B63\u5728\u6267\u884C\u300D\u4EE5\u4FBF signal \u7684 getter \u80FD\u767B\u8BB0\u4F9D\u8D56\n * @internal \u7531 effect.ts \u7684 createEffect \u4F7F\u7528\n */\nexport function setCurrentEffect(effect: (() => void) | null): void {\n  currentEffect = effect as EffectRun | null;\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\n * @internal\n */\nexport function getCurrentEffect(): (() => void) | null {\n  return currentEffect;\n}\n\n/** \u5355\u4E2A signal \u7684\u8BA2\u9605\u8005\uFF08effect \u7684\u91CD\u65B0\u6267\u884C\u51FD\u6570\uFF09\u5217\u8868 */\ntype Subscriber = Set<() => void>;\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u4FE1\u53F7\n *\n * @param initialValue \u521D\u59CB\u503C\n * @returns [getter, setter] \u5143\u7EC4\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u4F9D\u8D56\uFF0Csetter \u5199\u503C\u5E76\u901A\u77E5\u4F9D\u8D56\n *\n * @example\n * const [count, setCount] = createSignal(0);\n * createEffect(() => console.log(count())); // \u6BCF\u6B21 setCount \u540E\u90FD\u4F1A\u6253\u5370\n * setCount(1);\n */\nexport function createSignal<T>(\n  initialValue: T,\n): [() => T, (value: T | ((prev: T) => T)) => void] {\n  let value = initialValue;\n  const subscribers: Subscriber = new Set();\n\n  const getter = (): T => {\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n      if (currentEffect._subscriptionSets) {\n        currentEffect._subscriptionSets.push(subscribers);\n      }\n    }\n    return value;\n  };\n\n  const setter = (next: T | ((prev: T) => T)): void => {\n    const nextValue = typeof next === \"function\"\n      ? (next as (prev: T) => T)(value)\n      : next;\n    if (Object.is(value, nextValue)) {\n      return;\n    }\n    value = nextValue;\n    subscribers.forEach((run) => schedule(run));\n  };\n\n  return [markSignalGetter(getter), setter];\n}\n\n/**\n * \u5224\u65AD\u4E00\u4E2A\u51FD\u6570\u662F\u5426\u4E3A view \u7684 signal getter\uFF08\u7528\u4E8E dom \u5C42\u533A\u5206\u300C\u9700\u54CD\u5E94\u5F0F\u7ED1\u5B9A\u7684 prop\u300D\u4E0E\u666E\u901A\u51FD\u6570\u5982\u4E8B\u4EF6\u5904\u7406\uFF09\n * \u901A\u8FC7 getter \u4E0A\u6302\u8F7D\u7684\u6807\u8BB0\u5224\u65AD\u3002\n */\nexport const SIGNAL_GETTER_MARKER = Symbol.for(\"view.signalGetter\");\n\n/** \u7ED9 getter \u6253\u6807\u8BB0\uFF0C\u4F9B isSignalGetter \u4F7F\u7528 */\nexport function markSignalGetter<T>(getter: () => T): () => T {\n  (getter as unknown as { [SIGNAL_GETTER_MARKER]: true })[\n    SIGNAL_GETTER_MARKER\n  ] = true;\n  return getter;\n}\n\nexport function isSignalGetter(fn: unknown): fn is () => unknown {\n  return typeof fn === \"function\" &&\n    (fn as unknown as { [SIGNAL_GETTER_MARKER]?: boolean })[\n        SIGNAL_GETTER_MARKER\n      ] === true;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Effect\uFF08\u526F\u4F5C\u7528\uFF09\n *\n * \u6267\u884C\u7528\u6237\u51FD\u6570\u65F6\u767B\u8BB0\u6240\u8BFB\u5230\u7684 signal \u4E3A\u4F9D\u8D56\uFF1B\u5F53\u8FD9\u4E9B signal \u53D8\u66F4\u65F6\u81EA\u52A8\u91CD\u65B0\u6267\u884C effect\u3002\n * \u91CD\u65B0\u6267\u884C\u524D\u4F1A\u5148\u6E05\u7406\u4E0A\u6B21\u767B\u8BB0\u7684\u4F9D\u8D56\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\u3002\n * \u652F\u6301 EffectScope\uFF1A\u6839\u53EF\u6CE8\u518C\u6240\u6709\u5B50 effect \u7684 disposer\uFF0Cunmount \u65F6\u7EDF\u4E00\u6E05\u7406\u3002\n */\n\nimport { schedule, unschedule } from \"./scheduler.ts\";\nimport {\n  createSignal,\n  getCurrentEffect,\n  markSignalGetter,\n  setCurrentEffect,\n} from \"./signal.ts\";\nimport type { EffectDispose } from \"./types.ts\";\n\ntype EffectRunWithSubs = (() => void) & {\n  _subscriptionSets?: Set<() => void>[];\n  /** \u672C effect \u767B\u8BB0\u7684\u6E05\u7406\u51FD\u6570\uFF0C\u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C */\n  _cleanups?: (() => void)[];\n};\n\n/** \u5F53\u524D effect \u4F5C\u7528\u57DF\uFF08\u7531 createRoot \u8BBE\u7F6E\uFF09\uFF0C\u7528\u4E8E unmount \u65F6\u56DE\u6536\u8BE5\u6811\u4E0B\u6240\u6709 effect */\nexport type EffectScope = { addDisposer(dispose: () => void): void };\nlet currentScope: EffectScope | null = null;\n\nexport function getCurrentScope(): EffectScope | null {\n  return currentScope;\n}\n\nexport function setCurrentScope(scope: EffectScope | null): void {\n  currentScope = scope;\n}\n\n/** \u8C03\u5EA6 effect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u5230\u5FAE\u4EFB\u52A1\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\uFF08\u4E0E signal/store \u5171\u7528 scheduler\uFF09 */\nfunction scheduleEffect(run: () => void): void {\n  schedule(run);\n}\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u526F\u4F5C\u7528\n *\n * \u7ACB\u5373\u6267\u884C\u4E00\u6B21 fn\uFF1B\u6267\u884C\u8FC7\u7A0B\u4E2D\u8BFB\u5230\u7684 signal \u4F1A\u5C06\u8BE5 effect \u767B\u8BB0\u4E3A\u4F9D\u8D56\u3002\n * \u4E4B\u540E\u4EFB\u610F\u4F9D\u8D56\u7684 signal \u53D8\u66F4\u65F6\uFF0C\u4F1A\u8C03\u5EA6\u8BE5 effect \u91CD\u65B0\u6267\u884C\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\u3002\n *\n * @param fn \u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u53EF\u8FD4\u56DE\u6E05\u7406\u51FD\u6570\uFF08\u5728\u4E0B\u6B21\u6267\u884C\u524D\u6216 dispose \u65F6\u8C03\u7528\uFF09\n * @returns dispose \u51FD\u6570\uFF0C\u8C03\u7528\u540E\u53D6\u6D88\u8BE5 effect \u7684\u8BA2\u9605\u5E76\u4E0D\u518D\u6267\u884C\n */\n/**\n * \u5728\u5F53\u524D effect \u5185\u767B\u8BB0\u6E05\u7406\u51FD\u6570\uFF0Ceffect \u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C\n * \u4EC5\u5728 createEffect(fn) \u7684 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8C03\u7528\u6709\u6548\n */\nexport function onCleanup(cb: () => void): void {\n  const run = getCurrentEffect() as EffectRunWithSubs | null;\n  if (run?._cleanups) run._cleanups.push(cb);\n}\n\nfunction runCleanups(run: EffectRunWithSubs): void {\n  const list = run._cleanups;\n  if (list) {\n    for (const cb of list) cb();\n    list.length = 0;\n  }\n}\n\nexport function createEffect(fn: () => void | (() => void)): EffectDispose {\n  let disposed = false;\n\n  const run = (): void => {\n    if (disposed) return;\n    // \u82E5\u7531\u8C03\u5EA6\u5668\u89E6\u53D1\uFF08\u975E\u9996\u6B21\uFF09\uFF0C\u5148\u6267\u884C\u4E0A\u6B21\u767B\u8BB0\u7684 cleanups\n    runCleanups(run as EffectRunWithSubs);\n    // \u4ECE\u4E0A\u6B21\u4F9D\u8D56\u7684\u6240\u6709 signal \u8BA2\u9605\u5217\u8868\u4E2D\u79FB\u9664\u672C effect\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\n    const subs = (run as EffectRunWithSubs)._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    (run as EffectRunWithSubs)._cleanups = [];\n    const prev = getCurrentEffect();\n    (run as EffectRunWithSubs)._subscriptionSets = [];\n    setCurrentEffect(run);\n    try {\n      const nextDispose = fn();\n      if (typeof nextDispose === \"function\") {\n        (run as EffectRunWithSubs)._cleanups!.push(nextDispose);\n      }\n    } finally {\n      setCurrentEffect(prev);\n    }\n  };\n\n  const schedule = (): void => {\n    if (disposed) return;\n    runCleanups(run as EffectRunWithSubs);\n    scheduleEffect(run);\n  };\n\n  (run as EffectRunWithSubs)._subscriptionSets = [];\n  (run as EffectRunWithSubs)._cleanups = [];\n  run();\n\n  const disposer = (): void => {\n    if (disposed) return;\n    disposed = true;\n    const runWithSubs = run as EffectRunWithSubs;\n    const subs = runWithSubs._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    runCleanups(runWithSubs);\n    unschedule(schedule);\n  };\n  if (currentScope) currentScope.addDisposer(disposer);\n  return disposer;\n}\n\n/**\n * \u521B\u5EFA\u53EA\u8BFB\u6D3E\u751F\u503C\uFF08memo\uFF09\uFF0C\u4F9D\u8D56\u53D8\u5316\u65F6\u624D\u91CD\u7B97\u5E76\u7F13\u5B58\n * \u8FD4\u56DE getter\uFF0C\u5728 effect \u6216\u6A21\u677F\u4E2D\u8BFB\u53D6\u65F6\u4F1A\u767B\u8BB0\u4F9D\u8D56\n */\nexport function createMemo<T>(fn: () => T): () => T {\n  const [get, set] = createSignal<T>(undefined as unknown as T);\n  createEffect(() => set(fn()));\n  return markSignalGetter(get) as () => T;\n}\n", "/**\n * @dreamer/view/store \u2014 \u6309\u9700\u5BFC\u5165\n *\n * createStore\uFF1A\u5C06\u5BF9\u8C61\u53D8\u4E3A\u5D4C\u5957\u54CD\u5E94\u5F0F\uFF08Proxy\uFF09\uFF0C\u4EFB\u610F\u5C42\u7EA7\u8BFB\u5199\u90FD\u4F1A\u767B\u8BB0\u4F9D\u8D56/\u901A\u77E5\u8BA2\u9605\u3002\n * \u652F\u6301 actions\uFF08\u65B9\u6CD5\u53EF\u4E92\u76F8\u8C03\u7528\u3001\u53EF\u8BFB state\uFF09\u3001\u6301\u4E45\u5316\uFF08\u5982 localStorage\uFF09\u3002\n */\n\nimport { createMemo } from \"./effect.ts\";\nimport { schedule } from \"./scheduler.ts\";\nimport { getCurrentEffect } from \"./signal.ts\";\nimport type { SignalTuple } from \"./types.ts\";\n\nconst STORE_INTERNAL = Symbol.for(\"view.store.internal\");\n\ntype SubscriberSet = Set<() => void>;\n\n/**\n * \u6301\u4E45\u5316\u5B58\u50A8\u7C7B\u578B\uFF1A\u7528\u6237\u81EA\u914D storage \u65F6\u5B9E\u73B0\u6B64\u63A5\u53E3\u5373\u53EF\n *\n * \u9700\u5B9E\u73B0 getItem(key)\u3001setItem(key, value)\uFF0C\u53EF\u9009 removeItem(key)\u3002\n * \u4E0D\u4F20 persist.storage \u65F6\u9ED8\u8BA4\u4F7F\u7528 globalThis.localStorage\uFF08\u82E5\u5B58\u5728\uFF09\uFF1B\n * \u4F20\u5165\u5219\u5B8C\u5168\u4F7F\u7528\u7528\u6237\u63D0\u4F9B\u7684\u5B9E\u4F8B\uFF0C\u53EF\u81EA\u5B9A\u4E49\u5B58\u50A8\u4F4D\u7F6E\uFF08\u5982 sessionStorage\u3001\u5185\u5B58\u3001IndexedDB \u58F3\u7B49\uFF09\u3002\n */\nexport interface StorageLike {\n  getItem(key: string): string | null;\n  setItem(key: string, value: string): void;\n  removeItem?(key: string): void;\n}\n\n/** \u6301\u4E45\u5316\u914D\u7F6E\uFF1Akey \u5FC5\u586B\uFF1Bstorage \u7531\u7528\u6237\u914D\u7F6E\uFF0C\u4E0D\u4F20\u5219\u56DE\u9000\u5230 localStorage\uFF08\u82E5\u5B58\u5728\uFF09 */\nexport interface PersistOptions<T extends Record<string, unknown>> {\n  /** \u5B58\u50A8\u952E\u540D\uFF08\u5728 storage \u4E2D\u4F7F\u7528\u7684 key\uFF0C\u7528\u6237\u53EF\u636E\u6B64\u81EA\u5B9A\u4E49\u5B58\u50A8\u4F4D\u7F6E\u6216\u524D\u7F00\uFF09 */\n  key: string;\n  /**\n   * \u5B58\u50A8\u5B9E\u73B0\uFF1A\u5B9E\u73B0 {@link StorageLike} \u7C7B\u578B\uFF08getItem/setItem/\u53EF\u9009 removeItem\uFF09\u5373\u53EF\u81EA\u5B9A\u4E49\u5B58\u50A8\u4F4D\u7F6E\n   * \u4E0D\u4F20\u65F6\u4F7F\u7528 globalThis.localStorage\uFF08\u4E0D\u5B58\u5728\u5219\u4E0D\u6301\u4E45\u5316\uFF09\uFF1B\u4F20\u5165\u5219\u4EC5\u4F7F\u7528\u8BE5 storage\n   */\n  storage?: StorageLike | null;\n  /** \u5E8F\u5217\u5316\uFF0C\u9ED8\u8BA4 JSON.stringify */\n  serialize?: (state: T) => string;\n  /** \u53CD\u5E8F\u5217\u5316\uFF0C\u9ED8\u8BA4 JSON.parse */\n  deserialize?: (raw: string) => T;\n}\n\n/**\n * getters\uFF1A\u4E0E state \u5E73\u7EA7\uFF0C\u6BCF\u4E2A getter \u4E3A (get) => value\uFF0C\u5185\u90E8\u901A\u8FC7 get() \u8BFB state\uFF0C\u8FD4\u56DE\u503C\u7531 createMemo \u7F13\u5B58\u5E76\u54CD\u5E94\u5F0F\u66F4\u65B0\n */\nexport type StoreGetters<T extends Record<string, unknown>> = Record<\n  string,\n  (get: () => T) => unknown\n>;\n\n/**\n * actions\uFF1A\u4E0E state \u5E73\u7EA7\uFF0C\u6BCF\u4E2A action \u4E3A (get, set, ...args) => unknown\uFF0C\u8C03\u7528\u65F6\u7531 createStore \u6CE8\u5165 get/set\n */\nexport type StoreActions<T extends Record<string, unknown>> = Record<\n  string,\n  (\n    get: () => T,\n    set: (value: T | ((prev: T) => T)) => void,\n    ...args: unknown[]\n  ) => unknown\n>;\n\n/** createStore \u7684\u914D\u7F6E\uFF1Astate \u5FC5\u586B\uFF0Cgetters / actions / persist \u4E0E state \u5E73\u7EA7 */\nexport interface CreateStoreConfig<\n  T extends Record<string, unknown>,\n  G extends StoreGetters<T> = StoreGetters<T>,\n  A extends StoreActions<T> = StoreActions<T>,\n> {\n  /** \u521D\u59CB\u72B6\u6001\uFF08\u4F1A\u88AB\u6D45\u62F7\u8D1D\uFF0C\u53EF\u5D4C\u5957\uFF09 */\n  state: T;\n  /** \u6D3E\u751F\u53EA\u8BFB\uFF1A\u6BCF\u4E2A getter(get) => value\uFF0C\u5728 effect \u4E2D\u4F7F\u7528\u4F1A\u968F state \u54CD\u5E94\u5F0F\u66F4\u65B0 */\n  getters?: G;\n  /** \u65B9\u6CD5\uFF1A(get, set, ...args) => unknown\uFF0C\u8C03\u7528\u65F6\u81EA\u52A8\u6CE8\u5165 get/set */\n  actions?: A;\n  /** \u6301\u4E45\u5316\uFF1A\u521D\u59CB\u5316\u65F6\u4ECE storage \u6062\u590D\uFF0C\u6BCF\u6B21 set \u540E\u5199\u5165 */\n  persist?: PersistOptions<T>;\n}\n\n/**\n * \u4E3A\u666E\u901A\u5BF9\u8C61\u521B\u5EFA\u4EE3\u7406\uFF0Cget \u767B\u8BB0 effect\uFF0Cset \u901A\u77E5\u8BA2\u9605\u8005\uFF08\u7528\u4E8E\u5D4C\u5957\uFF09\n * \u4F7F\u7528 WeakMap \u6309 target \u7F13\u5B58 proxy\uFF0C\u4FDD\u8BC1\u540C\u5BF9\u8C61\u540C proxy\uFF0C\u5E76\u51CF\u5C11\u521B\u5EFA\n */\nfunction createNestedProxy<T extends object>(\n  target: T,\n  subscribers: SubscriberSet,\n  proxyCache: WeakMap<object, object>,\n): T {\n  const cached = proxyCache.get(target);\n  if (cached) return cached as T;\n  const proxy = new Proxy(target, {\n    get(t, key: string) {\n      const effect = getCurrentEffect();\n      if (effect) subscribers.add(effect);\n      const value = Reflect.get(t, key);\n      if (value !== null && typeof value === \"object\") {\n        return createNestedProxy(\n          value as object,\n          subscribers,\n          proxyCache,\n        ) as T[keyof T];\n      }\n      return value;\n    },\n    set(t, key: string, value: unknown) {\n      const ok = Reflect.set(t, key, value);\n      if (ok) subscribers.forEach((run) => schedule(run));\n      return ok;\n    },\n  }) as T;\n  proxyCache.set(target, proxy);\n  return proxy;\n}\n\n/**\n * \u521B\u5EFA\u6839 store \u4EE3\u7406\uFF1Atarget \u4E3A stateRef\uFF0C\u8BFB\u5199\u90FD\u8F6C\u53D1\u5230 stateRef[STORE_INTERNAL]\n */\nfunction createRootStoreProxy<T extends Record<string, unknown>>(\n  stateRef: { [STORE_INTERNAL]: T },\n  subscribers: SubscriberSet,\n  proxyCache: WeakMap<object, object>,\n): T {\n  return new Proxy(stateRef as unknown as T, {\n    get(t, key: string | symbol) {\n      if (key === STORE_INTERNAL) {\n        return (t as unknown as Record<symbol, T>)[STORE_INTERNAL];\n      }\n      const effect = getCurrentEffect();\n      if (effect) subscribers.add(effect);\n      const state = (t as unknown as Record<symbol, T>)[STORE_INTERNAL];\n      const value = state[key as keyof T];\n      if (value !== null && typeof value === \"object\") {\n        return createNestedProxy(\n          value as object,\n          subscribers,\n          proxyCache,\n        ) as T[keyof T];\n      }\n      return value;\n    },\n    set(t, key: string | symbol, value: unknown) {\n      const state = (t as unknown as Record<symbol, T>)[STORE_INTERNAL];\n      if (key === STORE_INTERNAL) {\n        (t as unknown as Record<symbol, T>)[STORE_INTERNAL] = value as T;\n      } else {\n        (state as Record<string, unknown>)[key as string] = value;\n      }\n      subscribers.forEach((run) => schedule(run));\n      return true;\n    },\n  }) as T;\n}\n\n/** \u9ED8\u8BA4\u6301\u4E45\u5316\uFF1A\u4F7F\u7528 JSON \u5E8F\u5217\u5316\uFF1B\u82E5 storage \u4E0D\u53EF\u7528\u5219\u8DF3\u8FC7 */\nfunction defaultSerialize<T>(state: T): string {\n  return JSON.stringify(state);\n}\n\nfunction defaultDeserialize<T>(raw: string): T {\n  return JSON.parse(raw) as T;\n}\n\n/** \u83B7\u53D6\u9ED8\u8BA4 storage\uFF08\u6D4F\u89C8\u5668\u4E0B\u4E3A localStorage\uFF09 */\nfunction getDefaultStorage(): StorageLike | null {\n  if (typeof globalThis !== \"undefined\" && \"localStorage\" in globalThis) {\n    return (globalThis as unknown as { localStorage: StorageLike })\n      .localStorage;\n  }\n  return null;\n}\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F store\uFF08\u5D4C\u5957 Proxy\uFF0C\u4E0E createEffect \u534F\u4F5C\uFF09\n *\n * \u914D\u7F6E\u4E3A\u5355\u5BF9\u8C61\uFF1Astate \u5FC5\u586B\uFF0Cgetters / actions / persist \u4E0E state \u5E73\u7EA7\u3002\n * - getters\uFF1A{ name(get) { return get().xxx; } }\uFF0C\u5185\u90E8\u7528 createMemo \u7F13\u5B58\n * - actions\uFF1A{ method1(get, set, ...args) { } }\uFF0C\u8C03\u7528\u65F6\u81EA\u52A8\u6CE8\u5165 get/set\n *\n * @example\n * const [get, set] = createStore({ state: { count: 0 } });\n *\n * @example\n * const [get, set, actions] = createStore({\n *   state: { count: 0 },\n *   actions: {\n *     increment(get, set) { set({ ...get(), count: get().count + 1 }); },\n *     reset(get, set) { set({ ...get(), count: 0 }); },\n *   },\n * });\n *\n * @example\n * const [get, set, getters] = createStore({\n *   state: { count: 0, name: \"\" },\n *   getters: {\n *     double(get) { return get().count * 2; },\n *     greeting(get) { return `Hi, ${get().name}`; },\n *   },\n * });\n *\n * @example\n * const [get, set] = createStore({ state: { name: \"\" }, persist: { key: \"user\" } });\n */\nexport function createStore<T extends Record<string, unknown>>(\n  config: CreateStoreConfig<T> & { getters?: undefined; actions?: undefined },\n): [getter: () => T, setter: (value: T | ((prev: T) => T)) => void];\n\nexport function createStore<\n  T extends Record<string, unknown>,\n  G extends StoreGetters<T>,\n>(\n  config: CreateStoreConfig<T, G> & {\n    getters: G;\n    actions?: undefined;\n  },\n): [\n  getter: () => T,\n  setter: (value: T | ((prev: T) => T)) => void,\n  getters: { [K in keyof G]: () => ReturnType<G[K]> },\n];\n\nexport function createStore<\n  T extends Record<string, unknown>,\n  A extends StoreActions<T>,\n>(\n  config: CreateStoreConfig<T, StoreGetters<T>, A> & {\n    getters?: undefined;\n    actions: A;\n  },\n): [\n  getter: () => T,\n  setter: (value: T | ((prev: T) => T)) => void,\n  actions: { [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]> },\n];\n\nexport function createStore<\n  T extends Record<string, unknown>,\n  G extends StoreGetters<T>,\n  A extends StoreActions<T>,\n>(\n  config: CreateStoreConfig<T, G, A> & { getters: G; actions: A },\n): [\n  getter: () => T,\n  setter: (value: T | ((prev: T) => T)) => void,\n  getters: { [K in keyof G]: () => ReturnType<G[K]> },\n  actions: { [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]> },\n];\n\nexport function createStore<\n  T extends Record<string, unknown>,\n  G extends StoreGetters<T> = StoreGetters<T>,\n  A extends StoreActions<T> = StoreActions<T>,\n>(\n  config: CreateStoreConfig<T, G, A>,\n):\n  | [getter: () => T, setter: (value: T | ((prev: T) => T)) => void]\n  | [\n    getter: () => T,\n    setter: (value: T | ((prev: T) => T)) => void,\n    getters: { [K in keyof G]: () => ReturnType<G[K]> },\n  ]\n  | [\n    getter: () => T,\n    setter: (value: T | ((prev: T) => T)) => void,\n    actions: { [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]> },\n  ]\n  | [\n    getter: () => T,\n    setter: (value: T | ((prev: T) => T)) => void,\n    getters: { [K in keyof G]: () => ReturnType<G[K]> },\n    actions: { [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]> },\n  ] {\n  const {\n    state: initial,\n    getters: gettersConfig,\n    actions: actionsConfig,\n    persist,\n  } = config;\n  const subscribers: SubscriberSet = new Set();\n  const proxyCache = new WeakMap<object, object>();\n\n  const stateRef: { [STORE_INTERNAL]: T } = {\n    [STORE_INTERNAL]: { ...initial } as T,\n  };\n\n  if (persist?.key) {\n    const storage = persist.storage ?? getDefaultStorage();\n    const deserialize = persist.deserialize ?? defaultDeserialize;\n    if (storage) {\n      try {\n        const raw = storage.getItem(persist.key);\n        if (raw != null && raw !== \"\") {\n          const loaded = deserialize(raw) as T;\n          if (loaded && typeof loaded === \"object\") {\n            // \u4E0E\u521D\u59CB state \u5408\u5E76\uFF0C\u907F\u514D\u65E7\u6570\u636E\u7F3A\u5B57\u6BB5\u5BFC\u81F4 get().count \u7B49\u4E3A undefined \u2192 double \u7B49\u6D3E\u751F\u51FA\u73B0 NaN\n            stateRef[STORE_INTERNAL] = { ...initial, ...loaded } as T;\n          }\n        }\n      } catch {\n        // \u5FFD\u7565\u89E3\u6790\u9519\u8BEF\n      }\n    }\n  }\n\n  const getter = (): T =>\n    createRootStoreProxy(stateRef, subscribers, proxyCache);\n\n  const setter = (value: T | ((prev: T) => T)): void => {\n    const prev = stateRef[STORE_INTERNAL];\n    const next = typeof value === \"function\"\n      ? (value as (prev: T) => T)(prev)\n      : value;\n    stateRef[STORE_INTERNAL] = { ...next } as T;\n    subscribers.forEach((run) => schedule(run));\n    if (persist?.key) {\n      const storage = persist.storage ?? getDefaultStorage();\n      const serialize = persist.serialize ?? defaultSerialize;\n      if (storage) {\n        try {\n          storage.setItem(persist.key, serialize(stateRef[STORE_INTERNAL]));\n        } catch {\n          // \u5FFD\u7565\n        }\n      }\n    }\n  };\n\n  const hasGetters = !!gettersConfig && Object.keys(gettersConfig).length > 0;\n  const hasActions = !!actionsConfig && Object.keys(actionsConfig).length > 0;\n\n  if (hasGetters && hasActions) {\n    const gettersObj: Record<string, () => unknown> = {};\n    for (const [k, fn] of Object.entries(gettersConfig!)) {\n      if (typeof fn === \"function\") {\n        gettersObj[k] = createMemo(() =>\n          (fn as (get: () => T) => unknown)(getter)\n        );\n      }\n    }\n    const actionsObj: Record<string, (...args: unknown[]) => unknown> = {};\n    for (const [k, fn] of Object.entries(actionsConfig!)) {\n      if (typeof fn === \"function\") {\n        actionsObj[k] = (...args: unknown[]) =>\n          (fn as (\n            get: () => T,\n            set: (v: T | ((p: T) => T)) => void,\n            ...a: unknown[]\n          ) => unknown)(getter, setter, ...args);\n      }\n    }\n    return [\n      getter,\n      setter,\n      gettersObj as { [K in keyof G]: () => ReturnType<G[K]> },\n      actionsObj as {\n        [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]>;\n      },\n    ];\n  }\n\n  if (hasGetters) {\n    const gettersObj: Record<string, () => unknown> = {};\n    for (const [k, fn] of Object.entries(gettersConfig!)) {\n      if (typeof fn === \"function\") {\n        gettersObj[k] = createMemo(() =>\n          (fn as (get: () => T) => unknown)(getter)\n        );\n      }\n    }\n    return [\n      getter,\n      setter,\n      gettersObj as { [K in keyof G]: () => ReturnType<G[K]> },\n    ];\n  }\n\n  if (hasActions) {\n    const actionsObj: Record<string, (...args: unknown[]) => unknown> = {};\n    for (const [k, fn] of Object.entries(actionsConfig!)) {\n      if (typeof fn === \"function\") {\n        actionsObj[k] = (...args: unknown[]) =>\n          (fn as (\n            get: () => T,\n            set: (v: T | ((p: T) => T)) => void,\n            ...a: unknown[]\n          ) => unknown)(getter, setter, ...args);\n      }\n    }\n    return [\n      getter,\n      setter,\n      actionsObj as {\n        [K in keyof A]: (...args: unknown[]) => ReturnType<A[K]>;\n      },\n    ];\n  }\n\n  return [getter, setter] as SignalTuple<T>;\n}\n"],
  "mappings": "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",
  "names": ["queue", "queueCopy", "scheduled", "flushQueue", "run", "schedule", "unschedule", "currentEffect", "setCurrentEffect", "effect", "getCurrentEffect", "createSignal", "initialValue", "value", "subscribers", "getter", "setter", "next", "nextValue", "run", "schedule", "markSignalGetter", "SIGNAL_GETTER_MARKER", "currentScope", "scheduleEffect", "run", "schedule", "runCleanups", "run", "list", "cb", "createEffect", "fn", "disposed", "subs", "s", "prev", "getCurrentEffect", "setCurrentEffect", "nextDispose", "schedule", "scheduleEffect", "disposer", "runWithSubs", "unschedule", "currentScope", "createMemo", "get", "set", "createSignal", "markSignalGetter", "STORE_INTERNAL", "createNestedProxy", "target", "subscribers", "proxyCache", "cached", "proxy", "t", "key", "effect", "getCurrentEffect", "value", "ok", "run", "schedule", "createRootStoreProxy", "stateRef", "state", "defaultSerialize", "defaultDeserialize", "raw", "getDefaultStorage", "createStore", "config", "initial", "gettersConfig", "actionsConfig", "persist", "storage", "deserialize", "loaded", "getter", "setter", "prev", "next", "serialize", "hasGetters", "hasActions", "gettersObj", "k", "fn", "createMemo", "actionsObj", "args"]
}
