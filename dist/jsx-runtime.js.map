{
  "version": 3,
  "sources": ["../src/dom/shared.ts", "../src/signal.ts", "../src/jsx-runtime.ts"],
  "sourcesContent": ["/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 DOM \u5C42\u5171\u4EAB\u7C7B\u578B\u4E0E\u5DE5\u5177\n *\n * Fragment\u3001IfContext\u3001SSROptions\u3001isFragment\u3001isVNodeLike \u7B49\uFF0C\u4F9B element / stringify / hydrate \u590D\u7528\n */\n\nimport type { VNode } from \"../types.ts\";\n\n/** Fragment \u7684 type \u6807\u8BB0\uFF0C\u4E0D\u521B\u5EFA\u771F\u5B9E\u8282\u70B9\uFF0C\u4EC5\u7528\u4E8E\u5305\u88F9\u5B50\u8282\u70B9 */\nexport const FragmentType = Symbol.for(\"view.fragment\");\n\n/** \u5224\u65AD\u662F\u5426\u4E3A Fragment \u8282\u70B9 */\nexport function isFragment(vnode: VNode): boolean {\n  return vnode.type === FragmentType || (vnode.type as unknown) === \"Fragment\";\n}\n\n/** v-if / v-else \u5144\u5F1F\u94FE\u7684\u4E0A\u4E0B\u6587\uFF0C\u7528\u4E8E vElse \u5224\u65AD\u201C\u4E0A\u4E00\u4E2A vIf \u662F\u5426\u4E3A false\u201D */\nexport type IfContext = { lastVIf: boolean };\n\n/**\n * SSR \u9009\u9879\uFF1AallowRawHtml \u4E3A false \u65F6 v-html / dangerouslySetInnerHTML \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF08\u5B89\u5168\u573A\u666F\uFF09\n * \u9ED8\u8BA4\u670D\u52A1\u7AEF v-html \u540C\u6837\u4E0D\u8F6C\u4E49\uFF0C\u4E0E\u5BA2\u6237\u7AEF\u4E00\u81F4\uFF1B\u82E5\u9700\u7981\u6B62\u539F\u59CB HTML \u53EF\u4F20 allowRawHtml: false\n */\nexport type SSROptions = { allowRawHtml?: boolean };\n\n/** \u5224\u65AD\u662F\u5426\u5F62\u5982 VNode\uFF08\u542B type\u3001props\uFF09 */\nexport function isVNodeLike(x: unknown): boolean {\n  return typeof x === \"object\" && x !== null && \"type\" in x && \"props\" in x;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Signal\uFF08\u4FE1\u53F7\uFF09\n *\n * \u7EC6\u7C92\u5EA6\u54CD\u5E94\u5F0F\u5355\u5143\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u5F53\u524D effect \u4E3A\u4F9D\u8D56\uFF0Csetter \u6539\u503C\u5E76\u901A\u77E5\u6240\u6709\u4F9D\u8D56\u7684 effect \u6267\u884C\u3002\n * \u901A\u77E5\u901A\u8FC7\u8C03\u5EA6\u5668\u5F02\u6B65\u6267\u884C\uFF0C\u907F\u514D effect \u5185\u300C\u8BFB\u2192\u5199\u300D\u5BFC\u81F4\u540C\u6B65\u91CD\u5165\u5361\u6B7B\u4E3B\u7EBF\u7A0B\u3002\n */\n\nimport { schedule } from \"./scheduler.ts\";\n\n/** \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\uFF08run \u51FD\u6570\uFF09\uFF0C\u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\uFF1Brun \u4E0A\u53EF\u6302 _subscriptionSets \u4F9B\u6E05\u7406 */\ntype EffectRun = (() => void) & { _subscriptionSets?: Subscriber[] };\nlet currentEffect: EffectRun | null = null;\n\n/**\n * \u5728 effect \u6267\u884C\u671F\u95F4\u8C03\u7528\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D effect \u8BBE\u4E3A\u300C\u6B63\u5728\u6267\u884C\u300D\u4EE5\u4FBF signal \u7684 getter \u80FD\u767B\u8BB0\u4F9D\u8D56\n * @internal \u7531 effect.ts \u7684 createEffect \u4F7F\u7528\n */\nexport function setCurrentEffect(effect: (() => void) | null): void {\n  currentEffect = effect as EffectRun | null;\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\n * @internal\n */\nexport function getCurrentEffect(): (() => void) | null {\n  return currentEffect;\n}\n\n/** \u5355\u4E2A signal \u7684\u8BA2\u9605\u8005\uFF08effect \u7684\u91CD\u65B0\u6267\u884C\u51FD\u6570\uFF09\u5217\u8868 */\ntype Subscriber = Set<() => void>;\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u4FE1\u53F7\n *\n * @param initialValue \u521D\u59CB\u503C\n * @returns [getter, setter] \u5143\u7EC4\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u4F9D\u8D56\uFF0Csetter \u5199\u503C\u5E76\u901A\u77E5\u4F9D\u8D56\n *\n * @example\n * const [count, setCount] = createSignal(0);\n * createEffect(() => console.log(count())); // \u6BCF\u6B21 setCount \u540E\u90FD\u4F1A\u6253\u5370\n * setCount(1);\n */\nexport function createSignal<T>(\n  initialValue: T,\n): [() => T, (value: T | ((prev: T) => T)) => void] {\n  let value = initialValue;\n  const subscribers: Subscriber = new Set();\n\n  const getter = (): T => {\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n      if (currentEffect._subscriptionSets) {\n        currentEffect._subscriptionSets.push(subscribers);\n      }\n    }\n    return value;\n  };\n\n  const setter = (next: T | ((prev: T) => T)): void => {\n    const nextValue = typeof next === \"function\"\n      ? (next as (prev: T) => T)(value)\n      : next;\n    if (Object.is(value, nextValue)) {\n      return;\n    }\n    value = nextValue;\n    subscribers.forEach((run) => schedule(run));\n  };\n\n  return [markSignalGetter(getter), setter];\n}\n\n/**\n * \u5224\u65AD\u4E00\u4E2A\u51FD\u6570\u662F\u5426\u4E3A view \u7684 signal getter\uFF08\u7528\u4E8E dom \u5C42\u533A\u5206\u300C\u9700\u54CD\u5E94\u5F0F\u7ED1\u5B9A\u7684 prop\u300D\u4E0E\u666E\u901A\u51FD\u6570\u5982\u4E8B\u4EF6\u5904\u7406\uFF09\n * \u901A\u8FC7 getter \u4E0A\u6302\u8F7D\u7684\u6807\u8BB0\u5224\u65AD\u3002\n */\nexport const SIGNAL_GETTER_MARKER = Symbol.for(\"view.signalGetter\");\n\n/** \u7ED9 getter \u6253\u6807\u8BB0\uFF0C\u4F9B isSignalGetter \u4F7F\u7528 */\nexport function markSignalGetter<T>(getter: () => T): () => T {\n  (getter as unknown as { [SIGNAL_GETTER_MARKER]: true })[\n    SIGNAL_GETTER_MARKER\n  ] = true;\n  return getter;\n}\n\nexport function isSignalGetter(fn: unknown): fn is () => unknown {\n  return typeof fn === \"function\" &&\n    (fn as unknown as { [SIGNAL_GETTER_MARKER]?: boolean })[\n        SIGNAL_GETTER_MARKER\n      ] === true;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 JSX \u8FD0\u884C\u65F6\n *\n * \u4F9B jsxImportSource: \"view\" \u4F7F\u7528\uFF0C\u4E0E react-jsx \u8F6C\u6362\u517C\u5BB9\u3002\n * \u5BFC\u51FA jsx\u3001jsxs\u3001Fragment\uFF0C\u4EA7\u51FA VNode \u4F9B dom / runtime \u6D88\u8D39\u3002\n */\n\nimport { FragmentType } from \"./dom.ts\";\nimport type { VNode } from \"./types.ts\";\n\n/** Fragment \u7EC4\u4EF6\uFF1A\u7528\u4E8E <>...</> \u6216 <Fragment>...</Fragment>\uFF0C\u4E0D\u4EA7\u751F\u771F\u5B9E DOM \u8282\u70B9 */\nexport const Fragment = FragmentType;\n\n/**\n * \u89C4\u8303\u5316 props\uFF1A\u63D0\u53D6 key\u3001children\uFF0C\u8FD4\u56DE\u4F9B VNode \u4F7F\u7528\u7684 props \u4E0E key\n */\nfunction normalizeProps(\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): { props: Record<string, unknown>; key?: string | number | null } {\n  const p = props ?? {};\n  // \u7B2C\u4E09\u53C2 maybeKey \u8986\u76D6 props.key\uFF08\u4E0E React automatic runtime \u4E00\u81F4\uFF09\n  const key =\n    (maybeKey !== undefined && maybeKey !== null\n      ? maybeKey\n      : (p.key as string | number | null | undefined)) ?? null;\n  const { key: _k, ...rest } = p as Record<string, unknown> & { key?: unknown };\n  return { props: rest, key: key ?? undefined };\n}\n\n/**\n * jsx(type, props, maybeKey?)\n * \u4E0E React 17+ automatic JSX runtime \u517C\u5BB9\uFF0C\u7528\u4E8E\u52A8\u6001\u5B50\u8282\u70B9\u573A\u666F\n */\nexport function jsx(\n  type: VNode[\"type\"],\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): VNode {\n  const { props: p, key } = normalizeProps(props, maybeKey);\n  return { type, props: p, key, children: p.children as VNode[] | undefined };\n}\n\n/**\n * jsxs(type, props, maybeKey?)\n * \u4E0E React 17+ automatic JSX runtime \u517C\u5BB9\uFF0C\u7528\u4E8E\u9759\u6001\u5B50\u8282\u70B9\u573A\u666F\uFF08\u5B50\u8282\u70B9\u4E3A\u6570\u7EC4\uFF09\n */\nexport function jsxs(\n  type: VNode[\"type\"],\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): VNode {\n  const { props: p, key } = normalizeProps(props, maybeKey);\n  return { type, props: p, key, children: p.children as VNode[] | undefined };\n}\n\n/**\n * JSX intrinsic \u5143\u7D20\u7C7B\u578B\uFF1A\u4F9B TSX \u4E2D DOM \u6807\u7B7E\u7C7B\u578B\u68C0\u67E5\u4F7F\u7528\u3002\n * \u4F7F\u7528 jsxImportSource: \"@dreamer/view\" \u65F6\u7F16\u8BD1\u5668\u4F1A\u4F7F\u7528\u6B64\u547D\u540D\u7A7A\u95F4\u3002\n * \u56E0\u5305\u542B declare global\uFF0CJSR \u53D1\u5E03\u9700\u4F7F\u7528 --allow-slow-types\u3002\n */\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      [tag: string]: Record<string, unknown>;\n    }\n  }\n}\n"],
  "mappings": "AASO,IAAMA,EAAe,OAAO,IAAI,eAAe,ECoE/C,IAAMC,EAAuB,OAAO,IAAI,mBAAmB,EClE3D,IAAMC,EAAWC,EAKxB,SAASC,EACPC,EACAC,EACkE,CAClE,IAAMC,EAAIF,GAAS,CAAC,EAEdG,EACuBF,GAEtBC,EAAE,KAA+C,KAClD,CAAE,IAAKE,EAAI,GAAGC,CAAK,EAAIH,EAC7B,MAAO,CAAE,MAAOG,EAAM,IAAKF,GAAO,MAAU,CAC9C,CAMO,SAASG,EACdC,EACAP,EACAC,EACO,CACP,GAAM,CAAE,MAAOC,EAAG,IAAAC,CAAI,EAAIJ,EAAeC,EAAOC,CAAQ,EACxD,MAAO,CAAE,KAAAM,EAAM,MAAOL,EAAG,IAAAC,EAAK,SAAUD,EAAE,QAAgC,CAC5E,CAMO,SAASM,GACdD,EACAP,EACAC,EACO,CACP,GAAM,CAAE,MAAOC,EAAG,IAAAC,CAAI,EAAIJ,EAAeC,EAAOC,CAAQ,EACxD,MAAO,CAAE,KAAAM,EAAM,MAAOL,EAAG,IAAAC,EAAK,SAAUD,EAAE,QAAgC,CAC5E",
  "names": ["FragmentType", "SIGNAL_GETTER_MARKER", "Fragment", "FragmentType", "normalizeProps", "props", "maybeKey", "p", "key", "_k", "rest", "jsx", "type", "jsxs"]
}
