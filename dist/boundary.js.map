{
  "version": 3,
  "sources": ["../src/scheduler.ts", "../src/signal.ts", "../src/effect.ts", "../src/dom/shared.ts", "../src/jsx-runtime.ts", "../src/boundary.ts"],
  "sourcesContent": ["/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u8C03\u5EA6\u5668\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\n *\n * \u4F9B signal\u3001store\u3001effect \u5171\u7528\uFF1A\u8BA2\u9605\u8005/effect \u4E0D\u5728\u6B64 tick \u5185\u540C\u6B65\u6267\u884C\uFF0C\u800C\u662F\u52A0\u5165\u961F\u5217\uFF0C\n * \u7531\u4E00\u6B21\u5FAE\u4EFB\u52A1\u7EDF\u4E00 flush\uFF0C\u907F\u514D\u300C\u5199 \u2192 \u7ACB\u5373\u8DD1 effect \u2192 \u518D\u5199\u300D\u7684\u540C\u6B65\u91CD\u5165\u5BFC\u81F4\u4E3B\u7EBF\u7A0B\u5361\u6B7B\u3002\n */\n\n/** \u5F85\u6267\u884C\u7684\u4EFB\u52A1\u961F\u5217\uFF0C\u540C\u4E00 tick \u5185\u591A\u6B21\u5199\u5165\u53EA\u89E6\u53D1\u4E00\u6B21\u5FAE\u4EFB\u52A1 flush */\nconst queue = new Set<() => void>();\n/** \u590D\u7528\u6570\u7EC4\uFF0Cflush \u65F6\u5012\u5165\u540E\u904D\u5386\u6267\u884C\uFF0C\u907F\u514D\u6BCF\u6B21 new Set \u5206\u914D */\nconst queueCopy: (() => void)[] = [];\nlet scheduled = false;\n\n/**\n * \u6E05\u7A7A\u5F53\u524D\u961F\u5217\u5E76\u4F9D\u6B21\u6267\u884C\u6240\u6709\u4EFB\u52A1\uFF08\u5728\u5FAE\u4EFB\u52A1\u4E2D\u8C03\u7528\uFF09\n */\nfunction flushQueue(): void {\n  scheduled = false;\n  queueCopy.length = 0;\n  for (const run of queue) queueCopy.push(run);\n  queue.clear();\n  for (const run of queueCopy) run();\n}\n\n/**\n * \u5C06\u4EFB\u52A1\u52A0\u5165\u961F\u5217\uFF0C\u5E76\u786E\u4FDD\u5728\u672C tick \u7684\u5FAE\u4EFB\u52A1\u4E2D\u6267\u884C flush\n * \u4F9B signal setter\u3001store set\u3001createEffect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u4F7F\u7528\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\n */\nexport function schedule(run: () => void): void {\n  queue.add(run);\n  if (!scheduled) {\n    scheduled = true;\n    if (typeof globalThis.queueMicrotask !== \"undefined\") {\n      globalThis.queueMicrotask(flushQueue);\n    } else if (typeof Promise !== \"undefined\") {\n      Promise.resolve().then(flushQueue);\n    } else {\n      setTimeout(flushQueue, 0);\n    }\n  }\n}\n\n/**\n * \u4ECE\u961F\u5217\u4E2D\u79FB\u9664\u4EFB\u52A1\uFF08\u5982 effect dispose \u65F6\u53D6\u6D88\u5C1A\u672A\u6267\u884C\u7684 run\uFF09\n */\nexport function unschedule(run: () => void): void {\n  queue.delete(run);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Signal\uFF08\u4FE1\u53F7\uFF09\n *\n * \u7EC6\u7C92\u5EA6\u54CD\u5E94\u5F0F\u5355\u5143\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u5F53\u524D effect \u4E3A\u4F9D\u8D56\uFF0Csetter \u6539\u503C\u5E76\u901A\u77E5\u6240\u6709\u4F9D\u8D56\u7684 effect \u6267\u884C\u3002\n * \u901A\u77E5\u901A\u8FC7\u8C03\u5EA6\u5668\u5F02\u6B65\u6267\u884C\uFF0C\u907F\u514D effect \u5185\u300C\u8BFB\u2192\u5199\u300D\u5BFC\u81F4\u540C\u6B65\u91CD\u5165\u5361\u6B7B\u4E3B\u7EBF\u7A0B\u3002\n */\n\nimport { schedule } from \"./scheduler.ts\";\n\n/** \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\uFF08run \u51FD\u6570\uFF09\uFF0C\u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\uFF1Brun \u4E0A\u53EF\u6302 _subscriptionSets \u4F9B\u6E05\u7406 */\ntype EffectRun = (() => void) & { _subscriptionSets?: Subscriber[] };\nlet currentEffect: EffectRun | null = null;\n\n/**\n * \u5728 effect \u6267\u884C\u671F\u95F4\u8C03\u7528\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D effect \u8BBE\u4E3A\u300C\u6B63\u5728\u6267\u884C\u300D\u4EE5\u4FBF signal \u7684 getter \u80FD\u767B\u8BB0\u4F9D\u8D56\n * @internal \u7531 effect.ts \u7684 createEffect \u4F7F\u7528\n */\nexport function setCurrentEffect(effect: (() => void) | null): void {\n  currentEffect = effect as EffectRun | null;\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\n * @internal\n */\nexport function getCurrentEffect(): (() => void) | null {\n  return currentEffect;\n}\n\n/** \u5355\u4E2A signal \u7684\u8BA2\u9605\u8005\uFF08effect \u7684\u91CD\u65B0\u6267\u884C\u51FD\u6570\uFF09\u5217\u8868 */\ntype Subscriber = Set<() => void>;\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u4FE1\u53F7\n *\n * @param initialValue \u521D\u59CB\u503C\n * @returns [getter, setter] \u5143\u7EC4\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u4F9D\u8D56\uFF0Csetter \u5199\u503C\u5E76\u901A\u77E5\u4F9D\u8D56\n *\n * @example\n * const [count, setCount] = createSignal(0);\n * createEffect(() => console.log(count())); // \u6BCF\u6B21 setCount \u540E\u90FD\u4F1A\u6253\u5370\n * setCount(1);\n */\nexport function createSignal<T>(\n  initialValue: T,\n): [() => T, (value: T | ((prev: T) => T)) => void] {\n  let value = initialValue;\n  const subscribers: Subscriber = new Set();\n\n  const getter = (): T => {\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n      if (currentEffect._subscriptionSets) {\n        currentEffect._subscriptionSets.push(subscribers);\n      }\n    }\n    return value;\n  };\n\n  const setter = (next: T | ((prev: T) => T)): void => {\n    const nextValue = typeof next === \"function\"\n      ? (next as (prev: T) => T)(value)\n      : next;\n    if (Object.is(value, nextValue)) {\n      return;\n    }\n    value = nextValue;\n    subscribers.forEach((run) => schedule(run));\n  };\n\n  return [markSignalGetter(getter), setter];\n}\n\n/**\n * \u5224\u65AD\u4E00\u4E2A\u51FD\u6570\u662F\u5426\u4E3A view \u7684 signal getter\uFF08\u7528\u4E8E dom \u5C42\u533A\u5206\u300C\u9700\u54CD\u5E94\u5F0F\u7ED1\u5B9A\u7684 prop\u300D\u4E0E\u666E\u901A\u51FD\u6570\u5982\u4E8B\u4EF6\u5904\u7406\uFF09\n * \u901A\u8FC7 getter \u4E0A\u6302\u8F7D\u7684\u6807\u8BB0\u5224\u65AD\u3002\n */\nexport const SIGNAL_GETTER_MARKER = Symbol.for(\"view.signalGetter\");\n\n/** \u7ED9 getter \u6253\u6807\u8BB0\uFF0C\u4F9B isSignalGetter \u4F7F\u7528 */\nexport function markSignalGetter<T>(getter: () => T): () => T {\n  (getter as unknown as { [SIGNAL_GETTER_MARKER]: true })[\n    SIGNAL_GETTER_MARKER\n  ] = true;\n  return getter;\n}\n\nexport function isSignalGetter(fn: unknown): fn is () => unknown {\n  return typeof fn === \"function\" &&\n    (fn as unknown as { [SIGNAL_GETTER_MARKER]?: boolean })[\n        SIGNAL_GETTER_MARKER\n      ] === true;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Effect\uFF08\u526F\u4F5C\u7528\uFF09\n *\n * \u6267\u884C\u7528\u6237\u51FD\u6570\u65F6\u767B\u8BB0\u6240\u8BFB\u5230\u7684 signal \u4E3A\u4F9D\u8D56\uFF1B\u5F53\u8FD9\u4E9B signal \u53D8\u66F4\u65F6\u81EA\u52A8\u91CD\u65B0\u6267\u884C effect\u3002\n * \u91CD\u65B0\u6267\u884C\u524D\u4F1A\u5148\u6E05\u7406\u4E0A\u6B21\u767B\u8BB0\u7684\u4F9D\u8D56\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\u3002\n * \u652F\u6301 EffectScope\uFF1A\u6839\u53EF\u6CE8\u518C\u6240\u6709\u5B50 effect \u7684 disposer\uFF0Cunmount \u65F6\u7EDF\u4E00\u6E05\u7406\u3002\n */\n\nimport { schedule, unschedule } from \"./scheduler.ts\";\nimport {\n  createSignal,\n  getCurrentEffect,\n  markSignalGetter,\n  setCurrentEffect,\n} from \"./signal.ts\";\nimport type { EffectDispose } from \"./types.ts\";\n\ntype EffectRunWithSubs = (() => void) & {\n  _subscriptionSets?: Set<() => void>[];\n  /** \u672C effect \u767B\u8BB0\u7684\u6E05\u7406\u51FD\u6570\uFF0C\u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C */\n  _cleanups?: (() => void)[];\n};\n\n/** \u5F53\u524D effect \u4F5C\u7528\u57DF\uFF08\u7531 createRoot \u8BBE\u7F6E\uFF09\uFF0C\u7528\u4E8E unmount \u65F6\u56DE\u6536\u8BE5\u6811\u4E0B\u6240\u6709 effect */\nexport type EffectScope = { addDisposer(dispose: () => void): void };\nlet currentScope: EffectScope | null = null;\n\nexport function getCurrentScope(): EffectScope | null {\n  return currentScope;\n}\n\nexport function setCurrentScope(scope: EffectScope | null): void {\n  currentScope = scope;\n}\n\n/** \u8C03\u5EA6 effect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u5230\u5FAE\u4EFB\u52A1\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\uFF08\u4E0E signal/store \u5171\u7528 scheduler\uFF09 */\nfunction scheduleEffect(run: () => void): void {\n  schedule(run);\n}\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u526F\u4F5C\u7528\n *\n * \u7ACB\u5373\u6267\u884C\u4E00\u6B21 fn\uFF1B\u6267\u884C\u8FC7\u7A0B\u4E2D\u8BFB\u5230\u7684 signal \u4F1A\u5C06\u8BE5 effect \u767B\u8BB0\u4E3A\u4F9D\u8D56\u3002\n * \u4E4B\u540E\u4EFB\u610F\u4F9D\u8D56\u7684 signal \u53D8\u66F4\u65F6\uFF0C\u4F1A\u8C03\u5EA6\u8BE5 effect \u91CD\u65B0\u6267\u884C\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\u3002\n *\n * @param fn \u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u53EF\u8FD4\u56DE\u6E05\u7406\u51FD\u6570\uFF08\u5728\u4E0B\u6B21\u6267\u884C\u524D\u6216 dispose \u65F6\u8C03\u7528\uFF09\n * @returns dispose \u51FD\u6570\uFF0C\u8C03\u7528\u540E\u53D6\u6D88\u8BE5 effect \u7684\u8BA2\u9605\u5E76\u4E0D\u518D\u6267\u884C\n */\n/**\n * \u5728\u5F53\u524D effect \u5185\u767B\u8BB0\u6E05\u7406\u51FD\u6570\uFF0Ceffect \u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C\n * \u4EC5\u5728 createEffect(fn) \u7684 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8C03\u7528\u6709\u6548\n */\nexport function onCleanup(cb: () => void): void {\n  const run = getCurrentEffect() as EffectRunWithSubs | null;\n  if (run?._cleanups) run._cleanups.push(cb);\n}\n\nfunction runCleanups(run: EffectRunWithSubs): void {\n  const list = run._cleanups;\n  if (list) {\n    for (const cb of list) cb();\n    list.length = 0;\n  }\n}\n\nexport function createEffect(fn: () => void | (() => void)): EffectDispose {\n  let disposed = false;\n\n  const run = (): void => {\n    if (disposed) return;\n    // \u82E5\u7531\u8C03\u5EA6\u5668\u89E6\u53D1\uFF08\u975E\u9996\u6B21\uFF09\uFF0C\u5148\u6267\u884C\u4E0A\u6B21\u767B\u8BB0\u7684 cleanups\n    runCleanups(run as EffectRunWithSubs);\n    // \u4ECE\u4E0A\u6B21\u4F9D\u8D56\u7684\u6240\u6709 signal \u8BA2\u9605\u5217\u8868\u4E2D\u79FB\u9664\u672C effect\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\n    const subs = (run as EffectRunWithSubs)._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    (run as EffectRunWithSubs)._cleanups = [];\n    const prev = getCurrentEffect();\n    (run as EffectRunWithSubs)._subscriptionSets = [];\n    setCurrentEffect(run);\n    try {\n      const nextDispose = fn();\n      if (typeof nextDispose === \"function\") {\n        (run as EffectRunWithSubs)._cleanups!.push(nextDispose);\n      }\n    } finally {\n      setCurrentEffect(prev);\n    }\n  };\n\n  const schedule = (): void => {\n    if (disposed) return;\n    runCleanups(run as EffectRunWithSubs);\n    scheduleEffect(run);\n  };\n\n  (run as EffectRunWithSubs)._subscriptionSets = [];\n  (run as EffectRunWithSubs)._cleanups = [];\n  run();\n\n  const disposer = (): void => {\n    if (disposed) return;\n    disposed = true;\n    const runWithSubs = run as EffectRunWithSubs;\n    const subs = runWithSubs._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    runCleanups(runWithSubs);\n    unschedule(schedule);\n  };\n  if (currentScope) currentScope.addDisposer(disposer);\n  return disposer;\n}\n\n/**\n * \u521B\u5EFA\u53EA\u8BFB\u6D3E\u751F\u503C\uFF08memo\uFF09\uFF0C\u4F9D\u8D56\u53D8\u5316\u65F6\u624D\u91CD\u7B97\u5E76\u7F13\u5B58\n * \u8FD4\u56DE getter\uFF0C\u5728 effect \u6216\u6A21\u677F\u4E2D\u8BFB\u53D6\u65F6\u4F1A\u767B\u8BB0\u4F9D\u8D56\n */\nexport function createMemo<T>(fn: () => T): () => T {\n  const [get, set] = createSignal<T>(undefined as unknown as T);\n  createEffect(() => set(fn()));\n  return markSignalGetter(get) as () => T;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 DOM \u5C42\u5171\u4EAB\u7C7B\u578B\u4E0E\u5DE5\u5177\n *\n * Fragment\u3001IfContext\u3001SSROptions\u3001isFragment\u3001isVNodeLike \u7B49\uFF0C\u4F9B element / stringify / hydrate \u590D\u7528\n */\n\nimport type { VNode } from \"../types.ts\";\n\n/** Fragment \u7684 type \u6807\u8BB0\uFF0C\u4E0D\u521B\u5EFA\u771F\u5B9E\u8282\u70B9\uFF0C\u4EC5\u7528\u4E8E\u5305\u88F9\u5B50\u8282\u70B9 */\nexport const FragmentType = Symbol.for(\"view.fragment\");\n\n/** \u5224\u65AD\u662F\u5426\u4E3A Fragment \u8282\u70B9 */\nexport function isFragment(vnode: VNode): boolean {\n  return vnode.type === FragmentType || (vnode.type as unknown) === \"Fragment\";\n}\n\n/** v-if / v-else \u5144\u5F1F\u94FE\u7684\u4E0A\u4E0B\u6587\uFF0C\u7528\u4E8E vElse \u5224\u65AD\u201C\u4E0A\u4E00\u4E2A vIf \u662F\u5426\u4E3A false\u201D */\nexport type IfContext = { lastVIf: boolean };\n\n/**\n * SSR \u9009\u9879\uFF1AallowRawHtml \u4E3A false \u65F6 v-html / dangerouslySetInnerHTML \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF08\u5B89\u5168\u573A\u666F\uFF09\n * \u9ED8\u8BA4\u670D\u52A1\u7AEF v-html \u540C\u6837\u4E0D\u8F6C\u4E49\uFF0C\u4E0E\u5BA2\u6237\u7AEF\u4E00\u81F4\uFF1B\u82E5\u9700\u7981\u6B62\u539F\u59CB HTML \u53EF\u4F20 allowRawHtml: false\n */\nexport type SSROptions = { allowRawHtml?: boolean };\n\n/** \u5224\u65AD\u662F\u5426\u5F62\u5982 VNode\uFF08\u542B type\u3001props\uFF09 */\nexport function isVNodeLike(x: unknown): boolean {\n  return typeof x === \"object\" && x !== null && \"type\" in x && \"props\" in x;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 JSX \u8FD0\u884C\u65F6\n *\n * \u4F9B jsxImportSource: \"view\" \u4F7F\u7528\uFF0C\u4E0E react-jsx \u8F6C\u6362\u517C\u5BB9\u3002\n * \u5BFC\u51FA jsx\u3001jsxs\u3001Fragment\uFF0C\u4EA7\u51FA VNode \u4F9B dom / runtime \u6D88\u8D39\u3002\n */\n\nimport { FragmentType } from \"./dom.ts\";\nimport type { VNode } from \"./types.ts\";\n\n/** Fragment \u7EC4\u4EF6\uFF1A\u7528\u4E8E <>...</> \u6216 <Fragment>...</Fragment>\uFF0C\u4E0D\u4EA7\u751F\u771F\u5B9E DOM \u8282\u70B9 */\nexport const Fragment = FragmentType;\n\n/**\n * \u89C4\u8303\u5316 props\uFF1A\u63D0\u53D6 key\u3001children\uFF0C\u8FD4\u56DE\u4F9B VNode \u4F7F\u7528\u7684 props \u4E0E key\n */\nfunction normalizeProps(\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): { props: Record<string, unknown>; key?: string | number | null } {\n  const p = props ?? {};\n  // \u7B2C\u4E09\u53C2 maybeKey \u8986\u76D6 props.key\uFF08\u4E0E React automatic runtime \u4E00\u81F4\uFF09\n  const key =\n    (maybeKey !== undefined && maybeKey !== null\n      ? maybeKey\n      : (p.key as string | number | null | undefined)) ?? null;\n  const { key: _k, ...rest } = p as Record<string, unknown> & { key?: unknown };\n  return { props: rest, key: key ?? undefined };\n}\n\n/**\n * jsx(type, props, maybeKey?)\n * \u4E0E React 17+ automatic JSX runtime \u517C\u5BB9\uFF0C\u7528\u4E8E\u52A8\u6001\u5B50\u8282\u70B9\u573A\u666F\n */\nexport function jsx(\n  type: VNode[\"type\"],\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): VNode {\n  const { props: p, key } = normalizeProps(props, maybeKey);\n  return { type, props: p, key, children: p.children as VNode[] | undefined };\n}\n\n/**\n * jsxs(type, props, maybeKey?)\n * \u4E0E React 17+ automatic JSX runtime \u517C\u5BB9\uFF0C\u7528\u4E8E\u9759\u6001\u5B50\u8282\u70B9\u573A\u666F\uFF08\u5B50\u8282\u70B9\u4E3A\u6570\u7EC4\uFF09\n */\nexport function jsxs(\n  type: VNode[\"type\"],\n  props: Record<string, unknown> | null,\n  maybeKey?: string | number | null,\n): VNode {\n  const { props: p, key } = normalizeProps(props, maybeKey);\n  return { type, props: p, key, children: p.children as VNode[] | undefined };\n}\n\n/**\n * JSX intrinsic \u5143\u7D20\u7C7B\u578B\uFF1A\u4F9B TSX \u4E2D DOM \u6807\u7B7E\u7C7B\u578B\u68C0\u67E5\u4F7F\u7528\u3002\n * \u4F7F\u7528 jsxImportSource: \"@dreamer/view\" \u65F6\u7F16\u8BD1\u5668\u4F1A\u4F7F\u7528\u6B64\u547D\u540D\u7A7A\u95F4\u3002\n * \u56E0\u5305\u542B declare global\uFF0CJSR \u53D1\u5E03\u9700\u4F7F\u7528 --allow-slow-types\u3002\n */\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      [tag: string]: Record<string, unknown>;\n    }\n  }\n}\n", "/**\n * @dreamer/view/boundary \u2014 \u6309\u9700\u5BFC\u5165\n *\n * \u4EC5\u4FDD\u7559 Suspense\u3001ErrorBoundary\u3002\u6761\u4EF6/\u5217\u8868\u6E32\u67D3\u8BF7\u7528\u6307\u4EE4\uFF1Av-if / v-else / v-else-if / v-for\u3002\n * Suspense \u652F\u6301 Promise \u5B50\u8282\u70B9\uFF1BErrorBoundary \u6355\u83B7\u5B50\u6811\u9519\u8BEF\u3002\n */\n\nimport { createEffect } from \"./effect.ts\";\nimport { createSignal, markSignalGetter } from \"./signal.ts\";\nimport { Fragment, jsx } from \"./jsx-runtime.ts\";\nimport type { VNode } from \"./types.ts\";\n\nfunction valueOf<T>(v: T | (() => T)): T {\n  return typeof v === \"function\" ? (v as () => T)() : v;\n}\n\n/** ErrorBoundary \u7EC4\u4EF6\u5F15\u7528\uFF0C\u4F9B dom \u505A try/catch \u65F6\u8BC6\u522B */\nexport function isErrorBoundary(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n): boolean {\n  return component === ErrorBoundary;\n}\n\n/** \u4ECE ErrorBoundary \u7684 props \u4E2D\u53D6 fallback \u51FD\u6570\uFF1A(error) => VNode */\nexport function getErrorBoundaryFallback(\n  props: Record<string, unknown>,\n): (error: unknown) => VNode {\n  const fb = props.fallback;\n  if (typeof fb === \"function\") return fb as (error: unknown) => VNode;\n  const vnode: VNode = (fb != null && typeof fb === \"object\" && \"type\" in fb)\n    ? fb as VNode\n    : { type: \"#text\", props: { nodeValue: String(fb) }, children: [] };\n  return () => vnode;\n}\n\n/**\n * \u9519\u8BEF\u8FB9\u754C\uFF1A\u6355\u83B7\u5B50\u6811\u6E32\u67D3\u4E2D\u7684\u9519\u8BEF\uFF0C\u663E\u793A fallback(error)\n * \u4EC5\u6355\u83B7\u5B50\u7EC4\u4EF6\u6267\u884C\u6216\u5B50 VNode \u521B\u5EFA\u65F6\u7684\u540C\u6B65\u9519\u8BEF\u3002\n */\nexport function ErrorBoundary(props: {\n  fallback: (error: unknown) => VNode;\n  children?: VNode | VNode[] | (() => VNode | VNode[]);\n}): VNode | VNode[] | null {\n  return (props.children ?? null) as VNode | VNode[] | null;\n}\n\n/**\n * \u5F02\u6B65\u8FB9\u754C\uFF1Achildren \u4E3A Promise<VNode> \u6216 getter \u8FD4\u56DE Promise \u65F6\u5148\u663E\u793A fallback\uFF0Cresolve \u540E\u663E\u793A\u5185\u5BB9\n * \u4E0E createResource \u914D\u5408\uFF1Aresource().loading \u65F6\u663E\u793A fallback\uFF0C\u6709 data \u65F6\u663E\u793A\u5185\u5BB9\n */\nexport function Suspense(props: {\n  fallback: VNode | (() => VNode);\n  children: VNode | (() => VNode) | (() => Promise<VNode>) | Promise<VNode>;\n}): VNode {\n  const [resolved, setResolved] = createSignal<VNode | null>(null);\n  /** \u6BCF\u6B21 effect \u8FD0\u884C\u9012\u589E\uFF1Bdispose \u65F6\u7F6E\u4E3A -1\uFF0CPromise \u56DE\u8C03\u4EC5\u5F53 gen === generation \u65F6\u624D setResolved\uFF0C\u907F\u514D unmount \u540E\u6216\u65E7 run \u7684 promise \u8BEF\u66F4\u65B0 */\n  let generation = 0;\n  createEffect(() => {\n    const gen = ++generation;\n    const c = valueOf(props.children);\n    if (c != null && typeof (c as Promise<unknown>).then === \"function\") {\n      (c as Promise<VNode>).then((v) => {\n        if (gen === generation) setResolved(v ?? null);\n      });\n    } else {\n      setResolved((c as VNode) ?? null);\n    }\n    return () => {\n      generation = -1;\n    };\n  });\n  const getter = () => resolved() ?? valueOf(props.fallback);\n  return jsx(Fragment, { children: markSignalGetter(getter) });\n}\n"],
  "mappings": "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",
  "names": ["queue", "queueCopy", "scheduled", "flushQueue", "run", "schedule", "unschedule", "currentEffect", "setCurrentEffect", "effect", "getCurrentEffect", "createSignal", "initialValue", "value", "subscribers", "getter", "setter", "next", "nextValue", "run", "schedule", "markSignalGetter", "SIGNAL_GETTER_MARKER", "currentScope", "scheduleEffect", "run", "schedule", "runCleanups", "run", "list", "cb", "createEffect", "fn", "disposed", "subs", "prev", "getCurrentEffect", "setCurrentEffect", "nextDispose", "schedule", "scheduleEffect", "disposer", "runWithSubs", "unschedule", "currentScope", "FragmentType", "Fragment", "FragmentType", "normalizeProps", "props", "maybeKey", "p", "key", "_k", "rest", "jsx", "type", "valueOf", "v", "isErrorBoundary", "component", "ErrorBoundary", "getErrorBoundaryFallback", "props", "fb", "vnode", "Suspense", "resolved", "setResolved", "createSignal", "generation", "createEffect", "gen", "c", "jsx", "Fragment", "markSignalGetter"]
}
