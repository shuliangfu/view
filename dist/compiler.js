import*as t from"npm:typescript@5.9";var i=t.factory;function p(a){function n(e){if(t.isBinaryExpression(e)){let s=e.left,r=e.right,u=e.operatorToken.kind;if(t.isNumericLiteral(s)&&t.isNumericLiteral(r)){let c=Number(s.text),o=Number(r.text),l;switch(u){case t.SyntaxKind.PlusToken:l=c+o;break;case t.SyntaxKind.MinusToken:l=c-o;break;case t.SyntaxKind.AsteriskToken:l=c*o;break;case t.SyntaxKind.SlashToken:l=o===0?void 0:c/o;break;case t.SyntaxKind.PercentToken:l=o===0?void 0:c%o;break;case t.SyntaxKind.LessThanToken:return c<o?i.createTrue():i.createFalse();case t.SyntaxKind.GreaterThanToken:return c>o?i.createTrue():i.createFalse();case t.SyntaxKind.LessThanEqualsToken:return c<=o?i.createTrue():i.createFalse();case t.SyntaxKind.GreaterThanEqualsToken:return c>=o?i.createTrue():i.createFalse();case t.SyntaxKind.EqualsEqualsToken:case t.SyntaxKind.EqualsEqualsEqualsToken:return c===o?i.createTrue():i.createFalse();case t.SyntaxKind.ExclamationEqualsToken:case t.SyntaxKind.ExclamationEqualsEqualsToken:return c!==o?i.createTrue():i.createFalse();default:break}if(typeof l=="number"&&Number.isFinite(l))return i.createNumericLiteral(l)}if(t.isStringLiteral(s)&&t.isStringLiteral(r)&&u===t.SyntaxKind.PlusToken)return i.createStringLiteral(s.text+r.text)}if(t.isPrefixUnaryExpression(e)){let s=e.operand,r=e.operator;if(t.isNumericLiteral(s)){let u=Number(s.text);if(r===t.SyntaxKind.MinusToken)return i.createNumericLiteral(-u);if(r===t.SyntaxKind.PlusToken)return i.createNumericLiteral(u)}}return t.visitEachChild(e,n,a)}return e=>t.visitNode(e,n)}function d(a){for(let n of a.properties){if(t.isSpreadAssignment(n)||t.isShorthandPropertyAssignment(n))return!1;if(t.isPropertyAssignment(n)){let e=n.initializer;if(t.isNumericLiteral(e)||t.isStringLiteral(e)||e.kind===t.SyntaxKind.TrueKeyword||e.kind===t.SyntaxKind.FalseKeyword||t.isObjectLiteralExpression(e)&&d(e))continue;if(t.isArrayLiteralExpression(e)){for(let s of e.elements)if(!t.isNumericLiteral(s)&&!t.isStringLiteral(s)&&s.kind!==t.SyntaxKind.TrueKeyword&&s.kind!==t.SyntaxKind.FalseKeyword)return!1;continue}return!1}}return!0}function x(a){let n=t.isIdentifier(a.expression)?a.expression.text:t.isPropertyAccessExpression(a.expression)?a.expression.name.text:"";if(n!=="jsx"&&n!=="jsxs"||a.arguments.length<2)return!1;let[e,s]=a.arguments;return!t.isStringLiteral(e)&&!t.isNoSubstitutionTemplateLiteral(e)||!t.isObjectLiteralExpression(s)?!1:d(s)}var f=0;function S(){return`__view_hoist_${f++}`}function m(a){let n=[];function e(s){if(t.isCallExpression(s)&&x(s)){let r=S();return n.push(i.createVariableStatement([i.createModifier(t.SyntaxKind.ConstKeyword)],i.createVariableDeclarationList([i.createVariableDeclaration(r,void 0,void 0,s)],t.NodeFlags.Const))),i.createIdentifier(r)}return t.visitEachChild(s,e,a)}return s=>{f=0,n.length=0;let r=t.visitEachChild(s,e,a);if(n.length===0)return r;let u=[...n,...r.statements];return i.updateSourceFile(r,u,r.isDeclarationFile,r.referencedFiles,r.typeReferenceDirectives,r.hasNoDefaultLib)}}function g(a,n="source.tsx"){let e=t.createSourceFile(n,a,t.ScriptTarget.Latest,!0,n.endsWith(".tsx")?t.ScriptKind.TSX:t.ScriptKind.TS),r=t.transform(e,[p,m]).transformed[0];return t.createPrinter({newLine:t.NewLineKind.LineFeed}).printFile(r)}function T(a=/\.(tsx?|jsx?)$/,n){let e=n??(s=>globalThis.Deno?.readTextFile(s)??Promise.resolve(""));return{name:"view-optimize",setup(s){s.onLoad({filter:a},async r=>{let u=await e(r.path).catch(()=>"");return{contents:g(u,r.path)}})}}}export{T as createOptimizePlugin,g as optimize};
//# sourceMappingURL=compiler.js.map
