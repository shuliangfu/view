function x(){try{let e=globalThis;return typeof e.location<"u"&&typeof e.history<"u"}catch{return!1}}function Q(e){let r=[],l=e.split("/").filter(Boolean).map(a=>a.startsWith(":")?(r.push(a.slice(1)),"([^/]+)"):a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),i="^/"+(l.length?l.join("/"):"")+"$";return{regex:new RegExp(i),paramNames:r}}function V(e){let r={};if(!e||e==="?")return r;let s=e.startsWith("?")?e.slice(1):e;for(let l of s.split("&")){let[i,a]=l.split("=").map(decodeURIComponent);i&&(r[i]=a??"")}return r}function U(e){let r=globalThis;if(!r.location)return{path:"",search:""};let s=r.location.pathname||"/",l=r.location.search||"",i=e.basePath.replace(/\/$/,"");return i&&s.startsWith(i)&&(s=s.slice(i.length)||"/"),{path:s,search:l}}function j(e){let{routes:r,basePath:s="",interceptLinks:l=!0,notFound:i,beforeRoute:a,afterRoute:v,maxRedirects:$=5}=e,m=i??null,L=a==null?[]:Array.isArray(a)?a:[a],A=v==null?[]:Array.isArray(v)?v:[v],T=r.map(t=>({...t,...Q(t.path)})),R=[],d=null,p=null;function C(){return U({basePath:s})}function M(t,n){let u=t.replace(/\?.*$/,"").replace(/#.*$/,"")||"/",g=V(n);for(let o of T){let f=u.match(o.regex);if(!f)continue;let c={};return o.paramNames.forEach((k,y)=>{c[k]=f[y+1]??""}),{path:o.path,params:c,query:g,fullPath:u+(n||""),component:o.component,meta:o.meta}}return m?{path:m.path,params:{},query:g,fullPath:u+(n||""),component:m.component,meta:m.meta}:null}function E(){let{path:t,search:n}=C();return M(t,n)}function P(){R.forEach(t=>t())}function G(t,n){let u=t.replace(/\?.*$/,"").replace(/#.*$/,"")||"/";return M(u,n)}async function b(t,n=!1,u=0){if(!x()||u>$)return;let g=E(),o=t.startsWith("/")?t:"/"+t,f=G(o,"");for(let w of L){let h=await Promise.resolve(w(f,g));if(h===!1)return;if(typeof h=="string"){await b(h,n,u+1);return}}let c=globalThis,k=s.replace(/\/$/,"")||"",y=`${c.location?.origin??""}${k}${o}`;try{n?c.history?.replaceState(null,"",y):c.history?.pushState(null,"",y),P();let w=E();for(let h of A)await Promise.resolve(h(w,g))}catch{}}function W(t){let n=t.startsWith("/")?t:"/"+t;return`${s.replace(/\/$/,"")||""}${n}`}function N(t){return b(t,!0)}function O(){globalThis.history?.back()}function F(){globalThis.history?.forward()}function H(t){globalThis.history?.go(t)}function S(t){return R.push(t),()=>{let n=R.indexOf(t);n!==-1&&R.splice(n,1)}}function q(){if(!x())return;let t=globalThis;p=()=>P(),t.addEventListener?.("popstate",p),l&&t.document&&(d=n=>{let g=n.target?.closest?.("a");if(!g||n.ctrlKey||n.metaKey||n.shiftKey||n.button!==0)return;let o=g.getAttribute("href");if(!(!o||o.startsWith("mailto:")||o.startsWith("tel:"))&&!o.startsWith("#"))try{let f=new URL(o,globalThis.location?.href);if(f.origin!==globalThis.location?.origin)return;n.preventDefault();let c=f.pathname+f.search;b(c.startsWith("/")?c:"/"+c)}catch{}},t.document.addEventListener("click",d))}function K(){let t=globalThis;p&&(t.removeEventListener?.("popstate",p),p=null),d&&t.document&&(t.document.removeEventListener("click",d),d=null)}return{getCurrentRoute:E,href:W,navigate:b,replace:N,back:O,forward:F,go:H,subscribe:S,start:q,stop:K}}export{j as createRouter};
//# sourceMappingURL=router.js.map
