{
  "version": 3,
  "sources": ["../src/scheduler.ts", "../src/signal.ts", "../src/effect.ts", "../src/dom/shared.ts", "../src/dom/unmount.ts", "../src/types.ts", "../src/boundary.ts", "../src/directive.ts", "../src/context.ts", "../src/dom/props.ts", "../src/dom/element.ts", "../src/dom/stringify.ts", "../src/dom/hydrate.ts", "../src/runtime.ts"],
  "sourcesContent": ["/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u8C03\u5EA6\u5668\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\n *\n * \u4F9B signal\u3001store\u3001effect \u5171\u7528\uFF1A\u8BA2\u9605\u8005/effect \u4E0D\u5728\u6B64 tick \u5185\u540C\u6B65\u6267\u884C\uFF0C\u800C\u662F\u52A0\u5165\u961F\u5217\uFF0C\n * \u7531\u4E00\u6B21\u5FAE\u4EFB\u52A1\u7EDF\u4E00 flush\uFF0C\u907F\u514D\u300C\u5199 \u2192 \u7ACB\u5373\u8DD1 effect \u2192 \u518D\u5199\u300D\u7684\u540C\u6B65\u91CD\u5165\u5BFC\u81F4\u4E3B\u7EBF\u7A0B\u5361\u6B7B\u3002\n */\n\n/** \u5F85\u6267\u884C\u7684\u4EFB\u52A1\u961F\u5217\uFF0C\u540C\u4E00 tick \u5185\u591A\u6B21\u5199\u5165\u53EA\u89E6\u53D1\u4E00\u6B21\u5FAE\u4EFB\u52A1 flush */\nconst queue = new Set<() => void>();\n/** \u590D\u7528\u6570\u7EC4\uFF0Cflush \u65F6\u5012\u5165\u540E\u904D\u5386\u6267\u884C\uFF0C\u907F\u514D\u6BCF\u6B21 new Set \u5206\u914D */\nconst queueCopy: (() => void)[] = [];\nlet scheduled = false;\n\n/**\n * \u6E05\u7A7A\u5F53\u524D\u961F\u5217\u5E76\u4F9D\u6B21\u6267\u884C\u6240\u6709\u4EFB\u52A1\uFF08\u5728\u5FAE\u4EFB\u52A1\u4E2D\u8C03\u7528\uFF09\n */\nfunction flushQueue(): void {\n  scheduled = false;\n  queueCopy.length = 0;\n  for (const run of queue) queueCopy.push(run);\n  queue.clear();\n  for (const run of queueCopy) run();\n}\n\n/**\n * \u5C06\u4EFB\u52A1\u52A0\u5165\u961F\u5217\uFF0C\u5E76\u786E\u4FDD\u5728\u672C tick \u7684\u5FAE\u4EFB\u52A1\u4E2D\u6267\u884C flush\n * \u4F9B signal setter\u3001store set\u3001createEffect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u4F7F\u7528\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\n */\nexport function schedule(run: () => void): void {\n  queue.add(run);\n  if (!scheduled) {\n    scheduled = true;\n    if (typeof globalThis.queueMicrotask !== \"undefined\") {\n      globalThis.queueMicrotask(flushQueue);\n    } else if (typeof Promise !== \"undefined\") {\n      Promise.resolve().then(flushQueue);\n    } else {\n      setTimeout(flushQueue, 0);\n    }\n  }\n}\n\n/**\n * \u4ECE\u961F\u5217\u4E2D\u79FB\u9664\u4EFB\u52A1\uFF08\u5982 effect dispose \u65F6\u53D6\u6D88\u5C1A\u672A\u6267\u884C\u7684 run\uFF09\n */\nexport function unschedule(run: () => void): void {\n  queue.delete(run);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Signal\uFF08\u4FE1\u53F7\uFF09\n *\n * \u7EC6\u7C92\u5EA6\u54CD\u5E94\u5F0F\u5355\u5143\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u5F53\u524D effect \u4E3A\u4F9D\u8D56\uFF0Csetter \u6539\u503C\u5E76\u901A\u77E5\u6240\u6709\u4F9D\u8D56\u7684 effect \u6267\u884C\u3002\n * \u901A\u77E5\u901A\u8FC7\u8C03\u5EA6\u5668\u5F02\u6B65\u6267\u884C\uFF0C\u907F\u514D effect \u5185\u300C\u8BFB\u2192\u5199\u300D\u5BFC\u81F4\u540C\u6B65\u91CD\u5165\u5361\u6B7B\u4E3B\u7EBF\u7A0B\u3002\n */\n\nimport { schedule } from \"./scheduler.ts\";\n\n/** \u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\uFF08run \u51FD\u6570\uFF09\uFF0C\u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\uFF1Brun \u4E0A\u53EF\u6302 _subscriptionSets \u4F9B\u6E05\u7406 */\ntype EffectRun = (() => void) & { _subscriptionSets?: Subscriber[] };\nlet currentEffect: EffectRun | null = null;\n\n/**\n * \u5728 effect \u6267\u884C\u671F\u95F4\u8C03\u7528\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D effect \u8BBE\u4E3A\u300C\u6B63\u5728\u6267\u884C\u300D\u4EE5\u4FBF signal \u7684 getter \u80FD\u767B\u8BB0\u4F9D\u8D56\n * @internal \u7531 effect.ts \u7684 createEffect \u4F7F\u7528\n */\nexport function setCurrentEffect(effect: (() => void) | null): void {\n  currentEffect = effect as EffectRun | null;\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u6267\u884C\u7684 effect\n * @internal\n */\nexport function getCurrentEffect(): (() => void) | null {\n  return currentEffect;\n}\n\n/** \u5355\u4E2A signal \u7684\u8BA2\u9605\u8005\uFF08effect \u7684\u91CD\u65B0\u6267\u884C\u51FD\u6570\uFF09\u5217\u8868 */\ntype Subscriber = Set<() => void>;\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u4FE1\u53F7\n *\n * @param initialValue \u521D\u59CB\u503C\n * @returns [getter, setter] \u5143\u7EC4\uFF1Agetter \u8BFB\u503C\u5E76\u767B\u8BB0\u4F9D\u8D56\uFF0Csetter \u5199\u503C\u5E76\u901A\u77E5\u4F9D\u8D56\n *\n * @example\n * const [count, setCount] = createSignal(0);\n * createEffect(() => console.log(count())); // \u6BCF\u6B21 setCount \u540E\u90FD\u4F1A\u6253\u5370\n * setCount(1);\n */\nexport function createSignal<T>(\n  initialValue: T,\n): [() => T, (value: T | ((prev: T) => T)) => void] {\n  let value = initialValue;\n  const subscribers: Subscriber = new Set();\n\n  const getter = (): T => {\n    if (currentEffect) {\n      subscribers.add(currentEffect);\n      if (currentEffect._subscriptionSets) {\n        currentEffect._subscriptionSets.push(subscribers);\n      }\n    }\n    return value;\n  };\n\n  const setter = (next: T | ((prev: T) => T)): void => {\n    const nextValue = typeof next === \"function\"\n      ? (next as (prev: T) => T)(value)\n      : next;\n    if (Object.is(value, nextValue)) {\n      return;\n    }\n    value = nextValue;\n    subscribers.forEach((run) => schedule(run));\n  };\n\n  return [markSignalGetter(getter), setter];\n}\n\n/**\n * \u5224\u65AD\u4E00\u4E2A\u51FD\u6570\u662F\u5426\u4E3A view \u7684 signal getter\uFF08\u7528\u4E8E dom \u5C42\u533A\u5206\u300C\u9700\u54CD\u5E94\u5F0F\u7ED1\u5B9A\u7684 prop\u300D\u4E0E\u666E\u901A\u51FD\u6570\u5982\u4E8B\u4EF6\u5904\u7406\uFF09\n * \u901A\u8FC7 getter \u4E0A\u6302\u8F7D\u7684\u6807\u8BB0\u5224\u65AD\u3002\n */\nexport const SIGNAL_GETTER_MARKER = Symbol.for(\"view.signalGetter\");\n\n/** \u7ED9 getter \u6253\u6807\u8BB0\uFF0C\u4F9B isSignalGetter \u4F7F\u7528 */\nexport function markSignalGetter<T>(getter: () => T): () => T {\n  (getter as unknown as { [SIGNAL_GETTER_MARKER]: true })[\n    SIGNAL_GETTER_MARKER\n  ] = true;\n  return getter;\n}\n\nexport function isSignalGetter(fn: unknown): fn is () => unknown {\n  return typeof fn === \"function\" &&\n    (fn as unknown as { [SIGNAL_GETTER_MARKER]?: boolean })[\n        SIGNAL_GETTER_MARKER\n      ] === true;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Effect\uFF08\u526F\u4F5C\u7528\uFF09\n *\n * \u6267\u884C\u7528\u6237\u51FD\u6570\u65F6\u767B\u8BB0\u6240\u8BFB\u5230\u7684 signal \u4E3A\u4F9D\u8D56\uFF1B\u5F53\u8FD9\u4E9B signal \u53D8\u66F4\u65F6\u81EA\u52A8\u91CD\u65B0\u6267\u884C effect\u3002\n * \u91CD\u65B0\u6267\u884C\u524D\u4F1A\u5148\u6E05\u7406\u4E0A\u6B21\u767B\u8BB0\u7684\u4F9D\u8D56\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\u3002\n * \u652F\u6301 EffectScope\uFF1A\u6839\u53EF\u6CE8\u518C\u6240\u6709\u5B50 effect \u7684 disposer\uFF0Cunmount \u65F6\u7EDF\u4E00\u6E05\u7406\u3002\n */\n\nimport { schedule, unschedule } from \"./scheduler.ts\";\nimport {\n  createSignal,\n  getCurrentEffect,\n  markSignalGetter,\n  setCurrentEffect,\n} from \"./signal.ts\";\nimport type { EffectDispose } from \"./types.ts\";\n\ntype EffectRunWithSubs = (() => void) & {\n  _subscriptionSets?: Set<() => void>[];\n  /** \u672C effect \u767B\u8BB0\u7684\u6E05\u7406\u51FD\u6570\uFF0C\u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C */\n  _cleanups?: (() => void)[];\n};\n\n/** \u5F53\u524D effect \u4F5C\u7528\u57DF\uFF08\u7531 createRoot \u8BBE\u7F6E\uFF09\uFF0C\u7528\u4E8E unmount \u65F6\u56DE\u6536\u8BE5\u6811\u4E0B\u6240\u6709 effect */\nexport type EffectScope = { addDisposer(dispose: () => void): void };\nlet currentScope: EffectScope | null = null;\n\nexport function getCurrentScope(): EffectScope | null {\n  return currentScope;\n}\n\nexport function setCurrentScope(scope: EffectScope | null): void {\n  currentScope = scope;\n}\n\n/** \u8C03\u5EA6 effect \u7684\u300C\u4E0B\u6B21\u6267\u884C\u300D\u5230\u5FAE\u4EFB\u52A1\uFF0C\u907F\u514D\u540C\u6B65\u91CD\u5165\uFF08\u4E0E signal/store \u5171\u7528 scheduler\uFF09 */\nfunction scheduleEffect(run: () => void): void {\n  schedule(run);\n}\n\n/**\n * \u521B\u5EFA\u54CD\u5E94\u5F0F\u526F\u4F5C\u7528\n *\n * \u7ACB\u5373\u6267\u884C\u4E00\u6B21 fn\uFF1B\u6267\u884C\u8FC7\u7A0B\u4E2D\u8BFB\u5230\u7684 signal \u4F1A\u5C06\u8BE5 effect \u767B\u8BB0\u4E3A\u4F9D\u8D56\u3002\n * \u4E4B\u540E\u4EFB\u610F\u4F9D\u8D56\u7684 signal \u53D8\u66F4\u65F6\uFF0C\u4F1A\u8C03\u5EA6\u8BE5 effect \u91CD\u65B0\u6267\u884C\uFF08\u5FAE\u4EFB\u52A1\u6279\u5904\u7406\uFF09\u3002\n *\n * @param fn \u526F\u4F5C\u7528\u51FD\u6570\uFF0C\u53EF\u8FD4\u56DE\u6E05\u7406\u51FD\u6570\uFF08\u5728\u4E0B\u6B21\u6267\u884C\u524D\u6216 dispose \u65F6\u8C03\u7528\uFF09\n * @returns dispose \u51FD\u6570\uFF0C\u8C03\u7528\u540E\u53D6\u6D88\u8BE5 effect \u7684\u8BA2\u9605\u5E76\u4E0D\u518D\u6267\u884C\n */\n/**\n * \u5728\u5F53\u524D effect \u5185\u767B\u8BB0\u6E05\u7406\u51FD\u6570\uFF0Ceffect \u4E0B\u6B21\u8FD0\u884C\u524D\u6216 dispose \u65F6\u7EDF\u4E00\u6267\u884C\n * \u4EC5\u5728 createEffect(fn) \u7684 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8C03\u7528\u6709\u6548\n */\nexport function onCleanup(cb: () => void): void {\n  const run = getCurrentEffect() as EffectRunWithSubs | null;\n  if (run?._cleanups) run._cleanups.push(cb);\n}\n\nfunction runCleanups(run: EffectRunWithSubs): void {\n  const list = run._cleanups;\n  if (list) {\n    for (const cb of list) cb();\n    list.length = 0;\n  }\n}\n\nexport function createEffect(fn: () => void | (() => void)): EffectDispose {\n  let disposed = false;\n\n  const run = (): void => {\n    if (disposed) return;\n    // \u82E5\u7531\u8C03\u5EA6\u5668\u89E6\u53D1\uFF08\u975E\u9996\u6B21\uFF09\uFF0C\u5148\u6267\u884C\u4E0A\u6B21\u767B\u8BB0\u7684 cleanups\n    runCleanups(run as EffectRunWithSubs);\n    // \u4ECE\u4E0A\u6B21\u4F9D\u8D56\u7684\u6240\u6709 signal \u8BA2\u9605\u5217\u8868\u4E2D\u79FB\u9664\u672C effect\uFF0C\u518D\u91CD\u65B0\u6536\u96C6\n    const subs = (run as EffectRunWithSubs)._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    (run as EffectRunWithSubs)._cleanups = [];\n    const prev = getCurrentEffect();\n    (run as EffectRunWithSubs)._subscriptionSets = [];\n    setCurrentEffect(run);\n    try {\n      const nextDispose = fn();\n      if (typeof nextDispose === \"function\") {\n        (run as EffectRunWithSubs)._cleanups!.push(nextDispose);\n      }\n    } finally {\n      setCurrentEffect(prev);\n    }\n  };\n\n  const schedule = (): void => {\n    if (disposed) return;\n    runCleanups(run as EffectRunWithSubs);\n    scheduleEffect(run);\n  };\n\n  (run as EffectRunWithSubs)._subscriptionSets = [];\n  (run as EffectRunWithSubs)._cleanups = [];\n  run();\n\n  const disposer = (): void => {\n    if (disposed) return;\n    disposed = true;\n    const runWithSubs = run as EffectRunWithSubs;\n    const subs = runWithSubs._subscriptionSets;\n    if (subs) {\n      for (const s of subs) s.delete(run);\n      subs.length = 0;\n    }\n    runCleanups(runWithSubs);\n    unschedule(schedule);\n  };\n  if (currentScope) currentScope.addDisposer(disposer);\n  return disposer;\n}\n\n/**\n * \u521B\u5EFA\u53EA\u8BFB\u6D3E\u751F\u503C\uFF08memo\uFF09\uFF0C\u4F9D\u8D56\u53D8\u5316\u65F6\u624D\u91CD\u7B97\u5E76\u7F13\u5B58\n * \u8FD4\u56DE getter\uFF0C\u5728 effect \u6216\u6A21\u677F\u4E2D\u8BFB\u53D6\u65F6\u4F1A\u767B\u8BB0\u4F9D\u8D56\n */\nexport function createMemo<T>(fn: () => T): () => T {\n  const [get, set] = createSignal<T>(undefined as unknown as T);\n  createEffect(() => set(fn()));\n  return markSignalGetter(get) as () => T;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 DOM \u5C42\u5171\u4EAB\u7C7B\u578B\u4E0E\u5DE5\u5177\n *\n * Fragment\u3001IfContext\u3001SSROptions\u3001isFragment\u3001isVNodeLike \u7B49\uFF0C\u4F9B element / stringify / hydrate \u590D\u7528\n */\n\nimport type { VNode } from \"../types.ts\";\n\n/** Fragment \u7684 type \u6807\u8BB0\uFF0C\u4E0D\u521B\u5EFA\u771F\u5B9E\u8282\u70B9\uFF0C\u4EC5\u7528\u4E8E\u5305\u88F9\u5B50\u8282\u70B9 */\nexport const FragmentType = Symbol.for(\"view.fragment\");\n\n/** \u5224\u65AD\u662F\u5426\u4E3A Fragment \u8282\u70B9 */\nexport function isFragment(vnode: VNode): boolean {\n  return vnode.type === FragmentType || (vnode.type as unknown) === \"Fragment\";\n}\n\n/** v-if / v-else \u5144\u5F1F\u94FE\u7684\u4E0A\u4E0B\u6587\uFF0C\u7528\u4E8E vElse \u5224\u65AD\u201C\u4E0A\u4E00\u4E2A vIf \u662F\u5426\u4E3A false\u201D */\nexport type IfContext = { lastVIf: boolean };\n\n/**\n * SSR \u9009\u9879\uFF1AallowRawHtml \u4E3A false \u65F6 v-html / dangerouslySetInnerHTML \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF08\u5B89\u5168\u573A\u666F\uFF09\n * \u9ED8\u8BA4\u670D\u52A1\u7AEF v-html \u540C\u6837\u4E0D\u8F6C\u4E49\uFF0C\u4E0E\u5BA2\u6237\u7AEF\u4E00\u81F4\uFF1B\u82E5\u9700\u7981\u6B62\u539F\u59CB HTML \u53EF\u4F20 allowRawHtml: false\n */\nexport type SSROptions = { allowRawHtml?: boolean };\n\n/** \u5224\u65AD\u662F\u5426\u5F62\u5982 VNode\uFF08\u542B type\u3001props\uFF09 */\nexport function isVNodeLike(x: unknown): boolean {\n  return typeof x === \"object\" && x !== null && \"type\" in x && \"props\" in x;\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u6307\u4EE4 unmount \u767B\u8BB0\u4E0E\u6267\u884C\n *\n * \u5728 replaceChildren / removeChild \u524D\u5BF9\u8282\u70B9\u53CA\u5176\u5B50\u6811\u6267\u884C\u5DF2\u767B\u8BB0\u7684\u6307\u4EE4 unmounted \u56DE\u8C03\uFF08\u5148\u5B50\u540E\u7236\uFF09\n */\n\nimport type { ElementWithViewData } from \"../types.ts\";\n\n/**\n * \u4E3A\u5143\u7D20\u767B\u8BB0\u6307\u4EE4 unmounted \u56DE\u8C03\uFF0C\u8282\u70B9\u4ECE DOM \u79FB\u9664\u524D\u4F1A\u6267\u884C\uFF08\u7531 applyDirectives \u8C03\u7528\uFF09\n */\nexport function registerDirectiveUnmount(el: Element, cb: () => void): void {\n  const viewEl = el as ElementWithViewData;\n  const list = viewEl.__viewDirectiveUnmount;\n  if (list) list.push(cb);\n  else viewEl.__viewDirectiveUnmount = [cb];\n}\n\n/**\n * \u5BF9\u7236\u8282\u70B9\u7684\u5B50\u8282\u70B9\u4F9D\u6B21\u6267\u884C runDirectiveUnmount\uFF08\u5148\u5B50\u540E\u7236\u7531 runDirectiveUnmount \u5185\u90E8\u9012\u5F52\u4FDD\u8BC1\uFF09\n * \u5728 replaceChildren / removeChild \u524D\u8C03\u7528\uFF0C\u7EDF\u4E00\u62BD\u53D6\u4EE5\u51CF\u5C11\u91CD\u590D\n */\nexport function runDirectiveUnmountOnChildren(parent: Node): void {\n  for (const child of Array.from(parent.childNodes)) {\n    runDirectiveUnmount(child);\n  }\n}\n\n/**\n * \u5BF9\u8282\u70B9\u53CA\u5176\u5B50\u6811\u9012\u5F52\u6267\u884C\u5DF2\u767B\u8BB0\u7684\u6307\u4EE4 unmounted \u56DE\u8C03\uFF08\u5148\u5B50\u540E\u7236\uFF09\n * \u5728 replaceChildren / removeChild \u524D\u8C03\u7528\uFF0C\u786E\u4FDD\u8282\u70B9\u79FB\u9664\u524D\u5B8C\u6210\u6E05\u7406\n */\nexport function runDirectiveUnmount(node: Node): void {\n  if (node.nodeType === 1) {\n    const el = node as Element;\n    runDirectiveUnmountOnChildren(el);\n    const list = (el as ElementWithViewData).__viewDirectiveUnmount;\n    if (list) {\n      for (const cb of list) cb();\n      list.length = 0;\n    }\n  } else if (node.nodeType === 11) {\n    const frag = node as DocumentFragment;\n    runDirectiveUnmountOnChildren(frag);\n  }\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u516C\u5171\u7C7B\u578B\n *\n * \u5B9A\u4E49 Signal\u3001Effect\u3001VNode\u3001\u6E32\u67D3\u7ED3\u679C\u7B49\u6838\u5FC3\u7C7B\u578B\uFF0C\u4F9B signal\u3001effect\u3001jsx-runtime\u3001runtime \u7B49\u6A21\u5757\u4F7F\u7528\u3002\n */\n\n/** Signal \u7684 getter \u51FD\u6570\uFF08\u65E0\u53C2\uFF0C\u8FD4\u56DE\u5F53\u524D\u503C\uFF09\uFF0C\u7528\u4E8E\u4F9D\u8D56\u6536\u96C6 */\nexport type SignalGetter<T> = () => T;\n\n/** Signal \u7684 setter \u51FD\u6570\uFF08\u652F\u6301\u503C\u6216 updater \u51FD\u6570\uFF09 */\nexport type SignalSetter<T> = (value: T | ((prev: T) => T)) => void;\n\n/** createSignal \u8FD4\u56DE\u7684\u5143\u7EC4 [getter, setter] */\nexport type SignalTuple<T> = [getter: SignalGetter<T>, setter: SignalSetter<T>];\n\n/** Effect \u7684 dispose \u51FD\u6570\uFF0C\u7528\u4E8E\u53D6\u6D88\u8BA2\u9605 */\nexport type EffectDispose = () => void;\n\n/**\n * VNode \u63CF\u8FF0\u7B26\uFF1AJSX \u7F16\u8BD1\u540E\u7684\u8282\u70B9\u63CF\u8FF0\uFF0C\u4F9B render / renderToString \u6D88\u8D39\n * - type \u4E3A\u5B57\u7B26\u4E32\u65F6\u8868\u793A\u539F\u751F DOM \u6807\u7B7E\n * - type \u4E3A\u51FD\u6570\u65F6\u8868\u793A\u7EC4\u4EF6\uFF08\u63A5\u6536 props \u8FD4\u56DE VNode \u6216 VNode[]\uFF09\n * - type \u4E3A Symbol\uFF08\u5982 Fragment\uFF09\u65F6\u8868\u793A\u5360\u4F4D/\u7247\u6BB5\uFF0C\u4E0D\u751F\u6210\u771F\u5B9E\u8282\u70B9\n */\nexport type VNode = {\n  type:\n    | string\n    | symbol\n    | ((props: Record<string, unknown>) => VNode | VNode[] | null);\n  props: Record<string, unknown>;\n  key?: string | number | null;\n  children?: VNode[];\n};\n\n/** \u6839\u5B9E\u4F8B\uFF1Arender / hydrate \u8FD4\u56DE\u7684\u53E5\u67C4\uFF0C\u53EF unmount */\nexport type Root = {\n  unmount: () => void;\n  /** \u6302\u8F7D\u7684\u5BB9\u5668\u5143\u7D20\uFF08\u4EC5\u6D4F\u89C8\u5668\u73AF\u5883\uFF09 */\n  container?: Element | null;\n};\n\n/**\n * \u6269\u5C55 Element\uFF1A\u6302\u8F7D\u6307\u4EE4 unmounted \u56DE\u8C03\u5217\u8868\u53CA\u4E8B\u4EF6\u7B49\u6269\u5C55\u5C5E\u6027\uFF0C\u4F9B dom \u5C42\u5185\u90E8\u4F7F\u7528\n * \u96C6\u4E2D\u58F0\u660E\u540E\u907F\u514D\u591A\u5904 el as unknown as Record<string, unknown> \u65AD\u8A00\n */\nexport interface ElementWithViewData extends Element {\n  __viewDirectiveUnmount?: (() => void)[];\n  [key: string]: unknown;\n}\n\n/** \u662F\u5426\u5904\u4E8E\u6D4F\u89C8\u5668 DOM \u73AF\u5883\uFF08\u7528\u4E8E SSR \u4E0E CSR \u5206\u652F\uFF09 */\nexport function isDOMEnvironment(): boolean {\n  return typeof globalThis !== \"undefined\" &&\n    typeof (globalThis as { document?: unknown }).document !== \"undefined\";\n}\n", "/**\n * @dreamer/view/boundary \u2014 \u6309\u9700\u5BFC\u5165\n *\n * \u4EC5\u4FDD\u7559 Suspense\u3001ErrorBoundary\u3002\u6761\u4EF6/\u5217\u8868\u6E32\u67D3\u8BF7\u7528\u6307\u4EE4\uFF1Av-if / v-else / v-else-if / v-for\u3002\n * Suspense \u652F\u6301 Promise \u5B50\u8282\u70B9\uFF1BErrorBoundary \u6355\u83B7\u5B50\u6811\u9519\u8BEF\u3002\n */\n\nimport { createEffect } from \"./effect.ts\";\nimport { createSignal, markSignalGetter } from \"./signal.ts\";\nimport { Fragment, jsx } from \"./jsx-runtime.ts\";\nimport type { VNode } from \"./types.ts\";\n\nfunction valueOf<T>(v: T | (() => T)): T {\n  return typeof v === \"function\" ? (v as () => T)() : v;\n}\n\n/** ErrorBoundary \u7EC4\u4EF6\u5F15\u7528\uFF0C\u4F9B dom \u505A try/catch \u65F6\u8BC6\u522B */\nexport function isErrorBoundary(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n): boolean {\n  return component === ErrorBoundary;\n}\n\n/** \u4ECE ErrorBoundary \u7684 props \u4E2D\u53D6 fallback \u51FD\u6570\uFF1A(error) => VNode */\nexport function getErrorBoundaryFallback(\n  props: Record<string, unknown>,\n): (error: unknown) => VNode {\n  const fb = props.fallback;\n  if (typeof fb === \"function\") return fb as (error: unknown) => VNode;\n  const vnode: VNode = (fb != null && typeof fb === \"object\" && \"type\" in fb)\n    ? fb as VNode\n    : { type: \"#text\", props: { nodeValue: String(fb) }, children: [] };\n  return () => vnode;\n}\n\n/**\n * \u9519\u8BEF\u8FB9\u754C\uFF1A\u6355\u83B7\u5B50\u6811\u6E32\u67D3\u4E2D\u7684\u9519\u8BEF\uFF0C\u663E\u793A fallback(error)\n * \u4EC5\u6355\u83B7\u5B50\u7EC4\u4EF6\u6267\u884C\u6216\u5B50 VNode \u521B\u5EFA\u65F6\u7684\u540C\u6B65\u9519\u8BEF\u3002\n */\nexport function ErrorBoundary(props: {\n  fallback: (error: unknown) => VNode;\n  children?: VNode | VNode[] | (() => VNode | VNode[]);\n}): VNode | VNode[] | null {\n  return (props.children ?? null) as VNode | VNode[] | null;\n}\n\n/**\n * \u5F02\u6B65\u8FB9\u754C\uFF1Achildren \u4E3A Promise<VNode> \u6216 getter \u8FD4\u56DE Promise \u65F6\u5148\u663E\u793A fallback\uFF0Cresolve \u540E\u663E\u793A\u5185\u5BB9\n * \u4E0E createResource \u914D\u5408\uFF1Aresource().loading \u65F6\u663E\u793A fallback\uFF0C\u6709 data \u65F6\u663E\u793A\u5185\u5BB9\n */\nexport function Suspense(props: {\n  fallback: VNode | (() => VNode);\n  children: VNode | (() => VNode) | (() => Promise<VNode>) | Promise<VNode>;\n}): VNode {\n  const [resolved, setResolved] = createSignal<VNode | null>(null);\n  /** \u6BCF\u6B21 effect \u8FD0\u884C\u9012\u589E\uFF1Bdispose \u65F6\u7F6E\u4E3A -1\uFF0CPromise \u56DE\u8C03\u4EC5\u5F53 gen === generation \u65F6\u624D setResolved\uFF0C\u907F\u514D unmount \u540E\u6216\u65E7 run \u7684 promise \u8BEF\u66F4\u65B0 */\n  let generation = 0;\n  createEffect(() => {\n    const gen = ++generation;\n    const c = valueOf(props.children);\n    if (c != null && typeof (c as Promise<unknown>).then === \"function\") {\n      (c as Promise<VNode>).then((v) => {\n        if (gen === generation) setResolved(v ?? null);\n      });\n    } else {\n      setResolved((c as VNode) ?? null);\n    }\n    return () => {\n      generation = -1;\n    };\n  });\n  const getter = () => resolved() ?? valueOf(props.fallback);\n  return jsx(Fragment, { children: markSignalGetter(getter) });\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u6307\u4EE4\u7CFB\u7EDF\n *\n * \u652F\u6301\u5185\u7F6E\u6307\u4EE4 v-if / v-else / v-else-if / v-for / v-show / v-text / v-html / v-model\uFF0C\u4EE5\u53CA\u7528\u6237\u6CE8\u518C\u7684\u81EA\u5B9A\u4E49\u6307\u4EE4\uFF08v-xxxx\uFF09\u3002\n * JSX \u4E2D\u4F7F\u7528 camelCase\uFF1AvIf\u3001vElse\u3001vElseIf\u3001vFor\u3001vShow\u3001vText\u3001vHtml\u3001vModel\uFF1B\u6A21\u677F\u4E2D\u53EF\u4F7F\u7528 v-if\u3001v-html\u3001v-model \u7B49\u3002\n * v-model \u7528\u6CD5\uFF1AvModel={[getter, setter]}\uFF0C\u5982 createSignal \u8FD4\u56DE\u7684\u5143\u7EC4\u3002\u539F\u751F input/textarea/select \u7531 applyProps \u53CC\u5411\u7ED1\u5B9A\uFF1B\n * \u81EA\u5B9A\u4E49\u8868\u5355\u7EC4\u4EF6\uFF1A\u7236\u7EC4\u4EF6\u76F4\u63A5\u4F20 model={[get, set]}\uFF0C\u7EC4\u4EF6\u5185\u89E3\u6784 props.model \u5373\u53EF\u3002\n */\n\nimport { isSignalGetter } from \"./signal.ts\";\nimport type { VNode } from \"./types.ts\";\n\n/** \u6307\u4EE4\u7ED1\u5B9A\uFF1A\u4F20\u7ED9\u6307\u4EE4\u94A9\u5B50\u7684\u53C2\u6570 */\nexport interface DirectiveBinding<T = unknown> {\n  value: T;\n  oldValue?: T;\n  /** \u53C2\u6570\uFF0C\u5982 v-foo:arg \u4E2D\u7684 arg */\n  arg?: string;\n  /** \u4FEE\u9970\u7B26\uFF0C\u5982 v-foo.mod1.mod2 \u4E2D\u7684 ['mod1','mod2'] */\n  modifiers?: string[];\n}\n\n/** \u6307\u4EE4\u94A9\u5B50\uFF1Amounted \u6302\u8F7D\u65F6\u3001updated \u7ED1\u5B9A\u503C\u53D8\u5316\u65F6\u3001unmounted \u5378\u8F7D\u65F6 */\nexport interface DirectiveHooks<T = unknown> {\n  mounted?(el: Element, binding: DirectiveBinding<T>): void;\n  updated?(el: Element, binding: DirectiveBinding<T>): void;\n  unmounted?(el: Element): void;\n}\n\nconst registry = new Map<string, DirectiveHooks>();\n\n/** \u5C06\u6A21\u677F\u98CE\u683C\u540D\u79F0\u8F6C\u4E3A camelCase\uFF0C\u5982 v-if -> vIf */\nexport function directiveNameToCamel(name: string): string {\n  if (name.startsWith(\"v-\")) {\n    const rest = name.slice(2).replace(/-([a-z])/g, (_, c) => c.toUpperCase());\n    return \"v\" + rest.charAt(0).toUpperCase() + rest.slice(1);\n  }\n  return name;\n}\n\n/** \u5C06 camelCase \u8F6C\u4E3A\u77ED\u6A2A\u7EBF\uFF0C\u5982 vIf -> v-if */\nexport function directiveNameToKebab(name: string): string {\n  if (name.startsWith(\"v\") && name.length > 1) {\n    const rest = name.slice(1).replace(\n      /([A-Z])/g,\n      (_, c) => `-${c.toLowerCase()}`,\n    );\n    return \"v\" + rest;\n  }\n  return name;\n}\n\n/**\n * \u6CE8\u518C\u81EA\u5B9A\u4E49\u6307\u4EE4\n *\n * @param name \u6307\u4EE4\u540D\uFF0C\u652F\u6301 v-xxx \u6216 vXxx\n * @param hooks mounted / updated / unmounted\n *\n * @example\n * registerDirective(\"v-focus\", {\n *   mounted(el) { (el as HTMLInputElement).focus(); },\n * });\n */\nexport function registerDirective(name: string, hooks: DirectiveHooks): void {\n  const camel = directiveNameToCamel(name);\n  registry.set(camel, hooks);\n  if (camel !== name) registry.set(name, hooks);\n}\n\n/**\n * \u6839\u636E prop \u540D\u83B7\u53D6\u6307\u4EE4\uFF08\u652F\u6301 vIf\u3001v-if \u7B49\uFF09\n */\nexport function getDirective(propKey: string): DirectiveHooks | undefined {\n  if (!propKey.startsWith(\"v\") && !propKey.startsWith(\"v-\")) return undefined;\n  return registry.get(propKey) ?? registry.get(directiveNameToCamel(propKey));\n}\n\n/** \u5224\u65AD\u662F\u5426\u4E3A\u6307\u4EE4\u7C7B prop \u540D\uFF08\u5185\u7F6E\u6216\u5DF2\u6CE8\u518C\uFF09 */\nconst BUILTIN_DIRECTIVE_PROPS = new Set([\n  \"vIf\",\n  \"v-if\",\n  \"vElse\",\n  \"v-else\",\n  \"vElseIf\",\n  \"v-else-if\",\n  \"vFor\",\n  \"v-for\",\n  \"vShow\",\n  \"v-show\",\n  \"vText\",\n  \"v-text\",\n  \"vHtml\",\n  \"v-html\",\n  \"vModel\",\n  \"v-model\",\n  \"vOnce\",\n  \"v-once\",\n  \"vCloak\",\n  \"v-cloak\",\n]);\n\nexport function isDirectiveProp(propKey: string): boolean {\n  if (BUILTIN_DIRECTIVE_PROPS.has(propKey)) return true;\n  if (\n    (propKey.startsWith(\"v\") && propKey.length > 1) || propKey.startsWith(\"v-\")\n  ) {\n    return true;\n  }\n  return false;\n}\n\n/**\n * \u5224\u65AD props \u662F\u5426\u5305\u542B\u6307\u5B9A\u6307\u4EE4\uFF08\u540C\u65F6\u652F\u6301 camelCase \u4E0E kebab-case\uFF0C\u51CF\u5C11\u9B54\u6CD5\u5B57\u7B26\u4E32\uFF09\n * @param props \u8282\u70B9 props\n * @param camelName \u6307\u4EE4\u9A7C\u5CF0\u540D\uFF0C\u5982 'vShow'\u3001'vIf'\u3001'vText'\n */\nexport function hasDirective(\n  props: Record<string, unknown>,\n  camelName: string,\n): boolean {\n  if (camelName in props) return true;\n  const kebab = directiveNameToKebab(camelName);\n  return kebab in props;\n}\n\n/** \u83B7\u53D6\u6307\u4EE4\u7ED1\u5B9A\u5F53\u524D\u503C\uFF08\u82E5\u4E3A getter \u5219\u6C42\u503C\uFF09\uFF1B\u4F9B dom \u5C42 v-once \u7B49\u51BB\u7ED3\u65F6\u4F7F\u7528 */\nexport function getDirectiveValue(value: unknown): unknown {\n  return isSignalGetter(value) ? (value as () => unknown)() : value;\n}\n\n/**\n * \u4ECE props \u4E2D\u63D0\u53D6\u6307\u4EE4\u7ED1\u5B9A\uFF08\u4F9B dom \u5C42\u5728 applyProps \u65F6\u8C03\u7528\u81EA\u5B9A\u4E49\u6307\u4EE4\uFF09\n */\nexport function createBinding(\n  value: unknown,\n  arg?: string,\n  modifiers?: string[],\n): DirectiveBinding {\n  return {\n    value: getDirectiveValue(value),\n    arg,\n    modifiers: modifiers ?? [],\n  };\n}\n\n/**\n * \u68C0\u67E5 vnode \u662F\u5426\u6709\u7ED3\u6784\u6027\u6307\u4EE4 vIf / vFor\uFF0C\u9700\u5728 createElement \u4E2D\u4F18\u5148\u5904\u7406\n */\nexport function hasStructuralDirective(\n  props: Record<string, unknown>,\n): \"vIf\" | \"vFor\" | null {\n  if (\"vIf\" in props || \"v-if\" in props) return \"vIf\";\n  if (\"vFor\" in props || \"v-for\" in props) return \"vFor\";\n  return null;\n}\n\n/**\n * \u53D6 vIf \u7684\u5F53\u524D\u503C\uFF08boolean \u6216 getter \u6C42\u503C\uFF09\n * \u652F\u6301\u6807\u8BB0\u8FC7\u7684 signal getter \u4E0E\u666E\u901A\u65E0\u53C2\u51FD\u6570\uFF08\u5982 () => tab() === \"a\"\uFF09\uFF0C\u4EE5\u4FBF\u5728 effect \u5185\u8BFB signal \u5E76\u8BA2\u9605\n */\nexport function getVIfValue(props: Record<string, unknown>): boolean {\n  const raw = props[\"vIf\"] ?? props[\"v-if\"];\n  if (raw == null) return true;\n  const v = typeof raw === \"function\"\n    ? (raw as () => unknown)()\n    : getDirectiveValue(raw);\n  return Boolean(v);\n}\n\n/**\n * \u53D6 vElse \u662F\u5426\u5E94\u663E\u793A\uFF1A\u4F9D\u8D56\u5916\u90E8\u4F20\u5165\u7684 lastVIf\uFF08\u4E0A\u4E00\u4E2A vIf \u4E3A false \u65F6 vElse \u624D\u663E\u793A\uFF09\n */\nexport function getVElseShow(lastVIf: boolean): boolean {\n  return !lastVIf;\n}\n\n/**\n * \u53D6 v-else-if \u7684\u5F53\u524D\u6761\u4EF6\u503C\uFF08\u4EC5\u5F53\u4E0A\u4E00\u4E2A v-if \u4E3A false \u65F6\u624D\u6709\u610F\u4E49\uFF09\n * \u652F\u6301\u6807\u8BB0\u8FC7\u7684 signal getter \u4E0E\u666E\u901A\u65E0\u53C2\u51FD\u6570\uFF0C\u4EE5\u4FBF\u5728 effect \u5185\u8BFB signal \u5E76\u8BA2\u9605\n */\nexport function getVElseIfValue(props: Record<string, unknown>): boolean {\n  const raw = props[\"vElseIf\"] ?? props[\"v-else-if\"];\n  if (raw == null) return false;\n  const v = typeof raw === \"function\"\n    ? (raw as () => unknown)()\n    : getDirectiveValue(raw);\n  return Boolean(v);\n}\n\n/**\n * \u4ECE v-for \u7684 children \u89E3\u6790\u51FA\u5DE5\u5382\u51FD\u6570\u3002\n * \u652F\u6301\uFF1A(item, index) => VNode \u7684\u5355\u4E2A\u51FD\u6570\uFF0C\u6216 expand \u540E\u5F97\u5230\u7684\u5355\u5143\u7D20\u6570\u7EC4 [factory]\u3002\n */\nexport function resolveVForFactory(\n  children: unknown,\n): (item: unknown, index: number) => VNode | VNode[] {\n  if (typeof children === \"function\") {\n    return children as (item: unknown, index: number) => VNode | VNode[];\n  }\n  if (\n    Array.isArray(children) && children.length === 1 &&\n    typeof children[0] === \"function\"\n  ) {\n    return children[0] as (item: unknown, index: number) => VNode | VNode[];\n  }\n  return () => (children as VNode);\n}\n\n/**\n * \u53D6 vFor \u7684 list \u4E0E\u5B50\u8282\u70B9\u5DE5\u5382\uFF08children \u4E3A (item, index) => VNode | VNode[]\uFF09\n */\nexport function getVForListAndFactory(\n  props: Record<string, unknown>,\n  children: unknown,\n): {\n  list: unknown[];\n  factory: (item: unknown, index: number) => VNode | VNode[];\n} | null {\n  const rawList = props[\"vFor\"] ?? props[\"v-for\"];\n  if (rawList == null) return null;\n  const resolved = getDirectiveValue(rawList);\n  const list = Array.isArray(resolved) ? resolved : [];\n  // \u652F\u6301 children \u4E3A\u5DE5\u5382\u51FD\u6570\uFF0C\u6216 expand \u540E\u7684\u5355\u5143\u7D20\u6570\u7EC4 [factory]\n  const factory = resolveVForFactory(children);\n  return { list, factory };\n}\n\n/** \u53D6 v-show \u7684\u5F53\u524D\u503C\uFF08boolean \u6216 getter \u6C42\u503C\uFF09\uFF0C\u4F9B dom \u5C42\u5E94\u7528 display */\nexport function getVShowValue(props: Record<string, unknown>): boolean {\n  const raw = props[\"vShow\"] ?? props[\"v-show\"];\n  if (raw == null) return true;\n  return Boolean(getDirectiveValue(raw));\n}\n\n/** \u53D6 v-text \u7684\u5F53\u524D\u503C\uFF08string \u6216 getter/\u51FD\u6570\u6C42\u503C\uFF09\uFF0C\u4F9B dom \u5C42\u5E94\u7528 textContent */\nexport function getVTextValue(props: Record<string, unknown>): string {\n  const raw = props[\"vText\"] ?? props[\"v-text\"];\n  if (raw == null) return \"\";\n  const v = typeof raw === \"function\"\n    ? (raw as () => unknown)()\n    : getDirectiveValue(raw);\n  return v == null ? \"\" : String(v);\n}\n\n/**\n * \u53D6 v-html \u7684\u5F53\u524D\u503C\uFF08string \u6216 getter/\u51FD\u6570\u6C42\u503C\uFF09\uFF0C\u4F9B dom \u5C42\u5E94\u7528 innerHTML\n *\n * \u5B89\u5168\uFF1A\u672A\u8F6C\u4E49 HTML\uFF0C\u5B58\u5728 XSS \u98CE\u9669\u3002\u7981\u6B62\u5C06\u672A sanitize \u7684\u7528\u6237\u8F93\u5165\u4F20\u5165\u3002\n * \u4EC5\u9650\u4FE1\u4EFB\u5185\u5BB9\uFF1B\u5BF9\u7528\u6237\u8F93\u5165\u8BF7\u5148\u7528 DOMPurify\u3001sanitize-html \u7B49\u5E93\u505A sanitize \u540E\u518D\u4F20\u5165\u3002\n */\nexport function getVHtmlValue(props: Record<string, unknown>): string {\n  const raw = props[\"vHtml\"] ?? props[\"v-html\"];\n  if (raw == null) return \"\";\n  const v = typeof raw === \"function\"\n    ? (raw as () => unknown)()\n    : getDirectiveValue(raw);\n  return v == null ? \"\" : String(v);\n}\n\n/**\n * \u4ECE props \u4E2D\u53D6\u51FA v-model/model \u7ED1\u5B9A\uFF0C\u4F9B\u9700\u8981\u540C\u65F6\u517C\u5BB9 vModel \u4E0E model \u7684\u81EA\u5B9A\u4E49\u7EC4\u4EF6\u4F7F\u7528\n *\n * \u63A8\u8350\u505A\u6CD5\uFF1A\u81EA\u5B9A\u4E49\u7EC4\u4EF6\u76F4\u63A5\u63A5\u6536 model={[get, set]}\uFF0C\u7EC4\u4EF6\u5185 const [get, set] = props.model \u5373\u53EF\u3002\n * \u82E5\u7EC4\u4EF6\u9700\u540C\u65F6\u63A5\u53D7 vModel \u6216 model\uFF08\u5982\u6A21\u677F\u7F16\u8BD1\u4EA7\u7269\uFF09\uFF0C\u53EF\u8C03\u7528\u672C\u51FD\u6570\u7EDF\u4E00\u53D6\u51FA [getter, setter]\u3002\n *\n * @param props \u7EC4\u4EF6 props\uFF08\u53EF\u542B vModel\u3001v-model \u6216 model\uFF09\n * @returns [getter, setter] \u6216 null\uFF08\u672A\u4F20\u65F6\uFF09\n */\nexport function getModelFromProps(\n  props: Record<string, unknown>,\n): [() => unknown, (v: unknown) => void] | null {\n  const raw = props[\"vModel\"] ?? props[\"v-model\"] ?? props[\"model\"];\n  if (\n    !Array.isArray(raw) ||\n    raw.length < 2 ||\n    typeof raw[0] !== \"function\" ||\n    typeof raw[1] !== \"function\"\n  ) {\n    return null;\n  }\n  return [raw[0] as () => unknown, raw[1] as (v: unknown) => void];\n}\n\n/**\n * \u5E94\u7528\u81EA\u5B9A\u4E49\u6307\u4EE4\u5230\u5143\u7D20\uFF1A\u5728 applyProps \u4E2D\u5BF9\u6BCF\u4E2A\u6307\u4EE4 prop \u8C03\u7528 mounted\uFF0C\u82E5\u503C\u4E3A getter \u5219\u7528 effect \u8C03\u7528 updated\uFF1B\n * \u82E5\u6307\u4EE4\u63D0\u4F9B unmounted\uFF0C\u901A\u8FC7 registerUnmount \u767B\u8BB0\uFF0C\u8282\u70B9\u4ECE DOM \u79FB\u9664\u524D\u4F1A\u8C03\u7528\n */\nexport function applyDirectives(\n  el: Element,\n  props: Record<string, unknown>,\n  effectFn: (fn: () => void) => () => void,\n  registerUnmount?: (el: Element, cb: () => void) => void,\n): void {\n  for (const [key, value] of Object.entries(props)) {\n    if (key === \"children\" || key === \"key\") continue;\n    if (BUILTIN_DIRECTIVE_PROPS.has(key)) continue; // \u5185\u7F6E\u6307\u4EE4\u5DF2\u5728 createElement / applyProps \u4E2D\u5904\u7406\n    const directive = getDirective(key);\n    if (!directive) continue;\n    const binding = createBinding(value);\n    if (directive.mounted) {\n      directive.mounted(el, binding);\n    }\n    if (directive.updated && isSignalGetter(value)) {\n      effectFn(() => {\n        const current = createBinding(value);\n        directive.updated!(el, current);\n      });\n    }\n    if (directive.unmounted && registerUnmount) {\n      registerUnmount(el, () => directive.unmounted!(el));\n    }\n  }\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Context\uFF08\u8DE8\u5C42\u6570\u636E\u6CE8\u5165\uFF09\n *\n * createContext \u521B\u5EFA\u4E0A\u4E0B\u6587\uFF0CProvider \u5728\u6811\u4E2D\u6CE8\u5165\u503C\uFF0CuseContext \u5728\u4EFB\u610F\u5B50\u7EC4\u4EF6\u4E2D\u8BFB\u53D6\u3002\n * \u6E32\u67D3\u65F6\u5728 dom \u4E2D\u8FDB\u5165 Provider \u5373 push\u3001\u9000\u51FA\u5373 pop\uFF0C\u4FDD\u8BC1\u540C\u4E00\u6B21\u6E32\u67D3\u4E2D\u5B50\u6811\u8BFB\u5230\u6B63\u786E\u503C\u3002\n */\n\nimport type { VNode } from \"./types.ts\";\n\n/** \u6BCF\u4E2A context \u7684\u6808\uFF0C\u7528\u4E8E\u5D4C\u5957 Provider */\nconst contextStacks = new Map<symbol, unknown[]>();\n\n/** context id -> \u9ED8\u8BA4\u503C\uFF08\u65E0 Provider \u65F6 useContext \u8FD4\u56DE\uFF09 */\nconst defaultValues = new Map<symbol, unknown>();\n\n/** \u53EF\u6CE8\u5165 context \u7684\u7EC4\u4EF6 -> { id, getValue }\uFF0C\u652F\u6301\u9ED8\u8BA4 Provider(value) \u4E0E\u522B\u540D\u7EC4\u4EF6\uFF08\u5982 RouterProvider(router)\uFF09 */\nconst providerBindings = new Map<\n  (props: Record<string, unknown>) => VNode | VNode[] | null,\n  { id: symbol; getValue: (props: Record<string, unknown>) => unknown }\n>();\n\n/**\n * \u8FDB\u5165 Provider \u65F6\u538B\u6808\uFF08\u7531 dom \u5728\u6E32\u67D3\u65F6\u8C03\u7528\uFF09\n * @internal\n */\nexport function pushContext(id: symbol, value: unknown): void {\n  let stack = contextStacks.get(id);\n  if (!stack) {\n    stack = [];\n    contextStacks.set(id, stack);\n  }\n  stack.push(value);\n}\n\n/**\n * \u79BB\u5F00 Provider \u65F6\u51FA\u6808\uFF08\u7531 dom \u5728\u6E32\u67D3\u65F6\u8C03\u7528\uFF09\n * @internal\n */\nexport function popContext(id: symbol): void {\n  const stack = contextStacks.get(id);\n  if (stack && stack.length > 0) stack.pop();\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D context \u503C\uFF08\u6808\u9876\uFF09\uFF0C\u65E0\u5219\u8FD4\u56DE\u521B\u5EFA\u65F6\u7684\u9ED8\u8BA4\u503C\n * @internal\n */\nexport function getContext(id: symbol): unknown {\n  const stack = contextStacks.get(id);\n  const value = stack && stack.length > 0 ? stack[stack.length - 1] : undefined;\n  return value !== undefined ? value : defaultValues.get(id);\n}\n\n/**\n * \u5224\u65AD\u7EC4\u4EF6\u662F\u5426\u4E3A\u67D0 context \u7684 Provider\uFF0C\u82E5\u662F\u5219\u8FD4\u56DE\u5176 context id\n * @internal\n */\nexport function getProviderContextId(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n): symbol | undefined {\n  return providerBindings.get(component)?.id;\n}\n\n/**\n * \u82E5\u7EC4\u4EF6\u5DF2\u6CE8\u518C\u4E3A context \u63D0\u4F9B\u8005\uFF08\u542B createContext \u7684 Provider \u6216 registerProviderAlias \u7684\u522B\u540D\uFF09\uFF0C\n * \u8FD4\u56DE { id, value } \u4F9B dom \u5C42 push\uFF1B\u5426\u5219\u8FD4\u56DE undefined\u3002\n * @internal\n */\nexport function getContextBinding(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n  props: Record<string, unknown>,\n): { id: symbol; value: unknown } | undefined {\n  const binding = providerBindings.get(component);\n  if (!binding) return undefined;\n  return { id: binding.id, value: binding.getValue(props) };\n}\n\nexport type ContextValue<T> = T;\n\n/**\n * \u521B\u5EFA\u4E0A\u4E0B\u6587\n *\n * @param defaultValue \u65E0 Provider \u5305\u88F9\u65F6 useContext \u8FD4\u56DE\u7684\u9ED8\u8BA4\u503C\n * @returns { Provider, useContext }\uFF0CProvider \u4E3A\u7EC4\u4EF6\u7528\u4E8E\u5305\u88F9\u5B50\u6811\uFF0CuseContext \u5728\u5B50\u7EC4\u4EF6\u4E2D\u8C03\u7528\u53D6\u5F53\u524D\u503C\n *\n * @example\n * const ThemeContext = createContext<'light'|'dark'>('light');\n * // \u6839\u6216\u7236\u7EA7\uFF1A<ThemeContext.Provider value={theme()}><App /></ThemeContext.Provider>\n * // \u5B50\u7EC4\u4EF6\uFF1Aconst theme = ThemeContext.useContext();\n */\nexport function createContext<T>(defaultValue: T): {\n  Provider: (\n    props: { value: T; children?: VNode | VNode[] | null },\n  ) => VNode | VNode[] | null;\n  useContext: () => T;\n  /** \u6CE8\u518C\u201C\u522B\u540D\u201D\u63D0\u4F9B\u8005\uFF1A\u7528 getValue(props) \u6CE8\u5165\u540C\u4E00 context\uFF0C\u4FBF\u4E8E\u5305\u88C5\u7EC4\u4EF6\uFF08\u5982 RouterProvider(router)\uFF09\u76F4\u63A5\u6CE8\u5165\uFF0C\u65E0\u9700\u5185\u5C42 Provider */\n  registerProviderAlias: (\n    component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n    getValue: (props: Record<string, unknown>) => T,\n  ) => void;\n} {\n  const id = Symbol(\"view.context\");\n  defaultValues.set(id, defaultValue);\n\n  const Provider = (\n    props: { value: T; children?: VNode | VNode[] | null },\n  ): VNode | VNode[] | null => {\n    return (props.children ?? null) as VNode | VNode[] | null;\n  };\n  providerBindings.set(\n    Provider as (props: Record<string, unknown>) => VNode | VNode[] | null,\n    { id, getValue: (p) => (p as { value: T }).value },\n  );\n\n  const useContext = (): T => {\n    return getContext(id) as T;\n  };\n\n  const registerProviderAlias = (\n    component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n    getValue: (props: Record<string, unknown>) => T,\n  ): void => {\n    providerBindings.set(component, {\n      id,\n      getValue: getValue as (p: Record<string, unknown>) => unknown,\n    });\n  };\n\n  return { Provider, useContext, registerProviderAlias };\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u5411 DOM \u5143\u7D20\u5E94\u7528 props\n *\n * \u542B signal \u7ED1\u5B9A\u3001ref\u3001v-show/v-text/v-html\u3001\u4E8B\u4EF6\u3001className\u3001style\u3001\u5E03\u5C14/\u8868\u5355\u5C5E\u6027\u53CA\u81EA\u5B9A\u4E49\u6307\u4EE4\n */\n\nimport { createEffect } from \"../effect.ts\";\nimport { isSignalGetter } from \"../signal.ts\";\nimport { type ElementWithViewData, isDOMEnvironment } from \"../types.ts\";\nimport {\n  applyDirectives,\n  getVHtmlValue,\n  getVShowValue,\n  getVTextValue,\n  hasDirective,\n  isDirectiveProp,\n} from \"../directive.ts\";\nimport { registerDirectiveUnmount } from \"./unmount.ts\";\n\n/**\n * \u5E94\u7528 ref\uFF1A\u652F\u6301\u56DE\u8C03 (el) => void \u4E0E Ref \u5BF9\u8C61 { current }\n * \u7528\u4E8E\u5728\u5143\u7D20\u6302\u8F7D\u540E\u628A\u5B9E\u4F8B\u4EA4\u7ED9\u8C03\u7528\u65B9\n */\nfunction applyRef(el: Element, ref: unknown): void {\n  if (ref == null) return;\n  if (typeof ref === \"function\") {\n    (ref as (el: Element) => void)(el);\n    return;\n  }\n  if (typeof ref === \"object\" && \"current\" in ref) {\n    (ref as { current: Element | null }).current = el;\n  }\n}\n\n/**\n * \u5411 DOM \u5143\u7D20\u5E94\u7528 props\uFF08\u542B signal \u7ED1\u5B9A\u3001ref\u3001\u6307\u4EE4\uFF1B\u6307\u4EE4\u7C7B key \u4E0D\u843D\u4E3A attribute\uFF09\n */\nexport function applyProps(\n  el: Element,\n  props: Record<string, unknown>,\n): void {\n  if (!isDOMEnvironment()) return;\n\n  // v-show\uFF1A\u901A\u8FC7 style.display \u663E\u9690\uFF0C\u4E0D\u9500\u6BC1\u8282\u70B9\uFF1B\u652F\u6301 getter \u52A8\u6001\u66F4\u65B0\n  if (hasDirective(props, \"vShow\")) {\n    const raw = props[\"vShow\"] ?? props[\"v-show\"];\n    const apply = () => {\n      const show = getVShowValue(props);\n      (el as HTMLElement).style.display = show ? \"\" : \"none\";\n    };\n    if (isSignalGetter(raw)) {\n      createEffect(apply);\n    } else {\n      apply();\n    }\n  }\n\n  // v-text\uFF1A\u8BBE\u7F6E textContent\uFF0C\u8986\u76D6\u5B50\u8282\u70B9\uFF1B\u652F\u6301 getter \u6216\u666E\u901A\u51FD\u6570\u52A8\u6001\u66F4\u65B0\n  if (hasDirective(props, \"vText\")) {\n    const raw = props[\"vText\"] ?? props[\"v-text\"];\n    const apply = () => {\n      const text = getVTextValue(props);\n      el.textContent = text;\n    };\n    if (typeof raw === \"function\" || isSignalGetter(raw)) {\n      createEffect(apply);\n    } else {\n      apply();\n    }\n  }\n\n  // v-html\uFF1A\u8BBE\u7F6E innerHTML\uFF08\u4E0D\u8F6C\u4E49\uFF09\u3002\u7981\u6B62\u672A sanitize \u7684\u7528\u6237\u8F93\u5165\uFF1B\u4EC5\u4FE1\u4EFB\u5185\u5BB9\uFF0C\u5EFA\u8BAE\u7528 DOMPurify \u7B49 sanitize \u540E\u518D\u4F20\u5165\n  if (hasDirective(props, \"vHtml\")) {\n    const raw = props[\"vHtml\"] ?? props[\"v-html\"];\n    const apply = () => {\n      const html = getVHtmlValue(props);\n      (el as HTMLElement).innerHTML = html;\n    };\n    if (typeof raw === \"function\" || isSignalGetter(raw)) {\n      createEffect(apply);\n    } else {\n      apply();\n    }\n  }\n\n  // v-cloak\uFF1A\u5728\u5143\u7D20\u4E0A\u8BBE\u7F6E data-view-cloak\uFF0C\u4F9B CSS \u9690\u85CF\u672A\u7F16\u8BD1\u6A21\u677F\uFF0Chydrate \u540E\u7531 runtime \u79FB\u9664\n  if (hasDirective(props, \"vCloak\")) {\n    el.setAttribute(\"data-view-cloak\", \"\");\n  }\n\n  // v-model\uFF1A\u53CC\u5411\u7ED1\u5B9A\uFF08\u7C7B\u4F3C Vue \u7684 v-model\uFF09\uFF0C\u4F20\u5165 [getter, setter] \u5982 createSignal \u8FD4\u56DE\u7684\u5143\u7EC4\n  // \u652F\u6301 input\uFF08text/checkbox/radio\uFF09\u3001textarea\u3001select\uFF1B\u7528 tagName \u5224\u65AD\u4EE5\u517C\u5BB9\u975E\u6D4F\u89C8\u5668\u73AF\u5883\uFF08\u5982 Deno dom-setup\uFF09\n  if (hasDirective(props, \"vModel\")) {\n    const raw = props[\"vModel\"] ?? props[\"v-model\"];\n    if (\n      Array.isArray(raw) &&\n      raw.length >= 2 &&\n      typeof raw[0] === \"function\" &&\n      typeof raw[1] === \"function\"\n    ) {\n      const getter = raw[0] as () => unknown;\n      const setter = raw[1] as (v: unknown) => void;\n      const tag = el.tagName;\n      const inputEl = el as HTMLInputElement;\n      const textareaEl = el as HTMLTextAreaElement;\n      const selectEl = el as HTMLSelectElement;\n      // \u4ECE props \u6216\u5143\u7D20\u4E0A\u53D6 type\uFF0C\u907F\u514D vModel \u5148\u4E8E type \u5E94\u7528\u65F6\u53D6\u4E0D\u5230\n      const inputType = (String((props.type ?? inputEl.type) || \"text\"))\n        .toLowerCase();\n\n      if (tag === \"INPUT\") {\n        const type = inputType;\n        if (type === \"checkbox\") {\n          const apply = () => {\n            inputEl.checked = Boolean(getter());\n          };\n          if (isSignalGetter(getter)) {\n            createEffect(apply);\n          } else {\n            apply();\n          }\n          el.addEventListener(\"change\", () => setter(inputEl.checked));\n        } else if (type === \"radio\") {\n          const apply = () => {\n            inputEl.checked = getter() === inputEl.value;\n          };\n          if (isSignalGetter(getter)) {\n            createEffect(apply);\n          } else {\n            apply();\n          }\n          el.addEventListener(\"change\", () => setter(inputEl.value));\n        } else {\n          const apply = () => {\n            if (isFocusedFormElement(inputEl)) return;\n            const v = getter();\n            const str = v == null ? \"\" : String(v);\n            if (inputEl.value !== str) inputEl.value = str;\n          };\n          if (isSignalGetter(getter)) {\n            createEffect(apply);\n          } else {\n            apply();\n          }\n          el.addEventListener(\"input\", () => setter(inputEl.value));\n        }\n      } else if (tag === \"TEXTAREA\") {\n        const apply = () => {\n          if (isFocusedFormElement(textareaEl)) return;\n          const v = getter();\n          const str = v == null ? \"\" : String(v);\n          if (textareaEl.value !== str) textareaEl.value = str;\n        };\n        if (isSignalGetter(getter)) {\n          createEffect(apply);\n        } else {\n          apply();\n        }\n        el.addEventListener(\"input\", () => setter(textareaEl.value));\n      } else if (tag === \"SELECT\") {\n        const apply = () => {\n          if (isFocusedFormElement(selectEl)) return;\n          const v = getter();\n          const str = v == null ? \"\" : String(v);\n          if (selectEl.value !== str) selectEl.value = str;\n        };\n        if (isSignalGetter(getter)) {\n          createEffect(apply);\n        } else {\n          apply();\n        }\n        el.addEventListener(\"change\", () => setter(selectEl.value));\n      }\n    }\n  }\n\n  for (const [key, value] of Object.entries(props)) {\n    if (key === \"children\" || key === \"key\") continue;\n    if (isDirectiveProp(key)) continue;\n\n    // v-model \u5DF2\u63A5\u7BA1 value/checked \u65F6\u4E0D\u518D\u5355\u72EC\u5E94\u7528\uFF0C\u907F\u514D\u8986\u76D6\n    if (key === \"value\" && hasDirective(props, \"vModel\")) continue;\n    if (key === \"checked\" && hasDirective(props, \"vModel\")) continue;\n\n    if (key === \"ref\") {\n      if (isSignalGetter(value)) {\n        createEffect(() => {\n          const v = (value as () => unknown)();\n          applyRef(el, v);\n        });\n      } else {\n        // \u666E\u901A\u51FD\u6570\u5373 ref \u56DE\u8C03\uFF0C\u76F4\u63A5 applyRef(el, value) \u4F1A\u4EE4 value(el) \u88AB\u8C03\u7528\n        applyRef(el, value);\n      }\n      continue;\n    }\n\n    // dangerouslySetInnerHTML\uFF1A\u539F\u59CB HTML \u6CE8\u5165\uFF0C\u540C v-html \u98CE\u9669\uFF0C\u4EC5\u9650\u4FE1\u4EFB\u5185\u5BB9\uFF0C\u7981\u6B62\u672A sanitize \u7528\u6237\u8F93\u5165\n    if (\n      key === \"dangerouslySetInnerHTML\" && value != null &&\n      typeof value === \"object\"\n    ) {\n      const inner = (value as { __html?: string }).__html;\n      if (inner != null) {\n        (el as HTMLElement).innerHTML = inner;\n      }\n      continue;\n    }\n\n    if (isSignalGetter(value)) {\n      createEffect(() => {\n        applySingleProp(el, key, (value as () => unknown)());\n      });\n      continue;\n    }\n    // value \u652F\u6301\u4E24\u79CD\u5199\u6CD5\uFF1Avalue={value} \u76F4\u63A5\u5E94\u7528\uFF08\u8D70\u4E0B\u65B9 applySingleProp\uFF09\uFF1Bvalue={() => value} \u5728 effect \u4E2D\u6C42\u503C\u3001\u7EC6\u7C92\u5EA6\u66F4\u65B0\n    if (key === \"value\" && typeof value === \"function\") {\n      createEffect(() => {\n        applySingleProp(el, key, (value as () => unknown)());\n      });\n      continue;\n    }\n    // checked \u652F\u6301\u4E24\u79CD\u5199\u6CD5\uFF1Achecked={bool} \u76F4\u63A5\u5E94\u7528\uFF1Bchecked={() => bool} \u5728 effect \u4E2D\u6C42\u503C\u3001\u7EC6\u7C92\u5EA6\u66F4\u65B0\n    if (key === \"checked\" && typeof value === \"function\") {\n      createEffect(() => {\n        applySingleProp(el, key, (value as () => unknown)());\n      });\n      continue;\n    }\n\n    // \u76F4\u63A5\u4F20\u503C\uFF08\u542B value={value}\u3001checked={bool}\uFF09\uFF1A\u5E94\u7528\u4E00\u6B21\uFF1B\u82E5 value \u6765\u81EA\u54CD\u5E94\u5F0F\u8BFB\u53D6\u5219\u6839\u4F1A\u8BA2\u9605\n    applySingleProp(el, key, value);\n  }\n  applyDirectives(el, props, createEffect, registerDirectiveUnmount);\n}\n\n/** \u5B58\u5728\u5143\u7D20\u4E0A\u7684\u4E8B\u4EF6\u76D1\u542C\u5668 key \u524D\u7F00\uFF0C\u7528\u4E8E\u66FF\u6362\u65F6 remove \u65E7\u76D1\u542C */\nconst VIEW_EVENT_KEY_PREFIX = \"__view$on:\";\n\n/**\n * \u5224\u65AD\u5F53\u524D\u83B7\u5F97\u7126\u70B9\u7684\u662F\u5426\u4E3A\u6307\u5B9A\u8868\u5355\u5143\u7D20\uFF08\u6216\u5176\u5185\u90E8\u5143\u7D20\uFF09\u3002\n * \u7528\u4E8E\u5728\u5E94\u7528 value \u65F6\u8DF3\u8FC7\u6B63\u5728\u7F16\u8F91\u7684\u8F93\u5165\u6846\uFF0C\u907F\u514D\u91CD\u6E32\u67D3\u8986\u76D6\u7528\u6237\u8F93\u5165\u3002\n */\nfunction isFocusedFormElement(el: Element): boolean {\n  if (typeof globalThis.document === \"undefined\") return false;\n  const active = globalThis.document.activeElement;\n  if (!active) return false;\n  return active === el || el.contains(active);\n}\n\n/**\n * \u8BBE\u7F6E\u5355\u4E2A prop\uFF1A\u4E8B\u4EF6\u3001className\u3001style\u3001\u5E03\u5C14/\u8868\u5355\u5C5E\u6027\u3001\u901A\u7528 attribute\n * \u4E8B\u4EF6\u4F7F\u7528 addEventListener \u7ED1\u5B9A\uFF0C\u907F\u514D\u90E8\u5206\u73AF\u5883\u4E0B\u76F4\u63A5\u8D4B on* \u4E0D\u751F\u6548\uFF08\u5982\u52A8\u6001\u521B\u5EFA\u8282\u70B9\u3001\u67D0\u4E9B CSP\uFF09\n */\nfunction applySingleProp(el: Element, key: string, value: unknown): void {\n  const viewEl = el as ElementWithViewData;\n  if (key.startsWith(\"on\") && key.length > 2) {\n    const event = key.slice(2).toLowerCase();\n    const storageKey = VIEW_EVENT_KEY_PREFIX + event;\n    const prev = viewEl[storageKey] as ((e: Event) => void) | undefined;\n    if (typeof prev === \"function\") {\n      el.removeEventListener(event, prev);\n      viewEl[storageKey] = undefined;\n    }\n    if (typeof value === \"function\") {\n      const fn = value as (e: Event) => void;\n      viewEl[storageKey] = fn;\n      el.addEventListener(event, fn);\n    }\n    return;\n  }\n  if (key === \"className\") {\n    const classVal = value == null ? \"\" : String(value);\n    // SVG \u5143\u7D20\u7684 className \u4E3A\u53EA\u8BFB\uFF08SVGAnimatedString\uFF09\uFF0C\u5FC5\u987B\u7528 setAttribute\n    if (el.namespaceURI === \"http://www.w3.org/2000/svg\") {\n      el.setAttribute(\"class\", classVal);\n    } else {\n      (el as HTMLElement).className = classVal;\n    }\n    return;\n  }\n  if (key === \"style\" && value != null) {\n    const style = (el as HTMLElement).style;\n    if (typeof value === \"string\") {\n      style.cssText = value;\n    } else if (typeof value === \"object\") {\n      for (const [k, v] of Object.entries(value as Record<string, unknown>)) {\n        (style as unknown as Record<string, string>)[k] = v == null\n          ? \"\"\n          : String(v);\n      }\n    }\n    return;\n  }\n  // innerHTML \u4F5C\u4E3A\u666E\u901A prop\uFF1A\u539F\u59CB HTML \u6CE8\u5165\uFF0C\u4EC5\u9650\u4FE1\u4EFB\u5185\u5BB9\uFF0C\u7981\u6B62\u672A sanitize \u7528\u6237\u8F93\u5165\uFF08\u4E0E v-html \u540C\u4E00\u98CE\u9669\uFF09\n  if (key === \"innerHTML\") {\n    (el as HTMLElement).innerHTML = value == null ? \"\" : String(value);\n    return;\n  }\n  if (value == null || value === false) {\n    el.removeAttribute(key);\n    if (\n      key === \"disabled\" || key === \"readOnly\" || key === \"multiple\" ||\n      key === \"selected\" || key === \"checked\"\n    ) {\n      viewEl[key] = false;\n    }\n    return;\n  }\n  if (value === true) {\n    el.setAttribute(key, \"\");\n    if (\n      key === \"disabled\" || key === \"readOnly\" || key === \"multiple\" ||\n      key === \"selected\" || key === \"checked\"\n    ) {\n      viewEl[key] = true;\n    }\n    return;\n  }\n  const str = String(value);\n  if (key === \"value\") {\n    const formEl = el as\n      | HTMLInputElement\n      | HTMLTextAreaElement\n      | HTMLSelectElement;\n    if (isFocusedFormElement(el)) return;\n    formEl.value = str;\n    return;\n  }\n  if (key === \"checked\" || key === \"selected\") {\n    viewEl[key] = Boolean(value);\n    el.setAttribute(key, str);\n    return;\n  }\n  if (key === \"disabled\" || key === \"readOnly\" || key === \"multiple\") {\n    viewEl[key] = Boolean(value);\n  }\n  const attrName = key === \"htmlFor\" ? \"for\" : key;\n  el.setAttribute(attrName, str);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u5C06 VNode \u8F6C\u4E3A\u6D4F\u89C8\u5668 DOM \u8282\u70B9\n *\n * \u652F\u6301 v-if / v-else / v-for / v-show / v-text / v-html / v-once\u3001Fragment\u3001keyed \u5217\u8868\u3001\u52A8\u6001\u5B50\u8282\u70B9\n */\n\nimport { createEffect } from \"../effect.ts\";\nimport { isSignalGetter } from \"../signal.ts\";\nimport { isDOMEnvironment } from \"../types.ts\";\nimport type { VNode } from \"../types.ts\";\nimport { getErrorBoundaryFallback, isErrorBoundary } from \"../boundary.ts\";\nimport {\n  getDirectiveValue,\n  getVElseIfValue,\n  getVElseShow,\n  getVForListAndFactory,\n  getVIfValue,\n  hasDirective,\n  hasStructuralDirective,\n  resolveVForFactory,\n} from \"../directive.ts\";\nimport { getContextBinding, popContext, pushContext } from \"../context.ts\";\nimport type { IfContext } from \"./shared.ts\";\nimport { isFragment as checkFragment } from \"./shared.ts\";\nimport { applyProps } from \"./props.ts\";\nimport {\n  runDirectiveUnmount,\n  runDirectiveUnmountOnChildren,\n} from \"./unmount.ts\";\n\n/** SVG \u547D\u540D\u7A7A\u95F4\uFF0C\u7528\u4E8E createElementNS */\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\n/** \u89C4\u8303\u5316 children \u7684\u8FD4\u56DE\u9879\uFF1AVNode \u6216 signal getter\uFF08\u7528\u4E8E\u52A8\u6001\u5B50\u8282\u70B9\uFF09 */\nexport type ChildItem = VNode | (() => unknown);\n\nconst KEYED_WRAPPER_ATTR = \"data-view-keyed\";\n\n/**\n * v-once\uFF1A\u51BB\u7ED3 vnode\uFF08props/children \u4E2D getter \u6C42\u503C\u4E00\u6B21\uFF09\uFF0C\u8FD4\u56DE\u65E0 getter \u7684 vnode \u4F9B createElement \u53EA\u6E32\u67D3\u4E00\u6B21\n */\nfunction freezeVNodeForOnce(vnode: VNode): VNode {\n  const props = vnode.props;\n  const frozenProps: Record<string, unknown> = {};\n  for (const [k, v] of Object.entries(props)) {\n    if (k === \"vOnce\" || k === \"v-once\") continue;\n    frozenProps[k] = isSignalGetter(v) ? getDirectiveValue(v) : v;\n  }\n  frozenProps.children = freezeChildrenForOnce(\n    props.children ?? vnode.children,\n  );\n  return { type: vnode.type, props: frozenProps, key: vnode.key, children: [] };\n}\n\nfunction freezeChildrenForOnce(raw: unknown): unknown {\n  if (isSignalGetter(raw)) {\n    return freezeChildrenForOnce(getDirectiveValue(raw));\n  }\n  if (Array.isArray(raw)) {\n    return raw.map((c) => freezeChildrenForOnce(c));\n  }\n  if (raw != null && typeof raw === \"object\" && \"type\" in raw) {\n    return freezeVNodeForOnce(raw as VNode);\n  }\n  return raw;\n}\n\n/**\n * \u89E3\u6790\u5F53\u524D\u5143\u7D20\u7684\u547D\u540D\u7A7A\u95F4\uFF1A\u5728 svg \u5185\u6216\u81EA\u8EAB\u4E3A svg \u65F6\u4F7F\u7528 SVG_NS\n */\nfunction resolveNamespace(\n  tag: string,\n  parentNamespace: string | null,\n): string | null {\n  if (parentNamespace === SVG_NS) return SVG_NS;\n  if (tag === \"svg\") return SVG_NS;\n  return null;\n}\n\n/**\n * \u89C4\u8303\u5316 children\uFF1A\u53EF\u80FD\u662F\u5355\u4E2A VNode\u3001\u6570\u7EC4\u3001signal getter\u3001\u666E\u901A\u51FD\u6570\uFF08\u52A8\u6001\u5B50\u8282\u70B9\uFF09\u3001\u6216\u539F\u59CB\u503C\uFF08\u8F6C\u6210\u6587\u672C VNode\uFF09\n * \u8FD4\u56DE\u9879\u4E3A VNode \u6216 getter/\u51FD\u6570\uFF0C\u4F9B createElement \u533A\u5206\u9759\u6001\u5B50\u4E0E\u52A8\u6001\u5B50\uFF1B\u5355\u6B21\u904D\u5386\u6536\u96C6\u51CF\u5C11 flatMap \u4E2D\u95F4\u6570\u7EC4\n */\nexport function normalizeChildren(children: unknown): ChildItem[] {\n  if (children == null) return [];\n  if (isSignalGetter(children)) {\n    return [children as () => unknown];\n  }\n  /** \u666E\u901A\u51FD\u6570\u5B50\u8282\u70B9\uFF08\u5982 () => { const r = resource(); return r.data ? ... : ... }\uFF09\u6309\u52A8\u6001\u5B50\u8282\u70B9\u5904\u7406\uFF0C\u5728 effect \u4E2D\u6C42\u503C\u5E76\u8BA2\u9605 */\n  if (typeof children === \"function\") {\n    return [children as () => unknown];\n  }\n  if (Array.isArray(children)) {\n    const out: ChildItem[] = [];\n    for (const c of children) {\n      const items = normalizeChildren(c);\n      for (const item of items) out.push(item);\n    }\n    return out;\n  }\n  if (\n    typeof children === \"object\" && children !== null && \"type\" in children &&\n    \"props\" in children\n  ) {\n    return [children as VNode];\n  }\n  return [{\n    type: \"#text\",\n    props: { nodeValue: String(children) },\n    children: [],\n  }];\n}\n\n/** \u5224\u65AD ChildItem \u5217\u8868\u662F\u5426\u5305\u542B\u4EFB\u610F\u5E26 key \u7684 VNode */\nfunction hasAnyKey(items: ChildItem[]): boolean {\n  for (const x of items) {\n    if (!isSignalGetter(x) && (x as VNode).key != null) return true;\n  }\n  return false;\n}\n\n/**\n * \u6309 key \u534F\u8C03\u5217\u8868\uFF1A\u590D\u7528\u5DF2\u6709 DOM \u8282\u70B9\uFF08\u540C key \u4EC5\u66F4\u65B0\u5185\u5BB9\uFF09\uFF0C\u51CF\u5C11\u91CD\u6302\n */\nfunction reconcileKeyedChildren(\n  container: Element,\n  items: ChildItem[],\n  parentNamespace: string | null,\n  ifContext?: IfContext,\n): void {\n  const doc = (globalThis as { document: Document }).document;\n  const keyToWrapper = new Map<string, Element>();\n  for (const child of Array.from(container.children)) {\n    const key = (child as Element).getAttribute?.(\"data-key\");\n    if (key != null) keyToWrapper.set(key, child as Element);\n  }\n  const resultNodes: Node[] = [];\n  const ctx = ifContext ?? { lastVIf: true };\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i];\n    if (isSignalGetter(item)) {\n      const wrap = doc.createElement(\"span\");\n      wrap.setAttribute(\"data-view-dynamic\", \"\");\n      appendDynamicChild(wrap, item as () => unknown, parentNamespace, ctx);\n      resultNodes.push(wrap);\n      continue;\n    }\n    const v = item as VNode;\n    const key = v.key != null ? String(v.key) : `@${i}`;\n    let wrapper = keyToWrapper.get(key);\n    if (wrapper) {\n      keyToWrapper.delete(key);\n      runDirectiveUnmountOnChildren(wrapper);\n      wrapper.replaceChildren(createElement(v, parentNamespace, ctx));\n      resultNodes.push(wrapper);\n    } else {\n      wrapper = doc.createElement(\"span\");\n      wrapper.setAttribute(KEYED_WRAPPER_ATTR, \"\");\n      wrapper.setAttribute(\"data-key\", key);\n      wrapper.appendChild(createElement(v, parentNamespace, ctx));\n      resultNodes.push(wrapper);\n    }\n  }\n  runDirectiveUnmountOnChildren(container);\n  container.replaceChildren(...resultNodes);\n}\n\n/**\n * \u6302\u8F7D\u201C\u52A8\u6001\u5B50\u8282\u70B9\u201D\uFF1A\u7528 createEffect \u6839\u636E getter \u7684\u5F53\u524D\u503C\u521B\u5EFA\u5E76\u66FF\u6362\u5B50\u5185\u5BB9\n * \u82E5\u5B50\u9879\u5E26 key \u5219\u505A keyed \u534F\u8C03\u4EE5\u590D\u7528 DOM\n */\nexport function appendDynamicChild(\n  parent: Element | DocumentFragment,\n  getter: () => unknown,\n  parentNamespace: string | null,\n  ifContext?: IfContext,\n): void {\n  const doc = (globalThis as { document: Document }).document;\n  const placeholder = doc.createElement(\"span\");\n  placeholder.setAttribute(\"data-view-dynamic\", \"\");\n  parent.appendChild(placeholder);\n\n  createEffect(() => {\n    const value = getter();\n    const items = normalizeChildren(value);\n    const ctx = ifContext ?? { lastVIf: true };\n    if (items.length > 0 && hasAnyKey(items)) {\n      reconcileKeyedChildren(\n        placeholder as Element,\n        items,\n        parentNamespace,\n        ctx,\n      );\n      return;\n    }\n    const frag = doc.createDocumentFragment();\n    for (const v of items) {\n      if (isSignalGetter(v)) {\n        const inner = doc.createElement(\"span\");\n        inner.setAttribute(\"data-view-dynamic\", \"\");\n        frag.appendChild(inner);\n        appendDynamicChild(inner, v as () => unknown, parentNamespace, ctx);\n      } else {\n        frag.appendChild(createElement(v as VNode, parentNamespace, ctx));\n      }\n    }\n    runDirectiveUnmountOnChildren(placeholder);\n    placeholder.replaceChildren(frag);\n  });\n}\n\n/**\n * \u6536\u96C6\u4ECE startIndex \u8D77\u7684\u8FDE\u7EED vIf / vElseIf / vElse \u8282\u70B9\uFF08\u7528\u4E8E\u4E00\u7EC4\u7528\u4E00\u4E2A effect \u54CD\u5E94\u5F0F\u6E32\u67D3\uFF09\n * \u9996\u9879\u5FC5\u987B\u4E3A\u5E26 getter \u7684 vIf\uFF0C\u5426\u5219\u8FD4\u56DE\u7A7A\u6570\u7EC4\n */\nfunction collectVIfGroup(\n  list: ChildItem[],\n  startIndex: number,\n): VNode[] {\n  const first = list[startIndex];\n  if (isSignalGetter(first)) return [];\n  const v0 = first as VNode;\n  const vIfRaw = v0.props[\"vIf\"] ?? v0.props[\"v-if\"];\n  const isReactiveVIf = typeof vIfRaw === \"function\" || isSignalGetter(vIfRaw);\n  if (!hasDirective(v0.props, \"vIf\") || !isReactiveVIf) return [];\n\n  const group: VNode[] = [v0];\n  for (let i = startIndex + 1; i < list.length; i++) {\n    const it = list[i];\n    if (isSignalGetter(it)) break;\n    const v = it as VNode;\n    if (hasDirective(v.props, \"vElseIf\") || hasDirective(v.props, \"vElse\")) {\n      group.push(v);\n    } else {\n      break;\n    }\n  }\n  return group;\n}\n\n/**\n * \u521B\u5EFA vIf/vElseIf/vElse \u7EC4\u7684\u5360\u4F4D\u8282\u70B9\uFF1A\u5355\u4E00 effect \u5185\u6309\u987A\u5E8F\u6C42\u503C\uFF0C\u6E32\u67D3\u7B2C\u4E00\u4E2A\u4E3A true \u7684\u5206\u652F\uFF0C\u4FDD\u8BC1 getter \u88AB\u8BFB\u3001effect \u80FD\u8BA2\u9605\n */\nfunction createVIfGroupPlaceholder(\n  group: VNode[],\n  parentNamespace: string | null,\n  ifContext: IfContext,\n): Element {\n  const doc = (globalThis as { document: Document }).document;\n  const placeholder = doc.createElement(\"span\");\n  placeholder.setAttribute(\"data-view-v-if-group\", \"\");\n\n  createEffect(() => {\n    let showIndex = -1;\n    for (let i = 0; i < group.length; i++) {\n      const v = group[i];\n      const props = v.props;\n      if (i === 0) {\n        if (getVIfValue(props)) {\n          showIndex = i;\n          break;\n        }\n      } else if (hasDirective(props, \"vElse\")) {\n        showIndex = i;\n        break;\n      } else if (hasDirective(props, \"vElseIf\")) {\n        if (getVElseIfValue(props)) {\n          showIndex = i;\n          break;\n        }\n      }\n    }\n    runDirectiveUnmountOnChildren(placeholder);\n    placeholder.replaceChildren();\n    if (showIndex >= 0) {\n      const chosen = group[showIndex];\n      const stripProps = { ...chosen.props };\n      delete stripProps.vIf;\n      delete stripProps[\"v-if\"];\n      delete stripProps.vElseIf;\n      delete stripProps[\"v-else-if\"];\n      delete stripProps.vElse;\n      delete stripProps[\"v-else\"];\n      const next = createElement(\n        { ...chosen, props: stripProps },\n        parentNamespace,\n        ifContext,\n      );\n      placeholder.appendChild(next);\n    }\n  });\n\n  return placeholder;\n}\n\n/**\n * \u5411\u7236\u8282\u70B9\u8FFD\u52A0\u5B50\u8282\u70B9\uFF1B\u652F\u6301 children \u4E3A signal getter \u6216\u6570\u7EC4\u4E2D\u542B getter \u7684\u7EC6\u7C92\u5EA6\u66F4\u65B0\n * ifContext \u7528\u4E8E v-else\uFF1A\u540C\u4E00\u6279\u5144\u5F1F\u5171\u4EAB\uFF0C\u8BB0\u5F55\u4E0A\u4E00\u4E2A v-if \u7684\u7ED3\u679C\n */\nfunction appendChildren(\n  parent: Element | DocumentFragment,\n  rawChildren: unknown,\n  parentNamespace: string | null,\n  ifContext?: IfContext,\n): void {\n  if (!isDOMEnvironment()) return;\n\n  const ctx = ifContext ?? { lastVIf: true };\n  if (typeof rawChildren === \"function\" || isSignalGetter(rawChildren)) {\n    appendDynamicChild(\n      parent,\n      rawChildren as () => unknown,\n      parentNamespace,\n      ctx,\n    );\n    return;\n  }\n\n  const list = normalizeChildren(rawChildren);\n  let i = 0;\n  while (i < list.length) {\n    const item = list[i];\n    if (typeof item === \"function\" || isSignalGetter(item)) {\n      appendDynamicChild(parent, item as () => unknown, parentNamespace, ctx);\n      i++;\n      continue;\n    }\n    const vnode = item as VNode;\n    const vIfRaw = vnode.props[\"vIf\"] ?? vnode.props[\"v-if\"];\n    const isDynamicVIf = hasDirective(vnode.props, \"vIf\") &&\n      (typeof vIfRaw === \"function\" || isSignalGetter(vIfRaw));\n    if (isDynamicVIf) {\n      const group = collectVIfGroup(list, i);\n      if (group.length > 0) {\n        parent.appendChild(\n          createVIfGroupPlaceholder(group, parentNamespace, ctx),\n        );\n        i += group.length;\n        continue;\n      }\n    }\n    parent.appendChild(createElement(vnode, parentNamespace, ctx));\n    i++;\n  }\n}\n\n/**\n * \u5C06 VNode \u8F6C\u4E3A\u6D4F\u89C8\u5668 DOM \u8282\u70B9\uFF08\u6216 DocumentFragment\uFF09\n *\n * \u9519\u8BEF\u5904\u7406\uFF1A\u7EC4\u4EF6\u6267\u884C\u65F6\u82E5\u629B\u51FA\u9519\u8BEF\uFF0C\u88AB ErrorBoundary \u5305\u88F9\u7684\u4F1A\u6355\u83B7\u5E76\u6E32\u67D3 fallback\uFF1B\n * \u5176\u4F59\u9519\u8BEF\u4F1A\u5192\u6CE1\uFF0C\u8C03\u7528\u65B9\u9700\u81EA\u884C try/catch \u6216\u4FDD\u8BC1\u7EC4\u4EF6\u4E0D\u629B\u9519\u3002\n *\n * @param parentNamespace \u7236\u7EA7\u547D\u540D\u7A7A\u95F4\uFF08\u5982 SVG_NS\uFF09\uFF0C\u7528\u4E8E\u6B63\u786E\u521B\u5EFA svg \u5185\u5B50\u5143\u7D20\n * @param ifContext \u53EF\u9009\uFF0C\u7528\u4E8E v-else\uFF1A\u540C\u4E00\u6279\u5144\u5F1F\u4E2D\u4E0A\u4E00\u4E2A v-if \u7684\u7ED3\u679C\n */\nexport function createElement(\n  vnode: VNode,\n  parentNamespace: string | null = null,\n  ifContext?: IfContext,\n): Node {\n  const doc = (globalThis as { document: Document }).document;\n\n  if (checkFragment(vnode)) {\n    const frag = doc.createDocumentFragment();\n    const rawChildren = vnode.props.children ?? vnode.children;\n    appendChildren(frag, rawChildren, parentNamespace, ifContext);\n    return frag;\n  }\n\n  if (typeof vnode.type === \"function\") {\n    const type = vnode.type;\n    const props = vnode.props;\n    const binding = getContextBinding(type, props);\n    if (binding) pushContext(binding.id, binding.value);\n    try {\n      let result: VNode | VNode[] | null;\n      result = type(props);\n      if (result == null) return doc.createTextNode(\"\");\n      const nodes = Array.isArray(result) ? result : [result];\n      if (nodes.length === 0) return doc.createTextNode(\"\");\n      if (isErrorBoundary(type)) {\n        try {\n          if (nodes.length === 1) {\n            return createElement(nodes[0], parentNamespace, ifContext);\n          }\n          const frag = doc.createDocumentFragment();\n          for (const n of nodes) {\n            frag.appendChild(createElement(n, parentNamespace, ifContext));\n          }\n          return frag;\n        } catch (e) {\n          return createElement(getErrorBoundaryFallback(props)(e));\n        }\n      }\n      if (nodes.length === 1) {\n        return createElement(nodes[0], parentNamespace, ifContext);\n      }\n      const frag = doc.createDocumentFragment();\n      for (const n of nodes) {\n        frag.appendChild(createElement(n, parentNamespace, ifContext));\n      }\n      return frag;\n    } finally {\n      if (binding) popContext(binding.id);\n    }\n  }\n\n  const tag = vnode.type as string;\n  if (tag === \"#text\") {\n    return doc.createTextNode(\n      String((vnode.props as { nodeValue?: unknown }).nodeValue ?? \"\"),\n    );\n  }\n\n  const props = vnode.props;\n  const structural = hasStructuralDirective(props);\n\n  // v-once\uFF1A\u53EA\u6E32\u67D3\u4E00\u6B21\uFF0C\u51BB\u7ED3 props/children \u4E2D\u6240\u6709 getter \u540E\u9012\u5F52\uFF0C\u4E0D\u5EFA\u7ACB effect\n  if (hasDirective(props, \"vOnce\")) {\n    return createElement(\n      freezeVNodeForOnce(vnode),\n      parentNamespace,\n      ifContext,\n    );\n  }\n\n  // v-else\uFF1A\u4EC5\u5F53\u4E0A\u4E00\u4E2A v-if \u4E3A false \u65F6\u6E32\u67D3\n  if (hasDirective(props, \"vElse\")) {\n    if (ifContext && !getVElseShow(ifContext.lastVIf)) {\n      return doc.createTextNode(\"\");\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n\n  // v-else-if\uFF1A\u4EC5\u5F53\u4E0A\u4E00\u4E2A v-if \u4E3A false \u65F6\u518D\u5224\u65AD\u672C\u5206\u652F\u6761\u4EF6\n  if (hasDirective(props, \"vElseIf\")) {\n    if (ifContext && ifContext.lastVIf) {\n      return doc.createTextNode(\"\");\n    }\n    const elseIfShow = getVElseIfValue(props);\n    if (!elseIfShow) {\n      if (ifContext) ifContext.lastVIf = false;\n      return doc.createTextNode(\"\");\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n\n  // v-if\uFF1A\u4E3A false \u4E0D\u6E32\u67D3\uFF1B\u4E3A getter \u6216\u666E\u901A\u65E0\u53C2\u51FD\u6570\u65F6\u7528 placeholder + effect \u505A\u52A8\u6001\u663E\u793A/\u9690\u85CF\n  if (structural === \"vIf\") {\n    const vIfRaw = props[\"vIf\"] ?? props[\"v-if\"];\n    const isReactiveVIf = typeof vIfRaw === \"function\" ||\n      isSignalGetter(vIfRaw);\n    if (isReactiveVIf) {\n      const placeholder = doc.createElement(\"span\");\n      placeholder.setAttribute(\"data-view-v-if\", \"\");\n      createEffect(() => {\n        const show = getVIfValue(props);\n        runDirectiveUnmountOnChildren(placeholder);\n        placeholder.replaceChildren();\n        if (show) {\n          const next = createElement(\n            {\n              ...vnode,\n              props: { ...props, vIf: undefined, \"v-if\": undefined },\n            },\n            parentNamespace,\n            ifContext,\n          );\n          placeholder.appendChild(next);\n        }\n        if (ifContext) ifContext.lastVIf = show;\n      });\n      return placeholder;\n    }\n    if (!getVIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return doc.createTextNode(\"\");\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n\n  // v-for\uFF1A\u6309 list \u91CD\u590D\u6E32\u67D3\uFF1Blist \u4E3A getter \u6216\u666E\u901A\u65E0\u53C2\u51FD\u6570\u65F6\u7528 placeholder + effect \u52A8\u6001\u66F4\u65B0\n  if (structural === \"vFor\") {\n    const rawChildren = props.children ?? vnode.children;\n    const rawList = props[\"vFor\"] ?? props[\"v-for\"];\n    const isReactiveVFor = typeof rawList === \"function\" ||\n      isSignalGetter(rawList);\n    if (isReactiveVFor) {\n      const placeholder = doc.createElement(\"span\");\n      placeholder.setAttribute(\"data-view-v-for\", \"\");\n      const templateProps = { ...props, vFor: undefined, \"v-for\": undefined };\n      const vForNs = resolveNamespace(tag, parentNamespace);\n      const childNs = vForNs ?? (tag === \"svg\" ? SVG_NS : null);\n      createEffect(() => {\n        const resolved = typeof rawList === \"function\"\n          ? (rawList as () => unknown)()\n          : (rawList as () => unknown)();\n        const list = Array.isArray(resolved) ? (resolved as unknown[]) : [];\n        // \u652F\u6301 children \u4E3A\u5DE5\u5382\u51FD\u6570\uFF0C\u6216 expand \u540E\u7684\u5355\u5143\u7D20\u6570\u7EC4 [factory]\n        const factory = resolveVForFactory(rawChildren);\n        const frag = doc.createDocumentFragment();\n        for (let i = 0; i < list.length; i++) {\n          const item = list[i];\n          const childResult = factory(item, i);\n          const childNodes = Array.isArray(childResult)\n            ? childResult\n            : [childResult];\n          const first = childNodes[0] as VNode | undefined;\n          const itemVnode: VNode = {\n            type: tag,\n            props: {\n              ...templateProps,\n              children: childNodes.length === 1 ? childNodes[0] : childNodes,\n            },\n            key: first?.key != null ? first.key : i,\n          };\n          frag.appendChild(createElement(itemVnode, childNs, ifContext));\n        }\n        runDirectiveUnmountOnChildren(placeholder);\n        placeholder.replaceChildren(frag);\n      });\n      return placeholder;\n    }\n    const parsed = getVForListAndFactory(props, rawChildren);\n    if (parsed) {\n      const { list, factory } = parsed;\n      const frag = doc.createDocumentFragment();\n      const vForNs = resolveNamespace(tag, parentNamespace);\n      const childNs = vForNs ?? (tag === \"svg\" ? SVG_NS : null);\n      const templateProps = { ...props, vFor: undefined, \"v-for\": undefined };\n      for (let i = 0; i < list.length; i++) {\n        const item = list[i];\n        const childResult = factory(item, i);\n        const childNodes = Array.isArray(childResult)\n          ? childResult\n          : [childResult];\n        const first = childNodes[0] as VNode | undefined;\n        const itemVnode: VNode = {\n          type: tag,\n          props: {\n            ...templateProps,\n            children: childNodes.length === 1 ? childNodes[0] : childNodes,\n          },\n          key: first?.key != null ? first.key : i,\n        };\n        frag.appendChild(createElement(itemVnode, childNs, ifContext));\n      }\n      return frag;\n    }\n  }\n\n  const ns = resolveNamespace(tag, parentNamespace);\n  const el = ns ? doc.createElementNS(ns, tag) : doc.createElement(tag);\n  if (vnode.key != null && vnode.key !== undefined) {\n    el.setAttribute(\"data-key\", String(vnode.key));\n  }\n  applyProps(el as Element, props);\n  // v-text / v-html \u65F6\u4EC5\u663E\u793A\u6587\u672C\u6216 HTML\uFF0C\u4E0D\u6302\u8F7D children\n  if (!hasDirective(props, \"vText\") && !hasDirective(props, \"vHtml\")) {\n    const rawChildren = props.children ?? vnode.children;\n    appendChildren(\n      el as Element,\n      rawChildren,\n      ns ?? (tag === \"svg\" ? SVG_NS : null),\n      ifContext,\n    );\n  }\n  return el;\n}\n\n/** \u5C55\u5F00\u540E\u7684\u6839\uFF1A\u5355\u8282\u70B9\u6216\u7247\u6BB5\u5B50\u9879\u5217\u8868\uFF08\u7528\u4E8E\u6839\u534F\u8C03\uFF0C\u907F\u514D\u6574\u6811\u66FF\u6362\uFF09 */\nexport type ExpandedRoot = VNode | ChildItem[];\n\n/**\n * \u4EC5\u5C55\u5F00\u7EC4\u4EF6\u4E3A\u5B50\u8282\u70B9\uFF0C\u4E0D\u6C42\u503C getter\uFF1B\u7528\u4E8E\u6839\u534F\u8C03\u65F6\u5F97\u5230\u53EF diff \u7684\u6811\u3002\n * \u8FD4\u56DE\u5355\u8282\u70B9\u6216\u7247\u6BB5\u5B50\u9879\u6570\u7EC4\uFF08ChildItem[]\uFF09\u3002\n */\nexport function expandVNode(vnode: VNode): ExpandedRoot {\n  if (checkFragment(vnode)) {\n    const rawChildren = vnode.props.children ?? vnode.children;\n    const list = normalizeChildren(rawChildren);\n    const out: ChildItem[] = [];\n    for (const item of list) {\n      if (isSignalGetter(item) || typeof item === \"function\") {\n        out.push(item as () => unknown);\n      } else {\n        const expanded = expandVNode(item as VNode);\n        if (Array.isArray(expanded)) {\n          out.push(...expanded);\n        } else {\n          out.push(expanded);\n        }\n      }\n    }\n    return out;\n  }\n\n  if (typeof vnode.type === \"function\") {\n    const type = vnode.type;\n    const props = vnode.props;\n    const binding = getContextBinding(type, props);\n    if (binding) pushContext(binding.id, binding.value);\n    try {\n      const result: VNode | VNode[] | null = type(props);\n      if (result == null) {\n        return { type: \"#text\", props: { nodeValue: \"\" }, children: [] };\n      }\n      const nodes = Array.isArray(result) ? result : [result];\n      if (nodes.length === 0) {\n        return { type: \"#text\", props: { nodeValue: \"\" }, children: [] };\n      }\n      if (isErrorBoundary(type)) {\n        try {\n          if (nodes.length === 1) return expandVNode(nodes[0] as VNode);\n          const out: ChildItem[] = [];\n          for (const n of nodes) {\n            const e = expandVNode(n as VNode);\n            if (Array.isArray(e)) out.push(...e);\n            else out.push(e);\n          }\n          return out;\n        } catch (e) {\n          const fallbackVNode = getErrorBoundaryFallback(props)(e);\n          return fallbackVNode && typeof fallbackVNode === \"object\" &&\n              \"type\" in fallbackVNode\n            ? expandVNode(fallbackVNode as VNode)\n            : { type: \"#text\", props: { nodeValue: \"\" }, children: [] };\n        }\n      }\n      if (nodes.length === 1) return expandVNode(nodes[0] as VNode);\n      const out: ChildItem[] = [];\n      for (const n of nodes) {\n        const e = expandVNode(n as VNode);\n        if (Array.isArray(e)) out.push(...e);\n        else out.push(e);\n      }\n      return out;\n    } finally {\n      if (binding) popContext(binding.id);\n    }\n  }\n\n  if (vnode.type === \"#text\") return vnode;\n\n  const props = vnode.props;\n  const rawChildren = props.children ?? vnode.children;\n  const list = normalizeChildren(rawChildren);\n  const newChildren: ChildItem[] = [];\n  for (const item of list) {\n    if (isSignalGetter(item) || typeof item === \"function\") {\n      newChildren.push(item as () => unknown);\n    } else {\n      const e = expandVNode(item as VNode);\n      if (Array.isArray(e)) newChildren.push(...e);\n      else newChildren.push(e);\n    }\n  }\n  return {\n    type: vnode.type,\n    props: { ...props, children: newChildren },\n    key: vnode.key,\n    children: [],\n  };\n}\n\n/**\n * \u6839\u636E\u5C55\u5F00\u6839\u521B\u5EFA DOM\uFF08\u5355\u8282\u70B9\u7528 createElement\uFF0C\u7247\u6BB5\u7528 appendChildren\uFF09\uFF1B\u4F9B createRoot \u9996\u6B21\u6302\u8F7D\u4F7F\u7528\n */\nexport function createNodeFromExpanded(expanded: ExpandedRoot): Node {\n  const doc = (globalThis as { document: Document }).document;\n  if (Array.isArray(expanded)) {\n    const frag = doc.createDocumentFragment();\n    appendChildren(frag, expanded, null);\n    return frag;\n  }\n  return createElement(expanded);\n}\n\n/**\n * \u534F\u8C03\u4E24\u68F5\u5B50\u9879\u5217\u8868\u5230\u7236\u8282\u70B9\u4E0A\uFF1A\u6309\u7D22\u5F15\u5BF9\u9F50\uFF0C\u540C\u7C7B\u578B\u540C key \u5219 patch\uFF0C\u5426\u5219\u66FF\u6362\n */\nfunction reconcileChildren(\n  parent: Element | DocumentFragment,\n  oldItems: ChildItem[],\n  newItems: ChildItem[],\n  parentNamespace: string | null,\n  ifContext: IfContext,\n): void {\n  const doc = (globalThis as { document: Document }).document;\n  for (let i = parent.childNodes.length - 1; i >= newItems.length; i--) {\n    const node = parent.childNodes[i];\n    runDirectiveUnmount(node);\n    parent.removeChild(node);\n  }\n  const maxLen = Math.max(oldItems.length, newItems.length);\n  for (let i = 0; i < maxLen; i++) {\n    const newItem = newItems[i];\n    const oldItem = oldItems[i];\n    const existing = parent.childNodes[i] as Node | undefined;\n\n    if (i >= newItems.length) continue;\n\n    if (i >= oldItems.length || !existing) {\n      const node = isSignalGetter(newItem) || typeof newItem === \"function\"\n        ? (() => {\n          const span = doc.createElement(\"span\");\n          span.setAttribute(\"data-view-dynamic\", \"\");\n          appendDynamicChild(\n            span,\n            newItem as () => unknown,\n            parentNamespace,\n            ifContext,\n          );\n          return span;\n        })()\n        : createElement(newItem as VNode, parentNamespace, ifContext);\n      if (i < parent.childNodes.length) {\n        parent.insertBefore(node, parent.childNodes[i]);\n      } else {\n        parent.appendChild(node);\n      }\n      continue;\n    }\n\n    const newIsGetter = isSignalGetter(newItem) ||\n      typeof newItem === \"function\";\n    const oldIsGetter = isSignalGetter(oldItem) ||\n      typeof oldItem === \"function\";\n    if (newIsGetter || oldIsGetter) {\n      runDirectiveUnmount(existing);\n      parent.replaceChild(\n        newIsGetter\n          ? (() => {\n            const span = doc.createElement(\"span\");\n            span.setAttribute(\"data-view-dynamic\", \"\");\n            appendDynamicChild(\n              span,\n              newItem as () => unknown,\n              parentNamespace,\n              ifContext,\n            );\n            return span;\n          })()\n          : createElement(newItem as VNode, parentNamespace, ifContext),\n        existing,\n      );\n      continue;\n    }\n\n    patchNode(\n      existing,\n      oldItem as VNode,\n      newItem as VNode,\n      parentNamespace,\n      ifContext,\n    );\n  }\n}\n\n/**\n * \u5355\u8282\u70B9 patch\uFF1A\u540C\u7C7B\u578B\u540C key \u5219\u66F4\u65B0 props \u5E76\u534F\u8C03\u5B50\u8282\u70B9\uFF0C\u5426\u5219\u66FF\u6362\n */\nfunction patchNode(\n  dom: Node,\n  oldV: VNode,\n  newV: VNode,\n  parentNamespace: string | null,\n  ifContext: IfContext,\n): void {\n  if (oldV.type === \"#text\" && newV.type === \"#text\") {\n    const newVal = String(\n      (newV.props as { nodeValue?: unknown }).nodeValue ?? \"\",\n    );\n    if (dom.nodeValue !== newVal) dom.nodeValue = newVal;\n    return;\n  }\n\n  if (oldV.type !== newV.type || String(oldV.key) !== String(newV.key)) {\n    const parent = dom.parentNode;\n    if (!parent) return;\n    const next = createElement(newV, parentNamespace, ifContext);\n    parent.replaceChild(next, dom);\n    runDirectiveUnmount(dom);\n    return;\n  }\n\n  if (typeof newV.type === \"string\" && newV.type !== \"#text\") {\n    const el = dom as Element;\n    applyProps(el, newV.props);\n    if (\n      hasDirective(newV.props, \"vText\") || hasDirective(newV.props, \"vHtml\")\n    ) return;\n    const oldChildren = normalizeChildren(\n      oldV.props?.children ?? oldV.children ?? [],\n    );\n    const newChildren = normalizeChildren(\n      newV.props?.children ?? newV.children ?? [],\n    );\n    const ns = resolveNamespace(newV.type as string, parentNamespace);\n    reconcileChildren(\n      el,\n      oldChildren,\n      newChildren,\n      ns ?? (newV.type === \"svg\" ? SVG_NS : null),\n      ifContext,\n    );\n  }\n}\n\nconst defaultIfContext: IfContext = { lastVIf: true };\n\n/**\n * \u6839\u534F\u8C03\uFF1A\u7528\u65B0\u5C55\u5F00\u6811 patch \u5DF2\u6709 DOM\uFF0C\u4E0D\u6574\u6811\u66FF\u6362\uFF0C\u4FDD\u8BC1\u8868\u5355\u7B49\u4E0D\u91CD\u6302\u3001\u4E0D\u4E22\u7126\u70B9\n */\nexport function patchRoot(\n  container: Element,\n  mounted: Node,\n  lastExpanded: ExpandedRoot,\n  newExpanded: ExpandedRoot,\n): void {\n  if (Array.isArray(lastExpanded) && Array.isArray(newExpanded)) {\n    const oldItems = lastExpanded;\n    const newItems = newExpanded;\n    const frag = mounted as DocumentFragment;\n    for (let i = frag.childNodes.length - 1; i >= newItems.length; i--) {\n      const node = frag.childNodes[i];\n      runDirectiveUnmount(node);\n      frag.removeChild(node);\n    }\n    const maxLen = Math.max(oldItems.length, newItems.length);\n    for (let i = 0; i < maxLen; i++) {\n      const existing = frag.childNodes[i] as Node | undefined;\n      const newItem = newItems[i];\n      const oldItem = oldItems[i];\n      if (i >= newItems.length) continue;\n      const doc = (globalThis as { document: Document }).document;\n      if (i >= oldItems.length || !existing) {\n        const node = isSignalGetter(newItem) || typeof newItem === \"function\"\n          ? (() => {\n            const span = doc.createElement(\"span\");\n            span.setAttribute(\"data-view-dynamic\", \"\");\n            appendDynamicChild(\n              span,\n              newItem as () => unknown,\n              null,\n              defaultIfContext,\n            );\n            return span;\n          })()\n          : createElement(newItem as VNode);\n        if (i < frag.childNodes.length) {\n          frag.insertBefore(node, frag.childNodes[i]);\n        } else {\n          frag.appendChild(node);\n        }\n        continue;\n      }\n      const newIsGetter = isSignalGetter(newItem) ||\n        typeof newItem === \"function\";\n      const oldIsGetter = isSignalGetter(oldItem) ||\n        typeof oldItem === \"function\";\n      if (newIsGetter || oldIsGetter) {\n        runDirectiveUnmount(existing);\n        frag.replaceChild(\n          newIsGetter\n            ? (() => {\n              const span = doc.createElement(\"span\");\n              span.setAttribute(\"data-view-dynamic\", \"\");\n              appendDynamicChild(\n                span,\n                newItem as () => unknown,\n                null,\n                defaultIfContext,\n              );\n              return span;\n            })()\n            : createElement(newItem as VNode),\n          existing,\n        );\n      } else {\n        patchNode(\n          existing,\n          oldItem as VNode,\n          newItem as VNode,\n          null,\n          defaultIfContext,\n        );\n      }\n    }\n    return;\n  }\n\n  if (!Array.isArray(lastExpanded) && !Array.isArray(newExpanded)) {\n    patchNode(mounted, lastExpanded, newExpanded, null, defaultIfContext);\n    return;\n  }\n\n  const doc = (globalThis as { document: Document }).document;\n  runDirectiveUnmount(mounted);\n  const next = Array.isArray(newExpanded)\n    ? (() => {\n      const frag = doc.createDocumentFragment();\n      appendChildren(frag, newExpanded, null, defaultIfContext);\n      return frag;\n    })()\n    : createElement(newExpanded);\n  container.replaceChild(next, mounted);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 SSR\uFF1A\u5C06 VNode \u8F6C\u4E3A HTML \u5B57\u7B26\u4E32\u6216\u6D41\n *\n * createElementToString\u3001createElementToStream\u3001stringifyAttributes\u3001escapeText/escapeAttr\u3001normalizeChildrenForSSR\n */\n\nimport { isSignalGetter } from \"../signal.ts\";\nimport type { VNode } from \"../types.ts\";\nimport { getErrorBoundaryFallback, isErrorBoundary } from \"../boundary.ts\";\nimport {\n  getVElseIfValue,\n  getVElseShow,\n  getVForListAndFactory,\n  getVHtmlValue,\n  getVIfValue,\n  getVShowValue,\n  getVTextValue,\n  hasDirective,\n  hasStructuralDirective,\n  isDirectiveProp,\n} from \"../directive.ts\";\nimport { getContextBinding, popContext, pushContext } from \"../context.ts\";\nimport type { IfContext, SSROptions } from \"./shared.ts\";\nimport { isFragment, isVNodeLike } from \"./shared.ts\";\n\n/** \u81EA\u95ED\u5408\u6807\u7B7E\uFF0C\u4E0D\u751F\u6210\u95ED\u5408\u6807\u7B7E */\nconst voidElements = new Set([\n  \"area\",\n  \"base\",\n  \"br\",\n  \"col\",\n  \"embed\",\n  \"hr\",\n  \"img\",\n  \"input\",\n  \"link\",\n  \"meta\",\n  \"param\",\n  \"source\",\n  \"track\",\n  \"wbr\",\n]);\n\nfunction escapeText(s: string): string {\n  return s\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\");\n}\n\nfunction escapeAttr(s: string): string {\n  return s\n    .replace(/&/g, \"&amp;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\");\n}\n\n/** SSR \u4E13\u7528\uFF1A\u5C06 children \u89C4\u8303\u5316\u4E3A VNode \u6570\u7EC4\uFF0Cgetter \u4F1A\u8C03\u7528\u4E00\u6B21\u53D6\u5F53\u524D\u503C\uFF1B\u5355\u6B21\u904D\u5386\u6536\u96C6\u51CF\u5C11 flatMap \u4E2D\u95F4\u6570\u7EC4 */\nfunction normalizeChildrenForSSR(children: unknown): VNode[] {\n  if (children == null) return [];\n  if (isSignalGetter(children)) {\n    return normalizeChildrenForSSR((children as () => unknown)());\n  }\n  if (Array.isArray(children)) {\n    const out: VNode[] = [];\n    for (const c of children) {\n      const items = normalizeChildrenForSSR(c);\n      for (const v of items) out.push(v);\n    }\n    return out;\n  }\n  if (isVNodeLike(children)) {\n    return [children as VNode];\n  }\n  return [{\n    type: \"#text\",\n    props: { nodeValue: String(children) },\n    children: [],\n  }];\n}\n\n/**\n * SSR\uFF1A\u5C06 props \u4E2D\u9700\u8981\u8F93\u51FA\u7684\u5C5E\u6027\u8F6C\u4E3A HTML \u5C5E\u6027\u5B57\u7B26\u4E32\uFF08\u4E0D\u542B children/key\uFF09\n * \u82E5\u540E\u7EED\u9700\u4F18\u5316\uFF0C\u53EF\u5BF9\u9759\u6001 props \u505A\u7F13\u5B58\u62FC\u63A5\u7ED3\u679C\uFF08\u9700\u8BC6\u522B\u201C\u9759\u6001\u201D\uFF09\uFF0C\u6216\u4EC5\u5728\u786E\u6709\u52A8\u6001 props \u65F6\u518D\u4F18\u5316\n */\nfunction stringifyAttributes(props: Record<string, unknown>): string {\n  const parts: string[] = [];\n  for (const [key, value] of Object.entries(props)) {\n    if (\n      key === \"children\" || key === \"key\" || key === \"ref\" ||\n      key === \"dangerouslySetInnerHTML\"\n    ) continue;\n    // v-cloak\uFF1A\u8F93\u51FA\u4E3A data-view-cloak \u4F9B CSS \u9690\u85CF\uFF0Chydrate \u540E\u7531 runtime \u79FB\u9664\n    if (key === \"vCloak\" || key === \"v-cloak\") {\n      parts.push('data-view-cloak=\"\"');\n      continue;\n    }\n    if (isDirectiveProp(key)) continue;\n    const v = isSignalGetter(value) ? (value as () => unknown)() : value;\n    if (typeof v === \"function\") continue;\n    if (v == null || v === false) continue;\n    if (v === true) {\n      parts.push(escapeAttr(key));\n      continue;\n    }\n    let str: string;\n    if (key === \"style\" && typeof v === \"object\" && v !== null) {\n      str = Object.entries(v as Record<string, unknown>)\n        .map(([k, val]) =>\n          `${k.replace(/([A-Z])/g, \"-$1\").toLowerCase().replace(/^-/, \"\")}: ${\n            val == null ? \"\" : String(val)\n          }`\n        )\n        .join(\"; \");\n    } else {\n      str = String(v);\n    }\n    if (key === \"className\") {\n      parts.push(`class=\"${escapeAttr(str)}\"`);\n    } else if (key === \"htmlFor\") {\n      parts.push(`for=\"${escapeAttr(str)}\"`);\n    } else {\n      parts.push(`${escapeAttr(key)}=\"${escapeAttr(str)}\"`);\n    }\n  }\n  return parts.length ? \" \" + parts.join(\" \") : \"\";\n}\n\n/**\n * \u5C06 VNode \u8F6C\u4E3A HTML \u5B57\u7B26\u4E32\uFF08SSR\uFF0C\u65E0\u6D4F\u89C8\u5668 API\uFF09\n * SSR \u65F6 getter \u53EA\u6C42\u503C\u4E00\u6B21\uFF1BvIf/vElse/vFor \u4E0E createElement \u903B\u8F91\u4E00\u81F4\n * options.allowRawHtml \u4E3A false \u65F6 v-html \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF08\u5B89\u5168\u573A\u666F\uFF09\u3002\n * \u9ED8\u8BA4 v-html \u5728\u670D\u52A1\u7AEF\u540C\u6837\u4E0D\u8F6C\u4E49\uFF0C\u4E0E\u5BA2\u6237\u7AEF\u4E00\u81F4\u3002\n */\nexport function createElementToString(\n  vnode: VNode,\n  ifContext?: IfContext,\n  options?: SSROptions,\n): string {\n  if (isFragment(vnode)) {\n    const ctx = ifContext ?? { lastVIf: true };\n    const children = normalizeChildrenForSSR(\n      vnode.props.children ?? vnode.children,\n    );\n    return children.map((c) => createElementToString(c, ctx, options)).join(\"\");\n  }\n\n  if (typeof vnode.type === \"function\") {\n    const type = vnode.type;\n    const props = vnode.props;\n    const binding = getContextBinding(type, props);\n    if (binding) pushContext(binding.id, binding.value);\n    try {\n      const result: VNode | VNode[] | null = type(props);\n      if (result == null) return \"\";\n      const nodes = Array.isArray(result) ? result : [result];\n      if (isErrorBoundary(type)) {\n        try {\n          return nodes.map((n) => createElementToString(n, ifContext, options))\n            .join(\"\");\n        } catch (e) {\n          return createElementToString(\n            getErrorBoundaryFallback(props)(e),\n            ifContext,\n            options,\n          );\n        }\n      }\n      return nodes.map((n) => createElementToString(n, ifContext, options))\n        .join(\"\");\n    } finally {\n      if (binding) popContext(binding.id);\n    }\n  }\n\n  const tag = vnode.type as string;\n  if (tag === \"#text\") {\n    return escapeText(\n      String((vnode.props as { nodeValue?: unknown }).nodeValue ?? \"\"),\n    );\n  }\n\n  const props = vnode.props;\n  const structural = hasStructuralDirective(props);\n\n  if (hasDirective(props, \"vElse\")) {\n    if (ifContext && !getVElseShow(ifContext.lastVIf)) return \"\";\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (hasDirective(props, \"vElseIf\")) {\n    if (ifContext && ifContext.lastVIf) return \"\";\n    if (!getVElseIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return \"\";\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n\n  if (structural === \"vIf\") {\n    if (!getVIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return \"\";\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n\n  if (structural === \"vFor\") {\n    const rawChildren = props.children ?? vnode.children;\n    const parsed = getVForListAndFactory(props, rawChildren);\n    if (parsed) {\n      const { list, factory } = parsed;\n      const templateProps = { ...props, vFor: undefined, \"v-for\": undefined };\n      return list\n        .map((item, i) => {\n          const childResult = factory(item, i);\n          const childNodes = Array.isArray(childResult)\n            ? childResult\n            : [childResult];\n          const first = childNodes[0] as VNode | undefined;\n          const itemVnode: VNode = {\n            type: tag,\n            props: {\n              ...templateProps,\n              children: childNodes.length === 1 ? childNodes[0] : childNodes,\n            },\n            key: first?.key != null ? first.key : i,\n          };\n          return createElementToString(itemVnode, ifContext, options);\n        })\n        .join(\"\");\n    }\n  }\n\n  let attrs = stringifyAttributes(props);\n  if (hasDirective(props, \"vShow\")) {\n    if (!getVShowValue(props)) {\n      attrs += ' style=\"display:none\"';\n    }\n  }\n  if (vnode.key != null && vnode.key !== undefined) {\n    attrs += ` data-key=\"${escapeAttr(String(vnode.key))}\"`;\n  }\n  const ctx = ifContext ?? { lastVIf: true };\n  let inner: string;\n  if (hasDirective(props, \"vText\")) {\n    inner = escapeText(getVTextValue(props));\n  } else if (hasDirective(props, \"vHtml\")) {\n    const html = getVHtmlValue(props);\n    inner = options?.allowRawHtml === false ? escapeText(html) : html;\n  } else {\n    const children = normalizeChildrenForSSR(props.children ?? vnode.children);\n    const hasKeyedChildren = children.some(\n      (c) => (c as VNode).key != null && (c as VNode).key !== undefined,\n    );\n    inner = hasKeyedChildren\n      ? children\n        .map((c, i) => {\n          const v = c as VNode;\n          const key = v.key != null && v.key !== undefined\n            ? String(v.key)\n            : `@${i}`;\n          return `<span data-view-keyed data-key=\"${escapeAttr(key)}\">${\n            createElementToString(c, ctx, options)\n          }</span>`;\n        })\n        .join(\"\")\n      : children.map((c) => createElementToString(c, ctx, options)).join(\"\");\n  }\n  if (voidElements.has(tag.toLowerCase())) {\n    return `<${tag}${attrs}>`;\n  }\n  return `<${tag}${attrs}>${inner}</${tag}>`;\n}\n\n/**\n * \u6D41\u5F0F SSR\uFF1A\u5C06 VNode \u8F6C\u4E3A\u9010\u5757\u8F93\u51FA\u7684\u5B57\u7B26\u4E32\u751F\u6210\u5668\uFF0C\u4E0E createElementToString \u7ED3\u6784\u4E00\u81F4\n * options.allowRawHtml \u4E3A false \u65F6 v-html \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF1B\u9ED8\u8BA4 v-html \u5728\u670D\u52A1\u7AEF\u540C\u6837\u4E0D\u8F6C\u4E49\n */\nexport function* createElementToStream(\n  vnode: VNode,\n  ifContext?: IfContext,\n  options?: SSROptions,\n): Generator<string> {\n  if (isFragment(vnode)) {\n    const ctx = ifContext ?? { lastVIf: true };\n    const children = normalizeChildrenForSSR(\n      vnode.props.children ?? vnode.children,\n    );\n    for (const c of children) {\n      yield* createElementToStream(c, ctx, options);\n    }\n    return;\n  }\n\n  if (typeof vnode.type === \"function\") {\n    const type = vnode.type;\n    const props = vnode.props;\n    const binding = getContextBinding(type, props);\n    if (binding) pushContext(binding.id, binding.value);\n    try {\n      const result: VNode | VNode[] | null = type(props);\n      if (result == null) return;\n      const nodes = Array.isArray(result) ? result : [result];\n      if (isErrorBoundary(type)) {\n        try {\n          for (const n of nodes) {\n            yield* createElementToStream(n, ifContext, options);\n          }\n        } catch (e) {\n          yield* createElementToStream(\n            getErrorBoundaryFallback(props)(e),\n            ifContext,\n            options,\n          );\n        }\n      } else {\n        for (const n of nodes) {\n          yield* createElementToStream(n, ifContext, options);\n        }\n      }\n    } finally {\n      if (binding) popContext(binding.id);\n    }\n    return;\n  }\n\n  const tag = vnode.type as string;\n  if (tag === \"#text\") {\n    yield escapeText(\n      String((vnode.props as { nodeValue?: unknown }).nodeValue ?? \"\"),\n    );\n    return;\n  }\n\n  const props = vnode.props;\n  const structural = hasStructuralDirective(props);\n\n  if (hasDirective(props, \"vElse\")) {\n    if (ifContext && !getVElseShow(ifContext.lastVIf)) return;\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (hasDirective(props, \"vElseIf\")) {\n    if (ifContext && ifContext.lastVIf) return;\n    if (!getVElseIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return;\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (structural === \"vIf\") {\n    if (!getVIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return;\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (structural === \"vFor\") {\n    const rawChildren = props.children ?? vnode.children;\n    const parsed = getVForListAndFactory(props, rawChildren);\n    if (parsed) {\n      const { list, factory } = parsed;\n      const templateProps = { ...props, vFor: undefined, \"v-for\": undefined };\n      for (let i = 0; i < list.length; i++) {\n        const childResult = factory(list[i], i);\n        const childNodes = Array.isArray(childResult)\n          ? childResult\n          : [childResult];\n        const first = childNodes[0] as VNode | undefined;\n        const itemVnode: VNode = {\n          type: tag,\n          props: {\n            ...templateProps,\n            children: childNodes.length === 1 ? childNodes[0] : childNodes,\n          },\n          key: first?.key != null ? first.key : i,\n        };\n        yield* createElementToStream(itemVnode, ifContext, options);\n      }\n    }\n    return;\n  }\n\n  let attrs = stringifyAttributes(props);\n  if (hasDirective(props, \"vShow\")) {\n    if (!getVShowValue(props)) attrs += ' style=\"display:none\"';\n  }\n  if (vnode.key != null && vnode.key !== undefined) {\n    attrs += ` data-key=\"${escapeAttr(String(vnode.key))}\"`;\n  }\n  const ctx = ifContext ?? { lastVIf: true };\n  yield `<${tag}${attrs}>`;\n  if (!voidElements.has(tag.toLowerCase())) {\n    if (hasDirective(props, \"vText\")) {\n      yield escapeText(getVTextValue(props));\n    } else if (hasDirective(props, \"vHtml\")) {\n      const html = getVHtmlValue(props);\n      yield options?.allowRawHtml === false ? escapeText(html) : html;\n    } else {\n      const children = normalizeChildrenForSSR(\n        props.children ?? vnode.children,\n      );\n      const hasKeyedChildren = children.some(\n        (c) => (c as VNode).key != null && (c as VNode).key !== undefined,\n      );\n      if (hasKeyedChildren) {\n        for (let i = 0; i < children.length; i++) {\n          const v = children[i] as VNode;\n          const key = v.key != null && v.key !== undefined\n            ? String(v.key)\n            : `@${i}`;\n          yield `<span data-view-keyed data-key=\"${escapeAttr(key)}\">`;\n          yield* createElementToStream(children[i], ctx, options);\n          yield `</span>`;\n        }\n      } else {\n        for (const c of children) yield* createElementToStream(c, ctx, options);\n      }\n    }\n    yield `</${tag}>`;\n  }\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u5728\u5DF2\u6709 DOM \u4E0A hydrate\n *\n * \u590D\u7528 container \u5185\u5B50\u8282\u70B9\uFF0C\u4E0E vnode \u6811\u4E00\u4E00\u5BF9\u5E94\u5E76\u6302\u4E0A props/effect\n */\n\nimport { isSignalGetter } from \"../signal.ts\";\nimport type { VNode } from \"../types.ts\";\nimport {\n  getVElseIfValue,\n  getVElseShow,\n  getVIfValue,\n  hasDirective,\n  hasStructuralDirective,\n} from \"../directive.ts\";\nimport type { IfContext } from \"./shared.ts\";\nimport { isFragment } from \"./shared.ts\";\nimport { appendDynamicChild, normalizeChildren } from \"./element.ts\";\nimport { applyProps } from \"./props.ts\";\nimport { runDirectiveUnmountOnChildren } from \"./unmount.ts\";\n\n/**\n * \u5B8C\u6574 hydrate\uFF1A\u590D\u7528\u5DF2\u6709 DOM \u8282\u70B9\uFF0C\u4E0E vnode \u4E00\u4E00\u5BF9\u5E94\u5E76\u6302\u4E0A props/effect\n * \u8FD4\u56DE\u6D88\u8D39\u7684\u8282\u70B9\u6570\uFF08\u7528\u4E8E\u6E38\u6807\u63A8\u8FDB\uFF09\n */\nfunction hydrateFromList(\n  nodes: Node[],\n  index: number,\n  vnode: VNode,\n  parentNamespace: string | null,\n  ifContext?: IfContext,\n): number {\n  const props = vnode.props;\n  const structural = hasStructuralDirective(props);\n  if (hasDirective(props, \"vElse\")) {\n    if (ifContext && !getVElseShow(ifContext.lastVIf)) return index;\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (hasDirective(props, \"vElseIf\")) {\n    if (ifContext && ifContext.lastVIf) return index;\n    if (!getVElseIfValue(props)) {\n      if (ifContext) ifContext.lastVIf = false;\n      return index;\n    }\n    if (ifContext) ifContext.lastVIf = true;\n  }\n  if (structural === \"vIf\" && !getVIfValue(props)) {\n    if (ifContext) ifContext.lastVIf = false;\n    return index;\n  }\n  if (structural === \"vIf\" && ifContext) ifContext.lastVIf = true;\n\n  if (isFragment(vnode)) {\n    const ctx = ifContext ?? { lastVIf: true };\n    const children = normalizeChildren(vnode.props.children ?? vnode.children);\n    let i = index;\n    for (const c of children) {\n      if (isSignalGetter(c)) {\n        const wrap = (globalThis as { document: Document }).document\n          .createElement(\"span\");\n        wrap.setAttribute(\"data-view-dynamic\", \"\");\n        if (nodes[i]) {\n          (nodes[i] as Element).replaceWith?.(wrap) ??\n            (nodes[i].parentNode?.appendChild(wrap));\n        }\n        appendDynamicChild(wrap, c as () => unknown, parentNamespace, ctx);\n        i++;\n      } else {\n        i = hydrateFromList(nodes, i, c as VNode, parentNamespace, ctx);\n      }\n    }\n    return i;\n  }\n  if (typeof vnode.type === \"function\") {\n    const result = vnode.type(vnode.props);\n    if (result == null) return index;\n    const list = Array.isArray(result) ? result : [result];\n    let i = index;\n    for (const n of list) {\n      i = hydrateFromList(nodes, i, n, parentNamespace, ifContext);\n    }\n    return i;\n  }\n  const tag = vnode.type as string;\n  if (tag === \"#text\") {\n    const text = nodes[index] as Text;\n    if (text && text.nodeType === 3) {\n      text.nodeValue = String(\n        (vnode.props as { nodeValue?: unknown }).nodeValue ?? \"\",\n      );\n    }\n    return index + 1;\n  }\n  const el = nodes[index] as Element;\n  if (!el || el.nodeType !== 1) return index + 1;\n  const elTag = (el.nodeName || \"\").toLowerCase();\n  const wantTag = tag.toLowerCase();\n  if (elTag !== wantTag) return index + 1;\n  applyProps(el, props);\n  const rawChildren = props.children ?? vnode.children;\n  const ctx = ifContext ?? { lastVIf: true };\n  if (isSignalGetter(rawChildren)) {\n    runDirectiveUnmountOnChildren(el);\n    el.replaceChildren();\n    appendDynamicChild(el, rawChildren as () => unknown, parentNamespace, ctx);\n    return index + 1;\n  }\n  const childList = Array.from(el.childNodes);\n  const childItems = normalizeChildren(rawChildren);\n  let next = 0;\n  for (const item of childItems) {\n    if (isSignalGetter(item)) {\n      const wrap = (globalThis as { document: Document }).document\n        .createElement(\"span\");\n      wrap.setAttribute(\"data-view-dynamic\", \"\");\n      if (childList[next]) {\n        (childList[next] as Node).parentNode?.replaceChild(\n          wrap,\n          childList[next],\n        );\n      }\n      appendDynamicChild(wrap, item as () => unknown, parentNamespace, ctx);\n      next++;\n    } else {\n      next = hydrateFromList(\n        childList,\n        next,\n        item as VNode,\n        parentNamespace,\n        ctx,\n      );\n    }\n  }\n  return index + 1;\n}\n\n/**\n * \u5728\u5DF2\u6709 DOM \u5BB9\u5668\u4E0A\u5B8C\u6574 hydrate\uFF1A\u590D\u7528 container \u5185\u5B50\u8282\u70B9\uFF0C\u4E0E fn() \u7684 vnode \u6811\u4E00\u4E00\u5BF9\u5E94\n */\nexport function hydrateElement(container: Element, vnode: VNode): void {\n  const nodes = Array.from(container.childNodes);\n  hydrateFromList(nodes, 0, vnode, null);\n}\n", "/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 \u8FD0\u884C\u65F6\n *\n * createRoot / render\uFF08\u5BA2\u6237\u7AEF\u6302\u8F7D\uFF0C\u6839\u4E3A\u54CD\u5E94\u5F0F\uFF09\u3001renderToString\uFF08SSR/SSG\uFF09\u3001hydrate\uFF08Hybrid \u6FC0\u6D3B\uFF09\u3002\n * unmount \u65F6\u4F1A\u56DE\u6536\u8BE5\u6839\u4E0B\u6240\u6709 effect\uFF0C\u907F\u514D\u6CC4\u6F0F\u3002\n */\n\n/** hydrate \u540E\u79FB\u9664 data-view-cloak\uFF0C\u914D\u5408 CSS [data-view-cloak]{display:none} \u51CF\u5C11 FOUC */\nfunction removeCloak(container: Element): void {\n  if (container.hasAttribute(\"data-view-cloak\")) {\n    container.removeAttribute(\"data-view-cloak\");\n  }\n  for (const el of container.querySelectorAll(\"[data-view-cloak]\")) {\n    el.removeAttribute(\"data-view-cloak\");\n  }\n}\n\nimport { createEffect, setCurrentScope } from \"./effect.ts\";\nimport {\n  createElement,\n  createElementToString,\n  createNodeFromExpanded,\n  expandVNode,\n  hydrateElement,\n  patchRoot,\n  runDirectiveUnmount,\n  runDirectiveUnmountOnChildren,\n} from \"./dom.ts\";\nimport type { ExpandedRoot, SSROptions } from \"./dom.ts\";\nimport { isDOMEnvironment } from \"./types.ts\";\nimport type { Root, VNode } from \"./types.ts\";\n\n/**\n * \u521B\u5EFA\u6839\u5B9E\u4F8B\u5E76\u6302\u8F7D\u5230\u5BB9\u5668\uFF08\u6D4F\u89C8\u5668\uFF09\n * \u6839\u4E3A\u54CD\u5E94\u5F0F\uFF1Afn \u5185\u8BFB\u5230\u7684 signal \u53D8\u5316\u65F6\u4F1A\u91CD\u65B0\u6267\u884C fn \u5E76\u66F4\u65B0\u6302\u8F7D\u5185\u5BB9\u3002\n * unmount \u65F6\u56DE\u6536\u8BE5\u6811\u4E0B\u521B\u5EFA\u7684\u6240\u6709 effect\u3002\n *\n * @param fn \u6839\u7EC4\u4EF6\u51FD\u6570\uFF0C\u8FD4\u56DE VNode\uFF08\u6216 JSX\uFF09\n * @param container \u6302\u8F7D\u7684 DOM \u5BB9\u5668\n * @returns Root \u53E5\u67C4\uFF0C\u53EF\u8C03\u7528 unmount \u5378\u8F7D\n */\nexport function createRoot(fn: () => VNode, container: Element): Root {\n  if (!isDOMEnvironment()) {\n    return {\n      unmount: () => {},\n      container: null,\n    };\n  }\n\n  let mounted: Node | null = null;\n  let lastExpanded: ExpandedRoot | null = null;\n  let disposed = false;\n  const disposers: Array<() => void> = [];\n\n  const root: Root = {\n    container,\n    unmount() {\n      disposed = true;\n      disposers.forEach((d) => d());\n      disposers.length = 0;\n      if (mounted && container.contains(mounted)) {\n        runDirectiveUnmount(mounted);\n        container.removeChild(mounted);\n      }\n      mounted = null;\n      lastExpanded = null;\n    },\n  };\n\n  // \u6839 effect\uFF1A\u9996\u6B21\u6302\u8F7D\u7528 expand + createNodeFromExpanded\uFF1B\u4E4B\u540E\u7528 patchRoot \u539F\u5730\u66F4\u65B0\uFF0C\u4E0D\u6574\u6811\u66FF\u6362\uFF0C\u8868\u5355\u4E0D\u91CD\u6302\u3001\u4E0D\u4E22\u7126\u70B9\n  const disposeRoot = createEffect(() => {\n    if (disposed) return;\n    setCurrentScope({ addDisposer: (d) => disposers.push(d) });\n    try {\n      const vnode = fn();\n      const newExpanded = expandVNode(vnode);\n      if (mounted == null || !container.contains(mounted)) {\n        mounted = createNodeFromExpanded(newExpanded);\n        container.appendChild(mounted);\n        lastExpanded = newExpanded;\n      } else {\n        patchRoot(container, mounted, lastExpanded!, newExpanded);\n        lastExpanded = newExpanded;\n      }\n    } finally {\n      setCurrentScope(null);\n    }\n  });\n  disposers.push(disposeRoot);\n\n  return root;\n}\n\n/**\n * \u4FBF\u6377\u65B9\u6CD5\uFF1A\u521B\u5EFA\u6839\u5E76\u6302\u8F7D\uFF08\u7B49\u540C\u4E8E createRoot(fn, container)\uFF09\n *\n * @param fn \u6839\u7EC4\u4EF6\u51FD\u6570\n * @param container \u6302\u8F7D\u7684 DOM \u5BB9\u5668\n * @returns Root \u53E5\u67C4\n */\nexport function render(fn: () => VNode, container: Element): Root {\n  return createRoot(fn, container);\n}\n\n/**\n * \u5C06\u6839\u7EC4\u4EF6\u6E32\u67D3\u4E3A HTML \u5B57\u7B26\u4E32\uFF08SSR/SSG\uFF0C\u65E0\u6D4F\u89C8\u5668 API\uFF09\n *\n * @param fn \u6839\u7EC4\u4EF6\u51FD\u6570\n * @param options allowRawHtml \u4E3A false \u65F6 v-html \u8F93\u51FA\u8F6C\u4E49\u6587\u672C\uFF08\u5B89\u5168\u573A\u666F\uFF09\uFF1B\u9ED8\u8BA4 v-html \u5728\u670D\u52A1\u7AEF\u4E0D\u8F6C\u4E49\n * @returns HTML \u5B57\u7B26\u4E32\n */\nexport function renderToString(\n  fn: () => VNode,\n  options?: SSROptions,\n): string {\n  const vnode = fn();\n  return createElementToString(vnode, undefined, options);\n}\n\n/** Hybrid \u6CE8\u5165\u811A\u672C\u7684\u914D\u7F6E\uFF1A\u521D\u59CB\u6570\u636E\u4E0E\u5BA2\u6237\u7AEF\u811A\u672C\u8DEF\u5F84\u7B49 */\nexport type HydrationScriptOptions = {\n  /** \u6CE8\u5165\u5230 window \u7684\u521D\u59CB\u6570\u636E\uFF0C\u5BA2\u6237\u7AEF\u53EF\u901A\u8FC7\u540C\u4E00 dataKey \u8BFB\u53D6 */\n  data?: unknown;\n  /** \u6302\u5230 window \u4E0A\u7684\u952E\u540D\uFF0C\u9ED8\u8BA4 __VIEW_DATA__ */\n  dataKey?: string;\n  /** \u5BA2\u6237\u7AEF\u5165\u53E3\u811A\u672C URL\uFF08type=\"module\"\uFF09\uFF0C\u53EF\u9009 */\n  scriptSrc?: string;\n  /** CSP nonce\uFF0C\u53EF\u9009 */\n  nonce?: string;\n};\n\n/**\n * \u751F\u6210 Hybrid \u6CE8\u5165\u811A\u672C HTML\uFF1A\u5C06 data \u5199\u5165 window[dataKey]\uFF0C\u5E76\u53EF\u9009\u6CE8\u5165\u5BA2\u6237\u7AEF\u5165\u53E3\u811A\u672C\n * \u670D\u52A1\u7AEF\u5728 HTML \u672B\u5C3E\u63D2\u5165\u6B64\u8FD4\u56DE\u503C\u540E\uFF0C\u5BA2\u6237\u7AEF\u53EF\u8BFB\u53D6 window[dataKey] \u5E76\u8C03\u7528 hydrate(fn, container)\u3002\n *\n * @param options \u53EF\u9009\uFF1Bdata \u4E3A\u521D\u59CB\u6570\u636E\uFF0CscriptSrc \u4E3A\u5BA2\u6237\u7AEF bundle \u5730\u5740\uFF0Cnonce \u7528\u4E8E CSP\n * @returns \u4E00\u6BB5 HTML \u5B57\u7B26\u4E32\uFF08\u4E00\u4E2A\u6216\u591A\u4E2A <script> \u6807\u7B7E\uFF09\n *\n * @example\n * const html = renderToString(() => <App />);\n * const scripts = generateHydrationScript({ data: { user }, scriptSrc: \"/client.js\" });\n * return `<!DOCTYPE html><html><body><div id=\"root\">${html}</div>${scripts}</body></html>`;\n */\nexport function generateHydrationScript(\n  options: HydrationScriptOptions = {},\n): string {\n  const {\n    data,\n    dataKey = \"__VIEW_DATA__\",\n    scriptSrc,\n    nonce,\n  } = options;\n  const parts: string[] = [];\n  const nonceAttr = nonce\n    ? ` nonce=\"${String(nonce).replace(/\"/g, \"&quot;\")}\"`\n    : \"\";\n  if (data !== undefined) {\n    const payload = JSON.stringify(data);\n    const scriptBody = `window.${dataKey}=JSON.parse(${\n      JSON.stringify(payload)\n    })`;\n    const safe = scriptBody.replace(/<\\/script/gi, \"\\\\u003c/script\");\n    parts.push(`<script${nonceAttr}>${safe}</script>`);\n  }\n  if (scriptSrc) {\n    parts.push(\n      `<script type=\"module\" src=\"${\n        String(scriptSrc).replace(/\"/g, \"&quot;\")\n      }\"${nonceAttr}></script>`,\n    );\n  }\n  return parts.join(\"\");\n}\n\n/**\n * \u5728\u5DF2\u6709\u670D\u52A1\u7AEF HTML \u7684\u5BB9\u5668\u4E0A\u6FC0\u6D3B\uFF08Hybrid\uFF09\n * \u82E5 container \u5DF2\u6709\u5B50\u8282\u70B9\uFF0C\u5219\u4E0E fn() \u7684 VNode \u4E00\u4E00\u5BF9\u5E94\u590D\u7528 DOM\uFF08\u5B8C\u6574 hydrate\uFF09\uFF1B\n * \u9996\u6B21\u590D\u7528\u540E\uFF0C\u540E\u7EED\u54CD\u5E94\u5F0F\u66F4\u65B0\u4ECD\u505A\u6574\u6811\u66FF\u6362\u3002\u65E0\u5B50\u8282\u70B9\u65F6\u4E0E createRoot \u884C\u4E3A\u4E00\u81F4\u3002\n *\n * @param fn \u6839\u7EC4\u4EF6\u51FD\u6570\uFF08\u4E0E SSR \u65F6\u76F8\u540C\uFF09\n * @param container \u5DF2\u6709 SSR \u5185\u5BB9\u7684 DOM \u5BB9\u5668\n * @returns Root \u53E5\u67C4\n */\nexport function hydrate(fn: () => VNode, container: Element): Root {\n  if (!isDOMEnvironment()) {\n    return { unmount: () => {}, container: null };\n  }\n  let mounted: Node | Element | null = null;\n  let disposed = false;\n  let didHydrate = false;\n  const disposers: Array<() => void> = [];\n\n  const root: Root = {\n    container,\n    unmount() {\n      disposed = true;\n      disposers.forEach((d) => d());\n      disposers.length = 0;\n      if (mounted != null) {\n        if (mounted === container) {\n          runDirectiveUnmountOnChildren(container as Element);\n          (container as Element).textContent = \"\";\n        } else if ((container as Element).contains(mounted)) {\n          runDirectiveUnmount(mounted);\n          (container as Element).removeChild(mounted);\n        }\n      }\n      mounted = null;\n    },\n  };\n\n  const disposeRoot = createEffect(() => {\n    if (disposed) return;\n    setCurrentScope({ addDisposer: (d) => disposers.push(d) });\n    try {\n      const vnode = fn();\n      const hasExisting = (container as Element).hasChildNodes();\n      if (hasExisting && !didHydrate) {\n        hydrateElement(container as Element, vnode);\n        didHydrate = true;\n        mounted = container as Element;\n        removeCloak(container as Element);\n      } else {\n        if (mounted != null) {\n          if (mounted === container) {\n            runDirectiveUnmountOnChildren(container as Element);\n            (container as Element).textContent = \"\";\n          } else if ((container as Element).contains(mounted)) {\n            runDirectiveUnmount(mounted);\n            (container as Element).removeChild(mounted);\n          }\n        }\n        mounted = createElement(vnode);\n        (container as Element).appendChild(mounted);\n      }\n    } finally {\n      setCurrentScope(null);\n    }\n  });\n  disposers.push(disposeRoot);\n  return root;\n}\n"],
  "mappings": "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",
  "names": ["queue", "queueCopy", "scheduled", "flushQueue", "run", "schedule", "unschedule", "currentEffect", "setCurrentEffect", "effect", "getCurrentEffect", "createSignal", "initialValue", "value", "subscribers", "getter", "setter", "next", "nextValue", "run", "schedule", "markSignalGetter", "SIGNAL_GETTER_MARKER", "isSignalGetter", "fn", "currentScope", "setCurrentScope", "scope", "currentScope", "scheduleEffect", "run", "schedule", "onCleanup", "cb", "getCurrentEffect", "runCleanups", "list", "createEffect", "fn", "disposed", "subs", "s", "prev", "setCurrentEffect", "nextDispose", "disposer", "runWithSubs", "unschedule", "createMemo", "get", "set", "createSignal", "markSignalGetter", "FragmentType", "isFragment", "vnode", "isVNodeLike", "x", "registerDirectiveUnmount", "el", "cb", "viewEl", "list", "runDirectiveUnmountOnChildren", "parent", "child", "runDirectiveUnmount", "node", "isDOMEnvironment", "isErrorBoundary", "component", "ErrorBoundary", "getErrorBoundaryFallback", "props", "fb", "vnode", "registry", "directiveNameToCamel", "name", "rest", "_", "c", "directiveNameToKebab", "getDirective", "propKey", "registry", "directiveNameToCamel", "BUILTIN_DIRECTIVE_PROPS", "isDirectiveProp", "hasDirective", "props", "camelName", "directiveNameToKebab", "getDirectiveValue", "value", "isSignalGetter", "createBinding", "arg", "modifiers", "hasStructuralDirective", "getVIfValue", "raw", "getVElseShow", "lastVIf", "getVElseIfValue", "resolveVForFactory", "children", "getVForListAndFactory", "rawList", "resolved", "list", "factory", "getVShowValue", "getVTextValue", "v", "getVHtmlValue", "applyDirectives", "el", "props", "effectFn", "registerUnmount", "key", "value", "BUILTIN_DIRECTIVE_PROPS", "directive", "getDirective", "binding", "createBinding", "isSignalGetter", "current", "contextStacks", "providerBindings", "pushContext", "id", "value", "stack", "contextStacks", "popContext", "getContextBinding", "component", "props", "binding", "providerBindings", "applyRef", "el", "ref", "applyProps", "props", "isDOMEnvironment", "hasDirective", "raw", "apply", "show", "getVShowValue", "isSignalGetter", "createEffect", "text", "getVTextValue", "html", "getVHtmlValue", "getter", "setter", "tag", "inputEl", "textareaEl", "selectEl", "inputType", "type", "isFocusedFormElement", "v", "str", "key", "value", "isDirectiveProp", "inner", "applySingleProp", "applyDirectives", "registerDirectiveUnmount", "VIEW_EVENT_KEY_PREFIX", "active", "viewEl", "event", "storageKey", "prev", "fn", "classVal", "style", "k", "formEl", "attrName", "SVG_NS", "KEYED_WRAPPER_ATTR", "freezeVNodeForOnce", "vnode", "props", "frozenProps", "k", "v", "isSignalGetter", "getDirectiveValue", "freezeChildrenForOnce", "raw", "c", "resolveNamespace", "tag", "parentNamespace", "normalizeChildren", "children", "out", "items", "item", "hasAnyKey", "x", "reconcileKeyedChildren", "container", "ifContext", "doc", "keyToWrapper", "child", "key", "resultNodes", "ctx", "i", "wrap", "appendDynamicChild", "wrapper", "runDirectiveUnmountOnChildren", "createElement", "parent", "getter", "placeholder", "createEffect", "value", "frag", "inner", "collectVIfGroup", "list", "startIndex", "first", "v0", "vIfRaw", "isReactiveVIf", "hasDirective", "group", "it", "createVIfGroupPlaceholder", "showIndex", "getVIfValue", "getVElseIfValue", "chosen", "stripProps", "next", "appendChildren", "rawChildren", "isDOMEnvironment", "isFragment", "type", "binding", "getContextBinding", "pushContext", "result", "nodes", "isErrorBoundary", "n", "e", "getErrorBoundaryFallback", "popContext", "structural", "hasStructuralDirective", "getVElseShow", "show", "rawList", "templateProps", "childNs", "resolved", "factory", "resolveVForFactory", "childResult", "childNodes", "itemVnode", "parsed", "getVForListAndFactory", "ns", "el", "applyProps", "expandVNode", "expanded", "fallbackVNode", "newChildren", "createNodeFromExpanded", "reconcileChildren", "oldItems", "newItems", "node", "runDirectiveUnmount", "maxLen", "newItem", "oldItem", "existing", "span", "newIsGetter", "oldIsGetter", "patchNode", "dom", "oldV", "newV", "newVal", "oldChildren", "defaultIfContext", "patchRoot", "mounted", "lastExpanded", "newExpanded", "voidElements", "escapeText", "s", "escapeAttr", "normalizeChildrenForSSR", "children", "isSignalGetter", "out", "c", "items", "v", "isVNodeLike", "stringifyAttributes", "props", "parts", "key", "value", "isDirectiveProp", "str", "k", "val", "createElementToString", "vnode", "ifContext", "options", "isFragment", "ctx", "type", "binding", "getContextBinding", "pushContext", "result", "nodes", "isErrorBoundary", "n", "e", "getErrorBoundaryFallback", "popContext", "tag", "structural", "hasStructuralDirective", "hasDirective", "getVElseShow", "getVElseIfValue", "getVIfValue", "rawChildren", "parsed", "getVForListAndFactory", "list", "factory", "templateProps", "item", "i", "childResult", "childNodes", "first", "itemVnode", "attrs", "getVShowValue", "inner", "getVTextValue", "html", "getVHtmlValue", "hydrateFromList", "nodes", "index", "vnode", "parentNamespace", "ifContext", "props", "structural", "hasStructuralDirective", "hasDirective", "getVElseShow", "getVElseIfValue", "getVIfValue", "isFragment", "ctx", "children", "normalizeChildren", "i", "c", "isSignalGetter", "wrap", "appendDynamicChild", "result", "list", "n", "tag", "text", "el", "elTag", "wantTag", "applyProps", "rawChildren", "runDirectiveUnmountOnChildren", "childList", "childItems", "next", "item", "hydrateElement", "container", "removeCloak", "container", "el", "createRoot", "fn", "isDOMEnvironment", "mounted", "lastExpanded", "disposed", "disposers", "root", "d", "runDirectiveUnmount", "disposeRoot", "createEffect", "setCurrentScope", "vnode", "newExpanded", "expandVNode", "createNodeFromExpanded", "patchRoot", "render", "renderToString", "options", "createElementToString", "generateHydrationScript", "data", "dataKey", "scriptSrc", "nonce", "parts", "nonceAttr", "payload", "safe", "hydrate", "didHydrate", "runDirectiveUnmountOnChildren", "hydrateElement", "createElement"]
}
