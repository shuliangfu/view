{
  "version": 3,
  "sources": ["../src/context.ts"],
  "sourcesContent": ["/**\n * View \u6A21\u677F\u5F15\u64CE \u2014 Context\uFF08\u8DE8\u5C42\u6570\u636E\u6CE8\u5165\uFF09\n *\n * createContext \u521B\u5EFA\u4E0A\u4E0B\u6587\uFF0CProvider \u5728\u6811\u4E2D\u6CE8\u5165\u503C\uFF0CuseContext \u5728\u4EFB\u610F\u5B50\u7EC4\u4EF6\u4E2D\u8BFB\u53D6\u3002\n * \u6E32\u67D3\u65F6\u5728 dom \u4E2D\u8FDB\u5165 Provider \u5373 push\u3001\u9000\u51FA\u5373 pop\uFF0C\u4FDD\u8BC1\u540C\u4E00\u6B21\u6E32\u67D3\u4E2D\u5B50\u6811\u8BFB\u5230\u6B63\u786E\u503C\u3002\n */\n\nimport type { VNode } from \"./types.ts\";\n\n/** \u6BCF\u4E2A context \u7684\u6808\uFF0C\u7528\u4E8E\u5D4C\u5957 Provider */\nconst contextStacks = new Map<symbol, unknown[]>();\n\n/** context id -> \u9ED8\u8BA4\u503C\uFF08\u65E0 Provider \u65F6 useContext \u8FD4\u56DE\uFF09 */\nconst defaultValues = new Map<symbol, unknown>();\n\n/** \u53EF\u6CE8\u5165 context \u7684\u7EC4\u4EF6 -> { id, getValue }\uFF0C\u652F\u6301\u9ED8\u8BA4 Provider(value) \u4E0E\u522B\u540D\u7EC4\u4EF6\uFF08\u5982 RouterProvider(router)\uFF09 */\nconst providerBindings = new Map<\n  (props: Record<string, unknown>) => VNode | VNode[] | null,\n  { id: symbol; getValue: (props: Record<string, unknown>) => unknown }\n>();\n\n/**\n * \u8FDB\u5165 Provider \u65F6\u538B\u6808\uFF08\u7531 dom \u5728\u6E32\u67D3\u65F6\u8C03\u7528\uFF09\n * @internal\n */\nexport function pushContext(id: symbol, value: unknown): void {\n  let stack = contextStacks.get(id);\n  if (!stack) {\n    stack = [];\n    contextStacks.set(id, stack);\n  }\n  stack.push(value);\n}\n\n/**\n * \u79BB\u5F00 Provider \u65F6\u51FA\u6808\uFF08\u7531 dom \u5728\u6E32\u67D3\u65F6\u8C03\u7528\uFF09\n * @internal\n */\nexport function popContext(id: symbol): void {\n  const stack = contextStacks.get(id);\n  if (stack && stack.length > 0) stack.pop();\n}\n\n/**\n * \u83B7\u53D6\u5F53\u524D context \u503C\uFF08\u6808\u9876\uFF09\uFF0C\u65E0\u5219\u8FD4\u56DE\u521B\u5EFA\u65F6\u7684\u9ED8\u8BA4\u503C\n * @internal\n */\nexport function getContext(id: symbol): unknown {\n  const stack = contextStacks.get(id);\n  const value = stack && stack.length > 0 ? stack[stack.length - 1] : undefined;\n  return value !== undefined ? value : defaultValues.get(id);\n}\n\n/**\n * \u5224\u65AD\u7EC4\u4EF6\u662F\u5426\u4E3A\u67D0 context \u7684 Provider\uFF0C\u82E5\u662F\u5219\u8FD4\u56DE\u5176 context id\n * @internal\n */\nexport function getProviderContextId(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n): symbol | undefined {\n  return providerBindings.get(component)?.id;\n}\n\n/**\n * \u82E5\u7EC4\u4EF6\u5DF2\u6CE8\u518C\u4E3A context \u63D0\u4F9B\u8005\uFF08\u542B createContext \u7684 Provider \u6216 registerProviderAlias \u7684\u522B\u540D\uFF09\uFF0C\n * \u8FD4\u56DE { id, value } \u4F9B dom \u5C42 push\uFF1B\u5426\u5219\u8FD4\u56DE undefined\u3002\n * @internal\n */\nexport function getContextBinding(\n  component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n  props: Record<string, unknown>,\n): { id: symbol; value: unknown } | undefined {\n  const binding = providerBindings.get(component);\n  if (!binding) return undefined;\n  return { id: binding.id, value: binding.getValue(props) };\n}\n\nexport type ContextValue<T> = T;\n\n/**\n * \u521B\u5EFA\u4E0A\u4E0B\u6587\n *\n * @param defaultValue \u65E0 Provider \u5305\u88F9\u65F6 useContext \u8FD4\u56DE\u7684\u9ED8\u8BA4\u503C\n * @returns { Provider, useContext }\uFF0CProvider \u4E3A\u7EC4\u4EF6\u7528\u4E8E\u5305\u88F9\u5B50\u6811\uFF0CuseContext \u5728\u5B50\u7EC4\u4EF6\u4E2D\u8C03\u7528\u53D6\u5F53\u524D\u503C\n *\n * @example\n * const ThemeContext = createContext<'light'|'dark'>('light');\n * // \u6839\u6216\u7236\u7EA7\uFF1A<ThemeContext.Provider value={theme()}><App /></ThemeContext.Provider>\n * // \u5B50\u7EC4\u4EF6\uFF1Aconst theme = ThemeContext.useContext();\n */\nexport function createContext<T>(defaultValue: T): {\n  Provider: (\n    props: { value: T; children?: VNode | VNode[] | null },\n  ) => VNode | VNode[] | null;\n  useContext: () => T;\n  /** \u6CE8\u518C\u201C\u522B\u540D\u201D\u63D0\u4F9B\u8005\uFF1A\u7528 getValue(props) \u6CE8\u5165\u540C\u4E00 context\uFF0C\u4FBF\u4E8E\u5305\u88C5\u7EC4\u4EF6\uFF08\u5982 RouterProvider(router)\uFF09\u76F4\u63A5\u6CE8\u5165\uFF0C\u65E0\u9700\u5185\u5C42 Provider */\n  registerProviderAlias: (\n    component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n    getValue: (props: Record<string, unknown>) => T,\n  ) => void;\n} {\n  const id = Symbol(\"view.context\");\n  defaultValues.set(id, defaultValue);\n\n  const Provider = (\n    props: { value: T; children?: VNode | VNode[] | null },\n  ): VNode | VNode[] | null => {\n    return (props.children ?? null) as VNode | VNode[] | null;\n  };\n  providerBindings.set(\n    Provider as (props: Record<string, unknown>) => VNode | VNode[] | null,\n    { id, getValue: (p) => (p as { value: T }).value },\n  );\n\n  const useContext = (): T => {\n    return getContext(id) as T;\n  };\n\n  const registerProviderAlias = (\n    component: (props: Record<string, unknown>) => VNode | VNode[] | null,\n    getValue: (props: Record<string, unknown>) => T,\n  ): void => {\n    providerBindings.set(component, {\n      id,\n      getValue: getValue as (p: Record<string, unknown>) => unknown,\n    });\n  };\n\n  return { Provider, useContext, registerProviderAlias };\n}\n"],
  "mappings": "AAUA,IAAMA,EAAgB,IAAI,IAGpBC,EAAgB,IAAI,IAGpBC,EAAmB,IAAI,IAStB,SAASC,EAAYC,EAAYC,EAAsB,CAC5D,IAAIC,EAAQN,EAAc,IAAII,CAAE,EAC3BE,IACHA,EAAQ,CAAC,EACTN,EAAc,IAAII,EAAIE,CAAK,GAE7BA,EAAM,KAAKD,CAAK,CAClB,CAMO,SAASE,EAAWH,EAAkB,CAC3C,IAAME,EAAQN,EAAc,IAAII,CAAE,EAC9BE,GAASA,EAAM,OAAS,GAAGA,EAAM,IAAI,CAC3C,CAMO,SAASE,EAAWJ,EAAqB,CAC9C,IAAME,EAAQN,EAAc,IAAII,CAAE,EAC5BC,EAAQC,GAASA,EAAM,OAAS,EAAIA,EAAMA,EAAM,OAAS,CAAC,EAAI,OACpE,OAAOD,IAAU,OAAYA,EAAQJ,EAAc,IAAIG,CAAE,CAC3D,CAMO,SAASK,EACdC,EACoB,CACpB,OAAOR,EAAiB,IAAIQ,CAAS,GAAG,EAC1C,CAOO,SAASC,EACdD,EACAE,EAC4C,CAC5C,IAAMC,EAAUX,EAAiB,IAAIQ,CAAS,EAC9C,GAAKG,EACL,MAAO,CAAE,GAAIA,EAAQ,GAAI,MAAOA,EAAQ,SAASD,CAAK,CAAE,CAC1D,CAeO,SAASE,EAAiBC,EAU/B,CACA,IAAMX,EAAK,OAAO,cAAc,EAChCH,EAAc,IAAIG,EAAIW,CAAY,EAElC,IAAMC,EACJJ,GAEQA,EAAM,UAAY,KAE5B,OAAAV,EAAiB,IACfc,EACA,CAAE,GAAAZ,EAAI,SAAWa,GAAOA,EAAmB,KAAM,CACnD,EAgBO,CAAE,SAAAD,EAAU,WAdA,IACVR,EAAWJ,CAAE,EAaS,sBAVD,CAC5BM,EACAQ,IACS,CACThB,EAAiB,IAAIQ,EAAW,CAC9B,GAAAN,EACA,SAAUc,CACZ,CAAC,CACH,CAEqD,CACvD",
  "names": ["contextStacks", "defaultValues", "providerBindings", "pushContext", "id", "value", "stack", "popContext", "getContext", "getProviderContextId", "component", "getContextBinding", "props", "binding", "createContext", "defaultValue", "Provider", "p", "getValue"]
}
