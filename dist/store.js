var v=new Set,b=[],w=!1;function R(){w=!1,b.length=0;for(let e of v)b.push(e);v.clear();for(let e of b)e()}function g(e){v.add(e),w||(w=!0,typeof globalThis.queueMicrotask<"u"?globalThis.queueMicrotask(R):typeof Promise<"u"?Promise.resolve().then(R):setTimeout(R,0))}function K(e){v.delete(e)}var S=null;function x(e){S=e}function k(){return S}function _(e){let n=e,t=new Set,i=()=>(S&&(t.add(S),S._subscriptionSets&&S._subscriptionSets.push(t)),n),s=r=>{let u=typeof r=="function"?r(n):r;Object.is(n,u)||(n=u,t.forEach(o=>g(o)))};return[E(i),s]}var W=Symbol.for("view.signalGetter");function E(e){return e[W]=!0,e}var j=null;function N(e){g(e)}function h(e){let n=e._cleanups;if(n){for(let t of n)t();n.length=0}}function I(e){let n=!1,t=()=>{if(n)return;h(t);let r=t._subscriptionSets;if(r){for(let o of r)o.delete(t);r.length=0}t._cleanups=[];let u=k();t._subscriptionSets=[],x(t);try{let o=e();typeof o=="function"&&t._cleanups.push(o)}finally{x(u)}},i=()=>{n||(h(t),N(t))};t._subscriptionSets=[],t._cleanups=[],t();let s=()=>{if(n)return;n=!0;let r=t,u=r._subscriptionSets;if(u){for(let o of u)o.delete(t);u.length=0}h(r),K(i)};return j&&j.addDisposer(s),s}function G(e){let[n,t]=_(void 0);return I(()=>t(e())),E(n)}var l=Symbol.for("view.store.internal");function O(e,n,t){let i=t.get(e);if(i)return i;let s=new Proxy(e,{get(r,u){let o=k();o&&n.add(o);let c=Reflect.get(r,u);return c!==null&&typeof c=="object"?O(c,n,t):c},set(r,u,o){let c=Reflect.set(r,u,o);return c&&n.forEach(p=>g(p)),c}});return t.set(e,s),s}function L(e,n,t){return new Proxy(e,{get(i,s){if(s===l)return i[l];let r=k();r&&n.add(r);let o=i[l][s];return o!==null&&typeof o=="object"?O(o,n,t):o},set(i,s,r){let u=i[l];return s===l?i[l]=r:u[s]=r,n.forEach(o=>g(o)),!0}})}function M(e){return JSON.stringify(e)}function z(e){return JSON.parse(e)}function C(){return typeof globalThis<"u"&&"localStorage"in globalThis?globalThis.localStorage:null}function U(e){let{state:n,getters:t,actions:i,persist:s}=e,r=new Set,u=new WeakMap,o={[l]:{...n}};if(s?.key){let a=s.storage??C(),d=s.deserialize??z;if(a)try{let T=a.getItem(s.key);if(T!=null&&T!==""){let f=d(T);f&&typeof f=="object"&&(o[l]={...n,...f})}}catch{}}let c=()=>L(o,r,u),p=a=>{let d=o[l],T=typeof a=="function"?a(d):a;if(o[l]={...T},r.forEach(f=>g(f)),s?.key){let f=s.storage??C(),y=s.serialize??M;if(f)try{f.setItem(s.key,y(o[l]))}catch{}}},A=!!t&&Object.keys(t).length>0,m=!!i&&Object.keys(i).length>0;if(A&&m){let a={};for(let[T,f]of Object.entries(t))typeof f=="function"&&(a[T]=G(()=>f(c)));let d={};for(let[T,f]of Object.entries(i))typeof f=="function"&&(d[T]=(...y)=>f(c,p,...y));return[c,p,a,d]}if(A){let a={};for(let[d,T]of Object.entries(t))typeof T=="function"&&(a[d]=G(()=>T(c)));return[c,p,a]}if(m){let a={};for(let[d,T]of Object.entries(i))typeof T=="function"&&(a[d]=(...f)=>T(c,p,...f));return[c,p,a]}return[c,p]}export{U as createStore};
//# sourceMappingURL=store.js.map
